import{_ as r}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as p,a,b as s,d as n,w as i,e}from"./app-6706a352.js";const m={},g=e(`<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180922057.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="一、案例——基于-ip-和端口的防火墙控制" tabindex="-1"><a class="header-anchor" href="#一、案例——基于-ip-和端口的防火墙控制" aria-hidden="true">#</a> 一、案例——基于 IP 和端口的防火墙控制</h2><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933936.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><blockquote><p>实验环境：为网关、Web 服务器配置防火墙规则<br> 需求描述：<br> 1、为网站服务器编写入站规则<br>   （1）允许接受响应本机 ping 测试请求的各种 ICMP 数据包<br>   （2）允许访问本机中位于 80 端口的Web 服务，禁止访问其他端口的 TCP 请求<br>   （3）允许发往本机以建立连接或与已有连接相关的各种 TCP 数据包<br>   （4）禁止其他任何形式的入站访问数据</p></blockquote><p><strong>搭建实验环境，结果如下：</strong></p><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933887.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933718.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933669.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933805.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933110.png" alt="" loading="lazy"></p><p>为网站服务器编写入站规则<br> 允许接受响应本机 ping 测试请求的各种 ICMP 数据包</p><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933229.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180933550.png" alt="" loading="lazy"></p><p>禁止其他任何形式的入站访问数据</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932138.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>内网服务器 ping 网关测试：</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932696.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>网关 ping 内网服务器测试：</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932844.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>允许访问本机中位于 80 端口的 Web 服务，禁止访问其他端口的 TCP 请求</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932617.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>允许发往本机以建立连接或与已有连接相关的各种 TCP 数据包</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932413.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>保存 iptables 设置</p><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932289.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932607.png" alt="" loading="lazy"></p><p>测试</p><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932675.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932278.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932005.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932521.png" alt="" loading="lazy"></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@iptables~<span class="token punctuation">]</span><span class="token comment"># elinks 192.168.1.5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932825.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932036.png" alt="" loading="lazy"></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@iptables~<span class="token punctuation">]</span><span class="token comment"># ftp 192.168.1.5</span>
ftp:connect:连接超时
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>`,25),d=a("br",null,null,-1),h=a("br",null,null,-1),b={href:"http://web.qq.com",target:"_blank",rel:"noopener noreferrer"},u={href:"http://w.qq.com",target:"_blank",rel:"noopener noreferrer"},y={href:"http://im.qq.com",target:"_blank",rel:"noopener noreferrer"},_=a("p",null,[a("strong",null,"允许局域网中的主机访问Internet 中是 Web、FTP、DNS、邮件服务")],-1),f=a("figure",null,[a("img",{src:"https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180932015.png",alt:"",tabindex:"0",loading:"lazy"}),a("figcaption")],-1),v={href:"http://xn--web-u68doc253fghhnvxqrin42akjhjys981b213a.qq.com",target:"_blank",rel:"noopener noreferrer"},k={href:"http://w.qq.com",target:"_blank",rel:"noopener noreferrer"},x={href:"http://im.qq.com",target:"_blank",rel:"noopener noreferrer"},T=e('<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931733.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931012.png" alt="" loading="lazy"></p><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931001.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931116.png" alt="" loading="lazy"></p><p>保存 iptables 规则配置</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931339.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="二、snat-策略" tabindex="-1"><a class="header-anchor" href="#二、snat-策略" aria-hidden="true">#</a> 二、SNAT 策略</h2><h3 id="_1、作用" tabindex="-1"><a class="header-anchor" href="#_1、作用" aria-hidden="true">#</a> 1、作用</h3><p>作用：局域网主机共享单个公网 IP 地址接入 Internet</p><h3 id="_2、snat-策略的原理" tabindex="-1"><a class="header-anchor" href="#_2、snat-策略的原理" aria-hidden="true">#</a> 2、SNAT 策略的原理</h3><p>  源地址转换，Source Network Address Translation<br>   修改数据包的源地址</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931117.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3、企业共享上网案例" tabindex="-1"><a class="header-anchor" href="#_3、企业共享上网案例" aria-hidden="true">#</a> 3、企业共享上网案例</h3><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931043.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>前提条件：<br>   局域网各主机正确设置 IP 地址/子网掩码<br>   局域网各主机正确设置默认网关地址<br>   Linux 网关支持 IP 路由转发</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180931766.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930453.png" alt="" loading="lazy"><br><img src="https://img-blog.csdnimg.cn/203fe1b17f0d4d90b14d0e6c69bfb346.png#pic_center" alt="" loading="lazy"></p><h4 id="_3-1、固定的外网-ip-地址" tabindex="-1"><a class="header-anchor" href="#_3-1、固定的外网-ip-地址" aria-hidden="true">#</a> 3.1、固定的外网 IP 地址</h4><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930207.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930216.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930695.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930370.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930207.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930948.png" alt="" loading="lazy"></p><h4 id="_3-2、非固定外网-ip-地址或-adsl" tabindex="-1"><a class="header-anchor" href="#_3-2、非固定外网-ip-地址或-adsl" aria-hidden="true">#</a> 3.2、非固定外网 IP 地址或 ADSL</h4><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180930709.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="三、dnat-策略" tabindex="-1"><a class="header-anchor" href="#三、dnat-策略" aria-hidden="true">#</a> 三、DNAT 策略</h2><h3 id="_1、dnat-原理" tabindex="-1"><a class="header-anchor" href="#_1、dnat-原理" aria-hidden="true">#</a> 1、DNAT 原理</h3><p>  在 Internet 环境中，通过网关服务器中正确设置 DNAT 策略可实现企业所注册的网站或域名必须对应公网 IP 地址。</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929574.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>前提条件<br>   局域网的 Web 服务器能够访问 Internet<br>   网关的外网 IP 地址有正确的 DNS 解析记录<br>   Linux 网关支持 IP 路由转发</p><h4 id="_1-1、dnat-转发规则-1-发内网-web-服务" tabindex="-1"><a class="header-anchor" href="#_1-1、dnat-转发规则-1-发内网-web-服务" aria-hidden="true">#</a> 1.1、DNAT 转发规则 1：发内网 Web 服务</h4><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929930.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929271.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929338.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929438.png" alt="" loading="lazy"></p><h4 id="_1-2、dnat-转换规则-2-发布时修改目标端口" tabindex="-1"><a class="header-anchor" href="#_1-2、dnat-转换规则-2-发布时修改目标端口" aria-hidden="true">#</a> 1.2、DNAT 转换规则 2：发布时修改目标端口</h4><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929002.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929322.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929014.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929994.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929749.png" alt="" loading="lazy"></p><h2 id="四、iptables-防火墙规则的备份与还原" tabindex="-1"><a class="header-anchor" href="#四、iptables-防火墙规则的备份与还原" aria-hidden="true">#</a> 四、iptables 防火墙规则的备份与还原</h2><blockquote><p>  设置完防火墙规则后，可备份规则到文件中，以便日后进行还原，或以备份规则为依据编写防火墙脚本</p></blockquote>',30),P=a("br",null,null,-1),z=e(`<h3 id="_1、导出-备份-防火墙规则" tabindex="-1"><a class="header-anchor" href="#_1、导出-备份-防火墙规则" aria-hidden="true">#</a> 1、导出（备份）防火墙规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables-save 工具
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,2),j=e(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables-save <span class="token operator">&gt;</span> 要导出的路径
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),I=e(`<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929106.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_2、导入-还原-防火墙规则" tabindex="-1"><a class="header-anchor" href="#_2、导入-还原-防火墙规则" aria-hidden="true">#</a> 2、导入（还原）防火墙规则</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables-restore 工具
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,3),w=e(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>iptables-restore <span class="token operator">&lt;</span> 要导入的路径
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,1),N=e(`<p>查看规则，现在是空的：</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929806.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>导入规则：</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180929021.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><blockquote><p>  重定向出的文件也可以是任意自定义的文件，若将规则保存到/etc/sysconfig/iptables 中，iptables 启动时自动还原规则。</p></blockquote><h2 id="五、企业防火墙脚本编程与规范【附加】" tabindex="-1"><a class="header-anchor" href="#五、企业防火墙脚本编程与规范【附加】" aria-hidden="true">#</a> 五、企业防火墙脚本编程与规范【附加】</h2><h3 id="_1、-网关型-防火墙脚本" tabindex="-1"><a class="header-anchor" href="#_1、-网关型-防火墙脚本" aria-hidden="true">#</a> 1、“网关型”防火墙脚本</h3><p>好的防火墙脚本要包括以下部分：</p><ul><li>定义基本变量，便于脚本的维护、重用</li><li>加载必要的内核模块，将频繁用到的模块载入到内核</li><li>调整/proc 参数，Linux 内核控制及调优</li><li>具体的防火墙规则，按表、链分别设置规则，包括默认策略</li></ul><h4 id="_1-1、定义基本变量便于脚本的维护、重用" tabindex="-1"><a class="header-anchor" href="#_1-1、定义基本变量便于脚本的维护、重用" aria-hidden="true">#</a> 1.1、定义基本变量便于脚本的维护、重用</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token assign-left variable">INET_IF</span><span class="token operator">=</span>”eth0”
<span class="token assign-left variable">INET_IP</span><span class="token operator">=</span>”192.168.1.108”
<span class="token assign-left variable">LAN_IF</span><span class="token operator">=</span>”eth1”
<span class="token assign-left variable">LAN_IP</span><span class="token operator">=</span>”192.168.100.1”
<span class="token assign-left variable">LAN_NET</span><span class="token operator">=</span>”192.168.100.0/24”
<span class="token assign-left variable">LAN_WWW_IP</span><span class="token operator">=</span>”192.168.100.100”
<span class="token assign-left variable">IPT</span><span class="token operator">=</span>”/sbin/iptables”
<span class="token assign-left variable">MOD</span><span class="token operator">=</span>”/sbin/modprobe”
<span class="token assign-left variable">CTL</span><span class="token operator">=</span>”/sbin/sysctl”
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2、加载必要的内核模块将频繁用到的模块载入内核" tabindex="-1"><a class="header-anchor" href="#_1-2、加载必要的内核模块将频繁用到的模块载入内核" aria-hidden="true">#</a> 1.2、加载必要的内核模块将频繁用到的模块载入内核</h4>`,12),D=a("blockquote",null,[a("p",null,[s("……"),a("br"),a("span",{class:"katex"},[a("span",{class:"katex-mathml"},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("semantics",null,[a("mrow",null,[a("mi",null,"M"),a("mi",null,"O"),a("mi",null,"D"),a("mi",null,"i"),a("msub",null,[a("mi",null,"p"),a("mi",null,"t")]),a("mi",null,"a"),a("mi",null,"b"),a("mi",null,"l"),a("mi",null,"e"),a("mi",null,"s")]),a("annotation",{encoding:"application/x-tex"},"MOD ip_tables ")])])]),a("span",{class:"katex-html","aria-hidden":"true"},[a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.8889em","vertical-align":"-0.1944em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"MO"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"D"),a("span",{class:"mord mathnormal"},"i"),a("span",{class:"mord"},[a("span",{class:"mord mathnormal"},"p"),a("span",{class:"msupsub"},[a("span",{class:"vlist-t vlist-t2"},[a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.2806em"}},[a("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[a("span",{class:"pstrut",style:{height:"2.7em"}}),a("span",{class:"sizing reset-size6 size3 mtight"},[a("span",{class:"mord mathnormal mtight"},"t")])])]),a("span",{class:"vlist-s"},"​")]),a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.15em"}},[a("span")])])])])]),a("span",{class:"mord mathnormal"},"ab"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.01968em"}},"l"),a("span",{class:"mord mathnormal"},"es")])])]),s("MOD ip_conntrack"),a("br"),a("span",{class:"katex"},[a("span",{class:"katex-mathml"},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("semantics",null,[a("mrow",null,[a("mi",null,"M"),a("mi",null,"O"),a("mi",null,"D"),a("mi",null,"i"),a("mi",null,"p"),a("msub",null,[a("mi",null,"t"),a("mi",null,"R")]),a("mi",null,"E"),a("mi",null,"J"),a("mi",null,"E"),a("mi",null,"C"),a("mi",null,"T")]),a("annotation",{encoding:"application/x-tex"},"MOD ipt_REJECT ")])])]),a("span",{class:"katex-html","aria-hidden":"true"},[a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.8778em","vertical-align":"-0.1944em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"MO"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"D"),a("span",{class:"mord mathnormal"},"i"),a("span",{class:"mord mathnormal"},"p"),a("span",{class:"mord"},[a("span",{class:"mord mathnormal"},"t"),a("span",{class:"msupsub"},[a("span",{class:"vlist-t vlist-t2"},[a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.3283em"}},[a("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[a("span",{class:"pstrut",style:{height:"2.7em"}}),a("span",{class:"sizing reset-size6 size3 mtight"},[a("span",{class:"mord mathnormal mtight",style:{"margin-right":"0.00773em"}},"R")])])]),a("span",{class:"vlist-s"},"​")]),a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.15em"}},[a("span")])])])])]),a("span",{class:"mord mathnormal",style:{"margin-right":"0.05764em"}},"E"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.09618em"}},"J"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"ECT")])])]),s("MOD ipt_LOG"),a("br"),a("span",{class:"katex"},[a("span",{class:"katex-mathml"},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("semantics",null,[a("mrow",null,[a("mi",null,"M"),a("mi",null,"O"),a("mi",null,"D"),a("mi",null,"i"),a("mi",null,"p"),a("msub",null,[a("mi",null,"t"),a("mi",null,"i")]),a("mi",null,"p"),a("mi",null,"r"),a("mi",null,"a"),a("mi",null,"n"),a("mi",null,"g"),a("mi",null,"e")]),a("annotation",{encoding:"application/x-tex"},"MOD ipt_iprange ")])])]),a("span",{class:"katex-html","aria-hidden":"true"},[a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.8778em","vertical-align":"-0.1944em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"MO"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"D"),a("span",{class:"mord mathnormal"},"i"),a("span",{class:"mord mathnormal"},"p"),a("span",{class:"mord"},[a("span",{class:"mord mathnormal"},"t"),a("span",{class:"msupsub"},[a("span",{class:"vlist-t vlist-t2"},[a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.3117em"}},[a("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[a("span",{class:"pstrut",style:{height:"2.7em"}}),a("span",{class:"sizing reset-size6 size3 mtight"},[a("span",{class:"mord mathnormal mtight"},"i")])])]),a("span",{class:"vlist-s"},"​")]),a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.15em"}},[a("span")])])])])]),a("span",{class:"mord mathnormal"},"p"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"r"),a("span",{class:"mord mathnormal"},"an"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.03588em"}},"g"),a("span",{class:"mord mathnormal"},"e")])])]),s("MOD xt_tcpudp"),a("br"),a("span",{class:"katex"},[a("span",{class:"katex-mathml"},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("semantics",null,[a("mrow",null,[a("mi",null,"M"),a("mi",null,"O"),a("mi",null,"D"),a("mi",null,"x"),a("msub",null,[a("mi",null,"t"),a("mi",null,"s")]),a("mi",null,"t"),a("mi",null,"a"),a("mi",null,"t"),a("mi",null,"e")]),a("annotation",{encoding:"application/x-tex"},"MOD xt_state ")])])]),a("span",{class:"katex-html","aria-hidden":"true"},[a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.8333em","vertical-align":"-0.15em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"MO"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"D"),a("span",{class:"mord mathnormal"},"x"),a("span",{class:"mord"},[a("span",{class:"mord mathnormal"},"t"),a("span",{class:"msupsub"},[a("span",{class:"vlist-t vlist-t2"},[a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.1514em"}},[a("span",{style:{top:"-2.55em","margin-left":"0em","margin-right":"0.05em"}},[a("span",{class:"pstrut",style:{height:"2.7em"}}),a("span",{class:"sizing reset-size6 size3 mtight"},[a("span",{class:"mord mathnormal mtight"},"s")])])]),a("span",{class:"vlist-s"},"​")]),a("span",{class:"vlist-r"},[a("span",{class:"vlist",style:{height:"0.15em"}},[a("span")])])])])]),a("span",{class:"mord mathnormal"},"t"),a("span",{class:"mord mathnormal"},"a"),a("span",{class:"mord mathnormal"},"t"),a("span",{class:"mord mathnormal"},"e")])])]),s("MOD xt_multiport"),a("br"),s(" $MOD xt_mac")])],-1),M=e(`<h4 id="_1-3、调整-proc-参数linux-内核控制及调优" tabindex="-1"><a class="header-anchor" href="#_1-3、调整-proc-参数linux-内核控制及调优" aria-hidden="true">#</a> 1.3、调整/proc 参数Linux 内核控制及调优</h4><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>……
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.ip_forward</span><span class="token operator">=</span><span class="token number">1</span>            开启路由转发功能
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.default_ttl</span><span class="token operator">=</span><span class="token number">128</span>         默认生存周期
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.icmp_echo_ignore_all</span><span class="token operator">=</span><span class="token number">1</span>            根本不要响应 <span class="token builtin class-name">echo</span> 包。请不要设置为缺省，它可能在你正被利用成为 DoS 攻击的跳板时可能有用
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.icmp_echo_ignore_broadcasts</span><span class="token operator">=</span><span class="token number">1</span>     <span class="token function">ping</span> 子网的子网地址，所有的机器都应该予以回应。这可能成为非常好用的拒绝服务攻击工具。设置为 <span class="token number">1</span> 来忽略这些子网广播消息以下配置为优化 TCP 响应能力
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.tcp_syncookies</span><span class="token operator">=</span><span class="token number">1</span>        tcp syncookie，默认关闭
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.tcp_syn_retries</span><span class="token operator">=</span><span class="token number">3</span>       外向 syn 握手重试次数，默认 <span class="token number">4</span>
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.tcp_synack_retries</span><span class="token operator">=</span><span class="token number">3</span>    syn-ack 握手状态重试次数，默认 <span class="token number">5</span>，遭受 syn-flood 攻击时改为 <span class="token number">1</span> 或 <span class="token number">2</span>
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.tcp_fin_timeout</span><span class="token operator">=</span><span class="token number">60</span>      默认 <span class="token number">60</span>，tcp fin 状态超时时间
<span class="token variable">$CTL</span> <span class="token parameter variable">-w</span> <span class="token assign-left variable">net.ipv4.tcp_max_syn_backlog</span><span class="token operator">=</span><span class="token number">3200</span>     syn 队列，默认1024，<span class="token operator">&gt;</span> <span class="token number">1280</span> 可能工作不稳定，需要修改内核源码参数
……
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-4、具体的防火墙规则" tabindex="-1"><a class="header-anchor" href="#_1-4、具体的防火墙规则" aria-hidden="true">#</a> 1.4、具体的防火墙规则</h4><p>按表、链分别设置规则，包括默认策略</p>`,4),L=a("br",null,null,-1),q=a("code",null,"$IPT -t filter -X",-1),O=a("br",null,null,-1),C=a("code",null,"$IPT -t nat -X",-1),E=a("br",null,null,-1),A=a("code",null,"$IPT -t filter -F",-1),$=a("br",null,null,-1),W=a("code",null,"$IPT -t nat -F",-1),R=a("br",null,null,-1),U=a("br",null,null,-1),F=a("br",null,null,-1),S=a("code",null,"$IPT -P INPUT DROP",-1),X=a("br",null,null,-1),B=a("code",null,"$IPT -p FORWARD DROP",-1),V=a("br",null,null,-1),G=a("code",null,"$IPT -P OUTPUT ACCEPT",-1),J=a("br",null,null,-1),Q=a("br",null,null,-1),H=a("br",null,null,-1),K=a("code",null,"$IPT -I INPUT -p tcp --dport 22 -j ACCEPT",-1),Y=a("br",null,null,-1),Z=a("code",null,"$IPT -t nat -A POSTROUTING -s $LAN_NET -o $INET_IF -j SNAT --to-source $INET_IP",-1),aa=a("br",null,null,-1),sa=a("code",null,"$IPT -t nat -A PREROUTING -i $INET_IF -d $INET_IP -p tcp --dport 80 -j DNAT --to-destination",-1),na=a("br",null,null,-1),la=a("code",null,"$LAN_WWW_IP",-1),ia=e('<h4 id="_1-5、实例" tabindex="-1"><a class="header-anchor" href="#_1-5、实例" aria-hidden="true">#</a> 1.5、实例：</h4><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180928744.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180928143.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180928481.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180928534.png" alt="" loading="lazy"></p><h3 id="_2、-主机型-防火墙脚本" tabindex="-1"><a class="header-anchor" href="#_2、-主机型-防火墙脚本" aria-hidden="true">#</a> 2、“主机型”防火墙脚本</h3><ul><li>将 OUTPUT 链的默认策略设为允许，不添加其他规则</li><li>将 INPUT 链的默认策略设为拒绝，只放行对 Web 服务的访问，以及响应本机访问请求的数据包</li></ul><h4 id="_2-1、定义基本变量" tabindex="-1"><a class="header-anchor" href="#_2-1、定义基本变量" aria-hidden="true">#</a> 2.1、定义基本变量</h4><p>IPT=”/sbin/iptables”<br> ……</p><h4 id="_2-2、调整-proc-参数" tabindex="-1"><a class="header-anchor" href="#_2-2、调整-proc-参数" aria-hidden="true">#</a> 2.2、调整/proc 参数</h4><p>……</p><h4 id="_2-3、设置具体的防火墙规则" tabindex="-1"><a class="header-anchor" href="#_2-3、设置具体的防火墙规则" aria-hidden="true">#</a> 2.3、设置具体的防火墙规则</h4>',9),ea=a("blockquote",null,[a("p",null,[s("  1>删除自定义的链、清空已有规则"),a("br"),a("span",{class:"katex"},[a("span",{class:"katex-mathml"},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("semantics",null,[a("mrow",null,[a("mi",null,"I"),a("mi",null,"P"),a("mi",null,"T"),a("mo",null,"−"),a("mi",null,"t"),a("mi",null,"f"),a("mi",null,"i"),a("mi",null,"l"),a("mi",null,"t"),a("mi",null,"e"),a("mi",null,"r"),a("mo",null,"−"),a("mi",null,"X")]),a("annotation",{encoding:"application/x-tex"},"IPT -t filter -X ")])])]),a("span",{class:"katex-html","aria-hidden":"true"},[a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.7667em","vertical-align":"-0.0833em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.07847em"}},"I"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"PT"),a("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),a("span",{class:"mbin"},"−"),a("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.8889em","vertical-align":"-0.1944em"}}),a("span",{class:"mord mathnormal"},"t"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.10764em"}},"f"),a("span",{class:"mord mathnormal"},"i"),a("span",{class:"mord mathnormal"},"lt"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"er"),a("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),a("span",{class:"mbin"},"−"),a("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.6833em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.07847em"}},"X")])])]),s("IPT -t filter -F"),a("br"),a("br"),s("   2>定义默认策略"),a("br"),a("span",{class:"katex"},[a("span",{class:"katex-mathml"},[a("math",{xmlns:"http://www.w3.org/1998/Math/MathML"},[a("semantics",null,[a("mrow",null,[a("mi",null,"I"),a("mi",null,"P"),a("mi",null,"T"),a("mo",null,"−"),a("mi",null,"P"),a("mi",null,"I"),a("mi",null,"N"),a("mi",null,"P"),a("mi",null,"U"),a("mi",null,"T"),a("mi",null,"D"),a("mi",null,"R"),a("mi",null,"O"),a("mi",null,"P")]),a("annotation",{encoding:"application/x-tex"},"IPT -P INPUT DROP ")])])]),a("span",{class:"katex-html","aria-hidden":"true"},[a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.7667em","vertical-align":"-0.0833em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.07847em"}},"I"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"PT"),a("span",{class:"mspace",style:{"margin-right":"0.2222em"}}),a("span",{class:"mbin"},"−"),a("span",{class:"mspace",style:{"margin-right":"0.2222em"}})]),a("span",{class:"base"},[a("span",{class:"strut",style:{height:"0.6833em"}}),a("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"P"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.07847em"}},"I"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"NP"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.10903em"}},"U"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"T"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.02778em"}},"D"),a("span",{class:"mord mathnormal",style:{"margin-right":"0.13889em"}},"ROP")])])]),s("IPT -p FORWARD DROP"),a("br"),a("span",{class:"katex-error",title:`ParseError: KaTeX parse error: Expected 'EOF', got '&' at position 26: …PUT ACCEPT<br>
&̲emsp;&emsp; 3>设…`,style:{color:"#cc0000"}},"IPT -P OUTPUT ACCEPT<br> &emsp;&emsp; 3>设置 filter 表中的各种规则 "),s("IPT -A INPUT -m multiport -p tcp --dport 22,80 -j ACCEPT"),a("br"),s(" $IPT -A INPUT -m state --state ESTABLISHED,RELATED,NEW -j ACCEPT")])],-1),ta=e('<h4 id="_2-4、实例" tabindex="-1"><a class="header-anchor" href="#_2-4、实例" aria-hidden="true">#</a> 2.4、实例：</h4><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180927032.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180927549.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180927515.png" alt="" loading="lazy"><br><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180927496.png" alt="" loading="lazy"></p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180927160.gif" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="相关文章" tabindex="-1"><a class="header-anchor" href="#相关文章" aria-hidden="true">#</a> 相关文章</h2>',4),oa={href:"https://liucy.blog.csdn.net/article/details/125968904",target:"_blank",rel:"noopener noreferrer"},ra=a("hr",null,null,-1),ca={href:"https://liucy.blog.csdn.net/article/details/126243322",target:"_blank",rel:"noopener noreferrer"},pa=a("hr",null,null,-1),ma={href:"https://liucy.blog.csdn.net/article/details/126243544",target:"_blank",rel:"noopener noreferrer"},ga=a("figure",null,[a("img",{src:"https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412180927477.gif",alt:"",tabindex:"0",loading:"lazy"}),a("figcaption")],-1);function da(ha,ba){const t=o("ExternalLinkIcon"),l=o("font");return c(),p("div",null,[g,a("blockquote",null,[a("p",null,[s("2、为网关服务器编写转发规则"),d,s("   （1）允许局域网中的主机访问 Internet 中是 Web、FTP、DNS、邮件服务"),h,s("   （2）禁止局域网中的主机访问 "),a("a",b,[s("web.qq.com"),n(t)]),s("、"),a("a",u,[s("w.qq.com"),n(t)]),s("、"),a("a",y,[s("im.qq.com"),n(t)]),s(" 等网站，以防止通过 WebQQ 的方式进行在线聊天")])]),_,f,a("p",null,[a("a",v,[s("禁止局域网中的主机访问web.qq.com"),n(t)]),s("、"),a("a",k,[s("w.qq.com"),n(t)]),s("、"),a("a",x,[s("im.qq.com"),n(t)]),s(" 等网站")]),T,n(l,{color:"red"},{default:i(()=>[s(" > 为导出   iptables-save"),P,s(" < 为导入   iptables-restore")]),_:1}),z,a("p",null,[a("strong",null,[n(l,{color:"teal"},{default:i(()=>[s("语法格式：")]),_:1})])]),j,a("p",null,[a("strong",null,[n(l,{color:"teal"},{default:i(()=>[s("实例：")]),_:1})])]),I,a("p",null,[a("strong",null,[n(l,{color:"teal"},{default:i(()=>[s("语法格式：")]),_:1})])]),w,a("p",null,[a("strong",null,[n(l,{color:"teal"},{default:i(()=>[s("实例：")]),_:1})])]),N,D,n(l,{color:"red"},{default:i(()=>[s("\\$MOD ip_nat_ftp      支持 FTP 访问的地址转换 $MOD ip_conntrack_ftp   支持 FTP 访问的连接状态跟踪")]),_:1}),M,a("blockquote",null,[a("p",null,[a("strong",null,[n(l,{color:"teal"},{default:i(()=>[s("清空原有规则：")]),_:1})]),L,q,s("   "),n(l,{color:"red"},{default:i(()=>[s("删除 filter 表内的用户自定义的链")]),_:1}),O,C,E,A,$,W,R,U,a("strong",null,[n(l,{color:"teal"},{default:i(()=>[s("设置默认策略：")]),_:1})]),F,S,X,B,V,G,J,Q,a("strong",null,[n(l,{color:"teal"},{default:i(()=>[s("其他具体规则：")]),_:1})]),H,K,Y,Z,aa,sa,na,la])]),ia,ea,ta,a("blockquote",null,[a("p",null,[a("a",oa,[s("🍎【Linux】iptables之防火墙概述及规则匹配+实例（1）"),n(t)])]),ra,a("p",null,[a("a",ca,[s("🍌【Linux】iptables之防火墙的应用及案例、策略、备份与还原（2）"),n(t)])]),pa,a("p",null,[a("a",ma,[s("🍐【Linux】firewall-cmd之防火墙简介及常用命令+实例"),n(t)])])]),ga])}const _a=r(m,[["render",da],["__file","【Linux】iptables之防火墙的应用及案例、策略、备份与还原（2）.html.vue"]]);export{_a as default};
