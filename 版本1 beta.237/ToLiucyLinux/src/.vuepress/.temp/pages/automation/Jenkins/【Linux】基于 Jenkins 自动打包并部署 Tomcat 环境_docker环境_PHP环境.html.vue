<template><div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/c0aa11fd101543d0a17ef264c0609468.jpeg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<blockquote>
<p>ğŸ<strong>åšä¸»ç®€ä»‹</strong><br>
â€ƒâ€ƒğŸ…<a href="https://blog.csdn.net/liu_chen_yang?type=blog" target="_blank" rel="noopener noreferrer">äº‘è®¡ç®—é¢†åŸŸä¼˜è´¨åˆ›ä½œè€…<ExternalLinkIcon/></a><br>
â€ƒâ€ƒğŸ…<a href="https://bbs.huaweicloud.com/community/myblog" target="_blank" rel="noopener noreferrer">åä¸ºäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»<ExternalLinkIcon/></a><br>
â€ƒâ€ƒğŸ…<a href="https://developer.aliyun.com/my?spm=a2c6h.13148508.setting.3.21fc4f0eCmz1v3#/article?_k=zooqoz" target="_blank" rel="noopener noreferrer">é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»<ExternalLinkIcon/></a><br>
ğŸ’Š<strong>äº¤æµç¤¾åŒºï¼š</strong><a href="https://bbs.csdn.net/forums/lcy" target="_blank" rel="noopener noreferrer">è¿ç»´äº¤æµç¤¾åŒº<ExternalLinkIcon/></a> æ¬¢è¿å¤§å®¶çš„åŠ å…¥ï¼</p>
</blockquote>
<hr>
<h2 id="jenkinsçš„åŸºæœ¬é…ç½®" tabindex="-1"><a class="header-anchor" href="#jenkinsçš„åŸºæœ¬é…ç½®" aria-hidden="true">#</a> jenkinsçš„åŸºæœ¬é…ç½®</h2>
<h3 id="_1ã€ä¿®æ”¹-jenkins-åˆå§‹å¯†ç " tabindex="-1"><a class="header-anchor" href="#_1ã€ä¿®æ”¹-jenkins-åˆå§‹å¯†ç " aria-hidden="true">#</a> 1ã€ä¿®æ”¹ jenkins åˆå§‹å¯†ç </h3>
<p>1  ç‚¹å‡»Jenkinsçš„ç®¡ç†<br>
2  è¿›å…¥ç”¨æˆ·<br>
3  è®¾ç½®ä¿®æ”¹å¯†ç </p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/31df0c79e09f4d9aa2c3f8453f237b60.png" alt="" loading="lazy"><br>
<img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/1014ef8d72a149bf813b1335b1540e74.png" alt="" loading="lazy"><br>
<img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/180c0f1b574343baa0097d0a05520664.png" alt="" loading="lazy"><br>
<img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/089bf009eb8a48d08e4f89458685ac1c.png" alt="" loading="lazy"></p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/3f52f0f56e2b4cca90a33d4d6ec77762.png" alt="" loading="lazy"><br>
<img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/f12898c529a548f48c326a701d2b1bdc.png" alt="" loading="lazy"></p>
<h3 id="_2ã€å®‰è£…-jenkins-å¿…è¦æ’ä»¶" tabindex="-1"><a class="header-anchor" href="#_2ã€å®‰è£…-jenkins-å¿…è¦æ’ä»¶" aria-hidden="true">#</a> 2ã€å®‰è£… Jenkins å¿…è¦æ’ä»¶</h3>
<p>åœ¨ Jenkins é¦–é¡µä¸­ï¼Œç‚¹å‡»å·¦ä¾§çš„ Manage Jenkins&gt;&gt;Manage Plugins&gt;&gt;å¯é€‰æ’ä»¶ï¼Œåœ¨è¿‡æ»¤æœ ç´¢æ¡†ä¸­è¾“å…¥è¦å®‰è£…çš„ <font color=red>Publish Over SSH</font> ã€  <font color=red>Maven Integration</font> æ’ä»¶ï¼Œå¹¶å‹¾ä¸­å…¶å·¦ä¾§çš„å¤ é€‰æ¡†ï¼Œç‚¹å‡»â€œç›´æ¥å®‰è£…â€å³å¯å¼€å§‹æ’ä»¶å®‰è£…æ“ä½œã€‚</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/c31abbbda15f4b1295bb326ff9c220e8.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/38d4ddbcd3ef4eb49b5de8dae87ccf14.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/4346fbf977a54640b40865794391f933.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/1d3c7745bc8f46c081bbc016daa4321b.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/18eb45bda8ec4fc2b45e575e18a9875b.png" alt="" loading="lazy"></p>
<h3 id="_3ã€é…ç½®-jenkins-å¹¶å‘æ‰§è¡Œæ•°é‡" tabindex="-1"><a class="header-anchor" href="#_3ã€é…ç½®-jenkins-å¹¶å‘æ‰§è¡Œæ•°é‡" aria-hidden="true">#</a> 3ã€é…ç½® jenkins å¹¶å‘æ‰§è¡Œæ•°é‡</h3>
<p>ç”¨äºæé«˜æé«˜æ‰§è¡Œæ•ˆç‡</p>
<font color=red>Manage Jenkins</font> >> <font color=red>Configure System</font> >> <font color=red>Maven é¡¹ç›®é…ç½®</font><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/1268310994bc41c49751155aad084ad4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>å¹¶å‘æ‰§è¡Œè€…æ•°é‡  å¦‚æœæ„å»ºä»»åŠ¡æ•°é‡å¤šçš„æ—¶å€™,æˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€æ—¶é—´å†…æ„å»ºå¤šä¸ªï¼›<br>
é»˜è®¤æ˜¯2ä¸ª</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/bc31c6fcb70a47b4a5af3b95ac2ecd8f.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/0536f9383e9943fb831f4268e23300f8.png" alt="" loading="lazy"></p>
<h3 id="_4ã€é…ç½®é‚®ä»¶åœ°å€" tabindex="-1"><a class="header-anchor" href="#_4ã€é…ç½®é‚®ä»¶åœ°å€" aria-hidden="true">#</a> 4ã€é…ç½®é‚®ä»¶åœ°å€</h3>
<p>åœ¨æµ‹è¯•å®Œæˆåï¼Œä¸»åŠ¨å‘é‚®ä»¶å‘ŠçŸ¥æµ‹è¯•æƒ…å†µ</p>
<font color=red>Manage Jenkins</font> >> <font color=red>Configure System</font> >> <font color=red>Jenkins Location</font><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/ca9de6d6a8804980a4d2e38556d88705.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/e2d16418a1f14ca3a8988f355dc7e81c.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/c60e8c9508b64ea09da14785f0a25574.png" alt="" loading="lazy"></p>
<h2 id="åŸºäº-jenkins-è‡ªåŠ¨æ‰“åŒ…å¹¶éƒ¨ç½²-tomcat-ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#åŸºäº-jenkins-è‡ªåŠ¨æ‰“åŒ…å¹¶éƒ¨ç½²-tomcat-ç¯å¢ƒ" aria-hidden="true">#</a> åŸºäº Jenkins è‡ªåŠ¨æ‰“åŒ…å¹¶éƒ¨ç½² Tomcat ç¯å¢ƒ</h2>
<h3 id="ä¼ ç»Ÿç½‘ç«™éƒ¨ç½²çš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¼ ç»Ÿç½‘ç«™éƒ¨ç½²çš„æµç¨‹" aria-hidden="true">#</a> ä¼ ç»Ÿç½‘ç«™éƒ¨ç½²çš„æµç¨‹</h3>
<blockquote>
<p>â€ƒâ€ƒåœ¨è¿ç»´è¿‡ç¨‹ä¸­ï¼Œç½‘ç«™éƒ¨ç½²æ˜¯è¿ç»´çš„å·¥ä½œä¹‹ä¸€ã€‚ä¼ ç»Ÿçš„ç½‘ç«™éƒ¨ç½²çš„æµç¨‹å¤§è‡´åˆ†ä¸º:éœ€æ±‚åˆ†æ--&gt;åŸå‹è®¾è®¡--&gt;å¼€å‘ä»£ç --&gt;æäº¤ä»£ç --&gt;å†…ç½‘éƒ¨ç½²--&gt;å†…ç½‘æµ‹è¯•--&gt;ç¡®è®¤ä¸Šçº¿--&gt;å¤‡ä»½æ•°æ®--&gt;å¤–ç½‘æ›´æ–°--&gt;å¤–ç½‘æµ‹è¯•--&gt;å‘å¸ƒå®Œæˆã€‚å¦‚æœåœ¨å†…ç½‘æµ‹è¯•æ—¶å‘ç°ä»£ç æœ‰å¼‚å¸¸ï¼Œè¿”å›ä»£ç å¼€å‘äººå‘˜åå­—,è°ƒæ•´ä»£ç ï¼›å¦‚æœåœ¨å¤–ç½‘æµ‹è¯•æ—¶å‘ç°å¤–ç½‘éƒ¨ç½²çš„ä»£ç æœ‰å¼‚å¸¸ï¼Œå¯ä»¥åŠæ—¶è¿›è¡Œç½‘ç«™å›æ»šã€‚</p>
</blockquote>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/0e1de9e7a3f3449ea51afebec2c01efa.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/c9acdc7b28b1472eb27e3ee224475e1e.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<font color=teal>**ä¼ ç»Ÿä»£ç ä¸Šçº¿çš„è¿‡ç¨‹**</font><blockquote>
<p>â€ƒâ€ƒå¼€å‘äººå‘˜å‘èµ·ä»£ç ä¸Šçº¿çš„éœ€æ±‚ï¼ˆé‚®ä»¶é™„ä»¶ä¸­åŒ…å«å¼€å‘åšå¥½çš„ WAR æˆ–è€… JAR åŒ…ã€SQL æ–‡ä»¶ï¼‰--&gt;è¿ç»´äººå‘˜è¿æ¥çº¿ä¸Šè´Ÿè½½è°ƒåº¦å™¨ï¼ˆNginxï¼‰--&gt; éš”ç¦»ä¸€ç»„æœåŠ¡å™¨ï¼ˆTomcatï¼‰--&gt; è¿æ¥æœåŠ¡å™¨ï¼ˆTomcatï¼‰--&gt; å¤‡ä»½æ—§ä»£ç ï¼ˆtar æ‰“åŒ…ï¼‰--&gt; åˆ é™¤æ—§ä»£ç ç›®å½• --&gt; ä¸Šä¼ æ–°çš„ WAR åŒ… --&gt; å¤–ç½‘æµ‹è¯• --&gt; æµ‹è¯•ä¸é€šè¿‡åˆ™é€šè¿‡å¤‡ä»½å›æ»šä»£ç  --&gt; æµ‹è¯•é€šè¿‡åˆ™åˆ©ç”¨ rsync çš„è„šæœ¬æ¨é€ä»£ç åˆ°å…¶ä»–æœåŠ¡å™¨--&gt; ç»Ÿä¸€å¤–ç½‘æµ‹è¯• --&gt;è¿æ¥è°ƒåº¦å™¨æ¢å¤éš”ç¦»æœºåˆ¶ --&gt; éš”ç¦»å¦ä¸€ç»„æœåŠ¡å™¨å®æ–½ä¸Šçº¿æ­¥éª¤ --&gt; ä¸Šçº¿å®Œæˆã€‚</p>
</blockquote>
<h3 id="ä¸»æµç½‘ç«™éƒ¨ç½²çš„æµç¨‹" tabindex="-1"><a class="header-anchor" href="#ä¸»æµç½‘ç«™éƒ¨ç½²çš„æµç¨‹" aria-hidden="true">#</a> ä¸»æµç½‘ç«™éƒ¨ç½²çš„æµç¨‹</h3>
<blockquote>
<p>â€ƒâ€ƒç›®å‰ä¸»æµç½‘ç«™éƒ¨ç½²æ–¹æ³•ï¼šé€šè¿‡ Hudson/Jenkins å·¥å…·å¹³å°å®ç°å…¨è‡ªåŠ¨éƒ¨ç½²+æµ‹è¯•ï¼Œæ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„æŒç»­é›†æˆå¼•æ“ï¼Œå±äºå¼€æºè½¯ä»¶é¡¹ç›®ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå¼€æ”¾æ˜“ç”¨çš„è½¯ä»¶å¹³å°ï¼Œä½¿è½¯ä»¶çš„æŒç»­é›†æˆå˜æˆå¯èƒ½ã€‚Jenkins éå¸¸æ˜“äºå®‰è£…å’Œé…ç½®ï¼Œç®€å•æ˜“ç”¨ã€‚</p>
<ul>
<li>å¼€å‘äººå‘˜ï¼šå†™å¥½ä»£ç ï¼Œä¸éœ€è¦è‡ªå·±è¿›è¡Œæºç ç¼–è¯‘ã€æ‰“åŒ…ç­‰å·¥ä½œï¼Œç›´æ¥å°†ä»£ç åˆ†æ”¯å­˜æ”¾åœ¨SVNã€Git ä»“åº“å³å¯ã€‚</li>
<li>è¿ç»´äººå‘˜ï¼šå‡è½»äººå·¥å¹²é¢„çš„é”™è¯¯ç‡ï¼ŒåŒæ—¶è§£æ”¾è¿ç»´äººå‘˜ç¹æ‚çš„ä¸Šä¼ ä»£ç ã€æ‰‹åŠ¨å¤‡ä»½ã€æ›´æ–°ç­‰æ“ä½œã€‚</li>
<li>æµ‹è¯•äººå‘˜ï¼šå¯ä»¥é€šè¿‡ Jenkins è¿›è¡Œç®€å•çš„ä»£ç åŠç½‘ç«™æµ‹è¯•ã€‚</li>
</ul>
</blockquote>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/a6d999bd9fb647b4aadf67092587c348.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>â€ƒâ€ƒä»£ç ä»“åº“ä¸­æœ‰Jenkinså¯ç›´æ¥è¿›è¡Œæ‰“åŒ…å’Œéƒ¨ç½²ä¸éœ€è¦å¼€å‘äººå‘˜è¿›è¡Œæ‰“åŒ…,åªè¦é€‰æ‹©åˆ†æ”¯ä¸Šçš„ä»£ç éœ€è¦ä¸Šçº¿,ä¼šè‡ªåŠ¨æ‰“åŒ…å’Œæ„å»º.éƒ¨ç½²åœ¨å†…ç½‘æµ‹è¯•çš„æµ‹è¯•ç»“æœä¹Ÿä¼šåé¦ˆç»™å¼€å‘ã€‚</p>
<h2 id="jenkinså·¥ä½œåŸç†åŠå®éªŒå‡†å¤‡" tabindex="-1"><a class="header-anchor" href="#jenkinså·¥ä½œåŸç†åŠå®éªŒå‡†å¤‡" aria-hidden="true">#</a> Jenkinså·¥ä½œåŸç†åŠå®éªŒå‡†å¤‡</h2>
<blockquote>
<p>â€ƒâ€ƒJenkins çš„å·¥ä½œåŸç†æ˜¯å…ˆå°†æºä»£ç ä» SVN/Git ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­æ‹·è´ä¸€ä»½åˆ°æœ¬åœ°ï¼Œç„¶åæ ¹æ®è®¾ç½®çš„è„šæœ¬è°ƒç”¨ Maven è¿›è¡Œ buildï¼ˆæ„å»ºï¼‰ã€‚æ•´ä¸ªç³»ç»Ÿçš„å…³é”®å°±æ˜¯ build è„šæœ¬ï¼Œbuildè„šæœ¬å‘Šè¯‰ Jenkins åœ¨ä¸€æ¬¡é›†æˆä¸­éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p>
</blockquote>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/f55e3534b05d4bcc807c4199587fc0e1.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>1ã€å¼€å‘äººå‘˜å†™ä»£ç  å°†ä»£ç å¾€æœåŠ¡å™¨ä¸Šæ¨é€<br>
2ã€Jenkinsè´Ÿè´£ä»GitæœåŠ¡å™¨é‡Œé¢æ‹‰å–å¼€å‘äººå‘˜æäº¤çš„ä»£ç <br>
3ã€Jenkinsæ‹‰å–ä»£ç ä¹‹åä¼šå¯¹ä»£ç è¿›è¡Œä¸€ä¸ªæ„å»º,æœåŠ¡å™¨ä¸Šæ„å»ºåç›´æ¥éƒ¨ç½²åœ¨webä¸Š<br>
4ã€è€Œæˆ‘ä»¬ç”¨æˆ·éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯è®¿é—®web,å¯¹å…¶è¿›è¡Œä¸€ä¸ªæµ‹è¯•</p>
<p>é¦–å…ˆå‡†å¤‡ä¸‰å°æœåŠ¡å™¨</p>
<table>
<thead>
<tr>
<th>æ“ä½œç³»ç»Ÿ</th>
<th>IPåœ°å€</th>
<th>ä¸»æœºå</th>
<th>å‚ä¸è§’è‰²</th>
</tr>
</thead>
<tbody>
<tr>
<td>CentOS7.7</td>
<td>172.16.11.203</td>
<td>git</td>
<td>gitæœåŠ¡å™¨</td>
</tr>
<tr>
<td>CentOS7.7</td>
<td>172.16.11.202</td>
<td>jenkins</td>
<td>jenkinsæœåŠ¡å™¨</td>
</tr>
<tr>
<td>CentOS7.7</td>
<td>172.16.11.204</td>
<td>tomcat</td>
<td>tomcatæœåŠ¡å™¨</td>
</tr>
</tbody>
</table>
<p>å…¶æ¬¡å…³é—­é˜²ç«å¢™å’Œæ²™ç›’</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment">#å…³é—­é˜²ç«å¢™</span>
systemctl stop firewalld
iptables <span class="token parameter variable">-F</span>
<span class="token comment">#å…³é—­æ²™ç›’</span>
setenforce <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1ã€é…ç½®-git-ä¸»æœº" tabindex="-1"><a class="header-anchor" href="#_1ã€é…ç½®-git-ä¸»æœº" aria-hidden="true">#</a> 1ã€é…ç½® git ä¸»æœº</h3>
<p>å®‰è£… git å¹¶é…ç½® git ç”¨æˆ·ä¿¡æ¯</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment">#å®‰è£…git</span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># yum -y install git</span>

<span class="token comment">#æ·»åŠ gitç”¨æˆ·</span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># useradd git</span>

<span class="token comment">#gitè®¾ç½®å¯†ç </span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># echo "123456" | passwd --stdin git</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºæœ¬åœ°ä»“åº“ probe</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment">#åˆ‡æ¢åˆ°gitç”¨æˆ·</span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># su - git</span>
ä¸Šä¸€æ¬¡ç™»å½•ï¼šäº” <span class="token number">10</span> æœˆ <span class="token number">21</span> <span class="token number">15</span>:49:10 CST 2022pts/0 ä¸Š

<span class="token comment">#åˆ›å»ºprobe.gitç›®å½•</span>
<span class="token punctuation">[</span>git@git ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> probe.git

<span class="token comment">#åˆ‡æ¢åˆ°probe.gitç›®å½•</span>
<span class="token punctuation">[</span>git@git ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> probe.git

<span class="token comment">#åˆå§‹åŒ–ç©ºçš„ Git ç‰ˆæœ¬åº“äº /home/git/probe.git/</span>
<span class="token punctuation">[</span>git@git probe.git<span class="token punctuation">]</span>$ <span class="token function">git</span> <span class="token parameter variable">--bare</span> init

<span class="token comment">#é€€å‡ºgitç”¨æˆ·</span>
<span class="token punctuation">[</span>git@git probe.git<span class="token punctuation">]</span>$ <span class="token builtin class-name">exit</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…‹éš†é¡¹ç›®ä»£ç åŒæ­¥åˆ°è‡ªå·±åˆ›å»ºçš„ä»“åº“ä¸­</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># git clone https://github.com/psi-probe/psi-probe</span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># git clone git@172.16.11.203:/home/git/probe.git</span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># cp -rf psi-probe/* probe/</span>
<span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># cd probe/</span>
<span class="token punctuation">[</span>root@git probe<span class="token punctuation">]</span><span class="token comment"># git add . </span>

<span class="token comment">#æ–°å®‰è£…çš„gitè¦é…ç½®ç›¸å…³ä¿¡æ¯</span>
<span class="token punctuation">[</span>root@git probe<span class="token punctuation">]</span><span class="token comment"># git config --global user.email "admin@163.com"</span>
<span class="token punctuation">[</span>root@git probe<span class="token punctuation">]</span><span class="token comment"># git config --global user.name "admin"</span>
<span class="token punctuation">[</span>root@git probe<span class="token punctuation">]</span><span class="token comment"># git commit -m "all probe"</span>
<span class="token punctuation">[</span>root@git probe<span class="token punctuation">]</span><span class="token comment"># git push origin master</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€é…ç½®-jenkins-ä¸»æœº" tabindex="-1"><a class="header-anchor" href="#_2ã€é…ç½®-jenkins-ä¸»æœº" aria-hidden="true">#</a> 2ã€é…ç½® jenkins ä¸»æœº</h3>
<p>â‘  ç»™Jenkinsæ·»åŠ éªŒè¯å‡­æ®<br>
åœ¨ Jenkins çš„é¦–é¡µä¸­ç‚¹å‡»â€œ<font color=red>å‡­æ®</font>â€è¿›å…¥å‡­æ®é¡µé¢ï¼›<br>
æ³¨ï¼šæœ‰æ˜¯ç‰ˆæœ¬ä¸ä¸€æ ·ï¼Œä½ç½®ä¸ä¸€æ ·ï¼Œæ ¹æ®è‡ªå·±çš„å®é™…ç‰ˆæœ¬æ¥å®šï¼›</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/b5501484432b4864a546a22c05239733.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>åœ¨å‡­æ®é¡µé¢ä¸­ï¼Œç‚¹å‡»â€œJenkinsâ€è·³è½¬åˆ°â€œç³»ç»Ÿâ€é¡µé¢ã€‚ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ä¸­â€œæ·»åŠ åŸŸâ€ï¼Œè·³è½¬åˆ°â€œæ·»åŠ åŸŸâ€é¡µé¢ã€‚åœ¨è¯¥é¡µé¢åˆ›å»ºåŸŸåä¸ºâ€œcrushlinuxâ€å¹¶ç‚¹å‡»â€œokâ€å®Œæˆé…ç½®ã€‚</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/0ceb65ac9724444386fefb2645e5d758.png" alt="" loading="lazy"><br>
åœ¨æ·»åŠ åŸŸé‡Œé¢æ·»åŠ çš„ç”¨æˆ·åçš„å¯†ç æ˜¯webæœåŠ¡å™¨çš„<br>
Jenkinsè¦å¾€webæœåŠ¡å™¨ä¸Šé¢å»éƒ¨ç½²,æ‰€ä»¥Jenkinsè¦æœ‰æƒé™å»è¿œç¨‹è¿æ¥webæœåŠ¡å™¨</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/4b8a3964fa7247fab871e3d91296d02c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ä¸­çš„â€œæ·»åŠ å‡­æ®â€ã€‚</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/07a62894b8934b61b6afc09446839d2a.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/467bea9c13154a58966118bec6e302af.png" alt="" loading="lazy"></p>
<p>å¡«å†™ä»¥ä¸Šæ•°æ®åï¼Œç‚¹å‡»â€œç¡®å®šâ€å°±å¯ä»¥æŸ¥çœ‹åˆ°æ–°å¢çš„è¿œç¨‹ web ä¸»æœºè´¦å·ã€‚</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/a8e353a8c076438f91afa937451d525a.png" alt="" loading="lazy"><br>
â‘¡ æ·»åŠ  Publish Over SSH è¿œç¨‹ä¸»æœº<br>
åœ¨ä¸»æœºåä¸º <font color=red>web</font> çš„ä¸»æœºä¸Šä¸Šåˆ›å»ºè¿œç¨‹ç›®å½•ã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment">#ç›®å½•çš„ä½œç”¨jenkinså°±æ˜¯åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># mkdir /data</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>â€ƒâ€ƒåœ¨ Jenkins é¦–é¡µä¸­ç‚¹å‡»â€œManage Jenkinsâ€-&gt;â€œConfigure Systemâ€-â€œPublish overSSHâ€-&gt;â€œSSH Serversâ€-&gt;â€œå¢åŠ â€é€‰é¡¹æŒ‰é’®ï¼Œæ·»åŠ  SSH è¿œç¨‹ä¸»æœºã€‚å¦‚å›¾ 3.13 æ‰€ç¤ºï¼Œè¾“å…¥ Nameã€Hostnameã€Username ç­‰å¿…è¦ä¿¡æ¯åï¼Œç‚¹å‡»â€œé«˜çº§â€é€‰é¡¹æŒ‰é’®-&gt;å‹¾é€‰â€œUse Passwordauthentication,or use a different keyâ€é€‰é¡¹-&gt;è¾“å…¥â€œè¿œç¨‹ä¸»æœºç™»å½•å¯†ç â€-&gt;â€œTestConfigurationâ€æµ‹è¯•è¿œç¨‹ä¸»æœºé…ç½®ã€‚æµ‹è¯•è¿œç¨‹ä¸»æœºé…ç½®æˆåŠŸåç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®å³å¯ã€‚</p>
</blockquote>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/ffc515317d4b40c2bcaa887f6970f932.png" alt="" loading="lazy"><br>
<img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/5049adc621bd45319bcd3ff09b4f4cd1.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/b09ad61c7a984e0db8455aee1d25dd58.png" alt="" loading="lazy"></p>
<p>â‘¢ é…ç½® Mavenã€JDKã€Git ç¯å¢ƒ<br>
Jenkinséœ€è¦æ„å»ºä»»åŠ¡è¿˜è¦å»é…ç½®Maven JDK Git é›†æˆçš„å·¥å…·</p>
<blockquote>
<p>â€ƒâ€ƒåœ¨ Jenkins é¦–é¡µä¸­ç‚¹å‡»â€œManage Jenkinsâ€-&gt;â€œGlobal Tool Configurationâ€-&gt;â€œJDKâ€-&gt;æ–°å¢â€œJDKâ€ï¼Œè®¾ç½® JDK åˆ«åä¸ºâ€JDK1.8â€ã€‚å»æ‰â€œInstall automaticallyâ€é€‰é¡¹ï¼Œè®¾ç½® â€œJAVA_HOMEâ€ä¸ºæœ¬æ¡ˆä¾‹ä¸­ JDK å®é™…å®‰è£…è·¯å¾„ã€‚</p>
</blockquote>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># tar xf jdk-8u191-linux-x64.tar.gz</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># mv jdk1.8.0_191/ /usr/local/java</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/profile</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/java/
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/lib/tools.jar:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /usr/bin/java</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># java -version</span>
<span class="token function">java</span> version <span class="token string">"1.8.0_191"</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_191-b12<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.191</span>-b12, mixed mode<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/b6a627195fd14c9dbf4b1ff2eafcea3e.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/9fbcfb59dc5a42bfb4f7ff05582a3e0a.png" alt="" loading="lazy"></p>
<p>â€ƒâ€ƒåœ¨â€œGlobal Tool Configurationâ€é…ç½®ç•Œé¢ä¸­æ‰¾åˆ° Maven é…ç½®é€‰é¡¹ï¼Œç„¶åç‚¹å‡»â€œæ–°å¢Mavenâ€å¹¶è®¾ç½®åˆ«åä¸ºâ€œMaven3.5â€ã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># tar xf apache-maven-3.5.0-bin.tar.gz</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># mv apache-maven-3.5.0 /usr/local/maven-3.5.0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸º maven æ›´æ¢é˜¿é‡Œäº‘é•œåƒç«™</p>
<p>åœ¨è¿›è¡Œæ‰“åŒ…çš„æ—¶å€™Mavenä¼šä¸‹è½½å¾ˆå¤šçš„jaråŒ…é»˜è®¤çš„ä¸‹è½½çš„åœ°å€æ˜¯apacheå®˜ç½‘åœ°å€  ä¼šä¸‹è½½å¾ˆæ…¢æ›´æ”¹Mavençš„ä¸‹è½½åœ°å€</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># vim /usr/local/maven-3.5.0/conf/settings.xml</span>
	<span class="token operator">&lt;</span>mirror<span class="token operator">></span>
		<span class="token operator">&lt;</span>id<span class="token operator">></span>nexus-aliyun<span class="token operator">&lt;</span>/id<span class="token operator">></span>
		<span class="token operator">&lt;</span>mirrorOf<span class="token operator">></span>central<span class="token operator">&lt;</span>/mirrorOf<span class="token operator">></span>
		<span class="token operator">&lt;</span>name<span class="token operator">></span>Nexus aliyun<span class="token operator">&lt;</span>/name<span class="token operator">></span>
		<span class="token operator">&lt;</span>url<span class="token operator">></span>http://maven.aliyun.com/nexus/content/groups/public<span class="token operator">&lt;</span>/url<span class="token operator">></span>
	<span class="token operator">&lt;</span>/mirror<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹‹åå¯èƒ½ä¼šæŠ¥é”™ï¼Œå¯ä»¥ä½¿ç”¨å…ˆä½¿ç”¨apacheå®˜ç½‘ä¸‹è½½åœ°è´¨ä¸‹è½½jaråŒ…</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/310a8292ff074fb4834db827c7697074.png" alt="" loading="lazy"><br>
Git é…ç½®</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># which git</span>
/usr/bin/git
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/dfae6c3f292f4c9e83f973a179a829bf.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>ä»¥ä¸Šå…¨å±€åŸºæœ¬é…ç½®å®Œæ¯•åï¼Œç‚¹å‡»ä¿å­˜å³å¯å®Œæˆã€‚</p>
<h3 id="_3ã€é…ç½®-web-ä¸»æœº" tabindex="-1"><a class="header-anchor" href="#_3ã€é…ç½®-web-ä¸»æœº" aria-hidden="true">#</a> 3ã€é…ç½® web ä¸»æœº</h3>
<p>éƒ¨ç½²web   éƒ¨ç½²ä¸€ä¸ªJavaçš„é¡¹ç›®æ‰€ä»¥è¦éƒ¨ç½²tomcat</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># tar xf apache-tomcat-8.5.16.tar.gz</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># tar xf jdk-8u191-linux-x64.tar.gz</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># mv jdk1.8.0_191/ /usr/local/java</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># mv apache-tomcat-8.5.16 /usr/local/tomcat</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/profile</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/java/
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/lib/tools.jar:<span class="token variable">$JAVA_HOME</span>/lib/dt.jar
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># java -version</span>
<span class="token function">java</span> version <span class="token string">"1.8.0_191"</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_191-b12<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.191</span>-b12, mixed mode<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å‘å¸ƒå…¬é’¥ç»™ jenkins ä¸»æœº</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id 172.16.11.202</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>webä¸»æœºå°†å…¬é’¥å‘é€ç»™Jenkins</p>
<h3 id="_4ã€æ–°å»º-maven-é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_4ã€æ–°å»º-maven-é¡¹ç›®" aria-hidden="true">#</a> 4ã€æ–°å»º Maven é¡¹ç›®</h3>
<p>â€ƒâ€ƒåœ¨ä»¥ä¸Šé…ç½®å®Œæˆåï¼Œå›åˆ° Jenkins é¦–é¡µï¼Œé€‰æ‹©â€œæ–°å»ºä»»åŠ¡â€ï¼Œç„¶åè¾“å…¥ä¸€ä¸ªä»»åŠ¡åç§°â€œprobeâ€ï¼Œå¹¶é€‰ä¸­â€œMaven projectâ€ç‚¹å‡»å½“å‰é¡µé¢ä¸‹æ–¹çš„â€œç¡®å®šâ€æŒ‰é’®ã€‚</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/ba446e99d12640dbaf94928c504982b0.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/a2086736504c46de9f5bd13d6b1e05aa.png" alt="" loading="lazy"></p>
<p>åœ¨ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®åï¼Œé€‰æ‹©â€œæºç ç®¡ç†â€é€‰ä¸­â€œGitâ€,é…ç½®â€œRepositoriesURLâ€ä¸ºgit@172.16.11.203:/home/git/probe.g</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/9531bf1d66204f0f848f829e515c5298.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>ä¸»æœº Jenkins é»˜è®¤ç”¨ jenkins ç”¨æˆ·å»è¿æ¥ gitï¼Œæ‰€ä»¥ç”¨ jenkins ç”¨æˆ·ç”Ÿæˆå¯†é’¥å¯¹ï¼Œå¹¶å‘é€ç»™ gitã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># id jenkins</span>
<span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">988</span><span class="token punctuation">(</span>jenkins<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">982</span><span class="token punctuation">(</span>jenkins<span class="token punctuation">)</span> ç»„<span class="token operator">=</span><span class="token number">982</span><span class="token punctuation">(</span>jenkins<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># su -s /bin/bash jenkins</span>
bash-4.2$ ssh-keygen
bash-4.2$ ssh-copy-id git@172.16.11.203
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Jenkinså°†å…¬é’¥æ–‡ä»¶å‘é€ç»™gitç”¨æˆ·ï¼›æˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯Jenkinsè¿è¡Œæ˜¯ä¸€ä¸ªç¨‹åºç”¨æˆ·ï¼Œæ— æ³•ç™»å½•çš„æˆ‘ä»¬è¦-s æŒ‡å®š/bin/bash å°†ç§˜é’¥å¯¹å‘é€ç»™æŒ‡å®šçš„git ç”¨æˆ·ï¼›</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/fe51e67d200c42e3ae7f44f60f9b63d0.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/a7693fd32be842e182ec0aaf3a59be3d.png" alt="" loading="lazy"></p>
<p>é€‰æ‹©â€œæ„å»ºåæ“ä½œâ€œä¸­çš„â€œsend build artfacts over SSHâ€ â€œExec commandâ€ä¸­æ‰§è¡Œå‘½ä»¤çš„å«ä¹‰æ˜¯:åœ¨è‡ªåŠ¨éƒ¨ç½²å‰å…ˆæ€æ‰ Tomcat è¿›ç¨‹ï¼Œç„¶ååˆ é™¤ war åŒ…ï¼Œç”¨ scp è¿œç¨‹æ‹·è´å‘½ä»¤å°†Jenkins è‡ªåŠ¨æ‰“åŒ…å¥½çš„é¡¹ç›® war åŒ…æ‹·è´åˆ°å½“å‰ Tomcat åº”ç”¨ç›®å½•ã€‚ ç„¶åé‡å¯ Tomcat ã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token function">scp</span> <span class="token number">172.16</span>.11.202:/var/lib/jenkins/workspace/probe/psi-probe-web/target/probe.war
/usr/local/tomcat/webapps/
/usr/local/tomcat/bin/startup.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°†Jenkinsçš„waråŒ…æ¨é€åˆ°tomcatçš„webappsç›®å½•ä¸‹è‡ªåŠ¨è§£å‹</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/1e064921f15547118cd6beefdbf1bbd4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>â€ƒâ€ƒä»¥ä¸Šå…¨éƒ¨é…ç½®å®Œæˆåï¼Œç‚¹å‡»ä¿å­˜å³å¯ã€‚ç„¶åç‚¹å‡»åˆšæ‰åˆ›å»ºçš„â€œprobeâ€-&gt;â€œBuild Nowâ€ç›´è‡³é¡¹ç›®æ„å»ºå®Œæˆã€‚æ„å»ºè¿‡ç¨‹å¯ä»¥åœ¨â€œæ§åˆ¶å°è¾“å‡ºâ€ä¸­æŸ¥çœ‹åˆ°ã€‚</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/cc0ff45a0cba4c3fa6ac1bc0aa93a84f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/c97a4bda21064866932f00524253c3b6.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/1577f744013b40b6a572524cb3077545.png" alt="" loading="lazy"></p>
<h3 id="_5ã€éªŒè¯-jenkins-è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²ç»“æœ" tabindex="-1"><a class="header-anchor" href="#_5ã€éªŒè¯-jenkins-è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²ç»“æœ" aria-hidden="true">#</a> 5ã€éªŒè¯ Jenkins è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²ç»“æœ</h3>
<p>åœ¨ web ä¸»æœºä¸ŠæŸ¥çœ‹ probe ç›®å½•æ˜¯å¦è¢«æ‹·è´åˆ°/usr/local/tomcat/webapps ç›®å½•ä¸‹</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># ls /usr/local/tomcat/webapps/</span>
docs examples host-manager manager probe probe.war ROOT
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># ls /usr/local/tomcat/webapps/probe -l</span>
æ€»ç”¨é‡ <span class="token number">20</span>
drwxr-x--- <span class="token number">3</span> root root <span class="token number">66</span> <span class="token number">6</span> æœˆ <span class="token number">20</span> <span class="token number">12</span>:12 css
drwxr-x--- <span class="token number">2</span> root root <span class="token number">8192</span> <span class="token number">6</span> æœˆ <span class="token number">20</span> <span class="token number">12</span>:12 flags
-rw-r----- <span class="token number">1</span> root root <span class="token number">536</span> <span class="token number">6</span> æœˆ <span class="token number">20</span> 09:55 index.jsp
drwxr-x--- <span class="token number">3</span> root root <span class="token number">148</span> <span class="token number">6</span> æœˆ <span class="token number">20</span> <span class="token number">12</span>:12 js
drwxr-x--- <span class="token number">3</span> root root <span class="token number">76</span> <span class="token number">6</span> æœˆ <span class="token number">20</span> <span class="token number">12</span>:12 META-INF
drwxr-x--- <span class="token number">6</span> root root <span class="token number">4096</span> <span class="token number">6</span> æœˆ <span class="token number">20</span> <span class="token number">12</span>:12 WEB-INF
ä»ä»¥ä¸Šç»“æœæ¥çœ‹ï¼ŒJenkins å·²æŠŠæ‰“å¥½çš„ probe war åŒ…æ‹·è´è¿‡æ¥äº†ã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»æ„å»ºåçš„æ‰§è¡Œå‘½ä»¤å¯ä»¥çœ‹å‡ºï¼ŒTomcat å·²ç»é‡æ–°å¯åŠ¨ï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯• probe ç›‘æ§ç³»ç»Ÿã€‚<a href="http://172.16.11.204:8080/probe%E3%80%82" target="_blank" rel="noopener noreferrer">http://172.16.11.204:8080/probeã€‚<ExternalLinkIcon/></a></p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/48bfabbd45b9427699338c1b235d0214.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># vim /usr/local/tomcat/conf/tomcat-users.xml</span>
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"manager-gui"</span>/<span class="token operator">></span>
<span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"admin-gui"</span>/<span class="token operator">></span>
<span class="token operator">&lt;</span>user <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"tomcat"</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"tomcat"</span> <span class="token assign-left variable">roles</span><span class="token operator">=</span><span class="token string">"manager-gui,admin-gui"</span>/<span class="token operator">></span>
<span class="token operator">&lt;</span>/tomcat-users<span class="token operator">></span> <span class="token comment"># åœ¨æ­¤è¡Œå‰åŠ å…¥ä¸Šé¢ä¸‰è¡Œ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># vim /usr/local/tomcat/webapps/manager/META-INF/context.xml</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>-- <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.RemoteAddrValve"</span> <span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1"</span> /<span class="token operator">></span> --<span class="token operator">></span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># /usr/local/tomcat/bin/shutdown.sh</span>
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># /usr/local/tomcat/bin/startup.sh</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/9bc10a1d18b442a8a758d6b9828daf40.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>è‡³æ­¤ï¼ŒJenkins è‡ªåŠ¨æ‰“åŒ…éƒ¨ç½²å®Œæ¯•ã€‚</p>
<h2 id="åŸºäº-jenkins-è‡ªåŠ¨æ‰“åŒ…å¹¶éƒ¨ç½²-docker-ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#åŸºäº-jenkins-è‡ªåŠ¨æ‰“åŒ…å¹¶éƒ¨ç½²-docker-ç¯å¢ƒ" aria-hidden="true">#</a> åŸºäº Jenkins è‡ªåŠ¨æ‰“åŒ…å¹¶éƒ¨ç½² docker ç¯å¢ƒ</h2>
<h3 id="_1ã€å®‰è£…-docker-ce" tabindex="-1"><a class="header-anchor" href="#_1ã€å®‰è£…-docker-ce" aria-hidden="true">#</a> 1ã€å®‰è£… docker-ce</h3>
<p>åœ¨ 172.16.11.204æœºå™¨ä¸Šï¼Œæ„å»º tomcat åŸºç¡€é•œåƒã€‚åœ¨æ„å»ºåŸºç¡€é•œåƒä¹‹å‰éœ€è¦å…ˆå®‰è£… Dockerä¸ JDKã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo</span>
http://mirrors.aliyun.com/repo/Centos-7.repo
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># yum -y install yum-utils device-mapper-persistent-data lvm2</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># yum-config-manager --add-repo</span>
http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># ls /etc/yum.repos.d/</span>
backup CentOS-Base.repo CentOS-Media.repo docker-ce.repo

<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># yum -y install docker-ce</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl start docker</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable docker</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker version</span>
Client:
Version: <span class="token number">18.09</span>.6
API version: <span class="token number">1.39</span>
Go version: go1.10.8
Git commit: 481bc77156
Built: Sat May <span class="token number">4</span> 02:34:58 <span class="token number">2019</span>
OS/Arch: linux/amd64
Experimental: <span class="token boolean">false</span>
Server: Docker Engine - Community
Engine:
Version: <span class="token number">18.09</span>.6
API version: <span class="token number">1.39</span> <span class="token punctuation">(</span>minimum version <span class="token number">1.12</span><span class="token punctuation">)</span>
Go version: go1.10.8
Git commit: 481bc77
Built: Sat May <span class="token number">4</span> 02:02:43 <span class="token number">2019</span>
OS/Arch: linux/amd64
Experimental: false/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2ã€é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨" tabindex="-1"><a class="header-anchor" href="#_2ã€é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨" aria-hidden="true">#</a> 2ã€é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨</h3>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># cat &lt;&lt; END > /etc/docker/daemon.json</span>
<span class="token punctuation">{</span> <span class="token string">"registry-mirrors"</span>:<span class="token punctuation">[</span> <span class="token string">"https://nyakyfun.mirror.aliyuncs.com"</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
END
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># cat centos-7-x86_64.tar.gz | docker import - centos:7</span>
sha256:58584b57ef9c5545816baaf39dd089d04c671c9faa1414e85fa245b167416603
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY TAG IMAGE ID CREATED
SIZE
centos <span class="token number">7</span> 58584b57ef9c <span class="token number">11</span> seconds ago
589MB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3ã€æ„å»º-tomcat-åŸºç¡€é•œåƒ" tabindex="-1"><a class="header-anchor" href="#_3ã€æ„å»º-tomcat-åŸºç¡€é•œåƒ" aria-hidden="true">#</a> 3ã€æ„å»º tomcat åŸºç¡€é•œåƒ</h3>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># mkdir docker-tomcat</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># cd docker-tomcat</span>
<span class="token punctuation">[</span>root@docker docker-tomcat<span class="token punctuation">]</span><span class="token comment"># ls</span>
apache-tomcat-8.5.16.tar.gz jdk-8u191-linux-x64.tar.gz
<span class="token punctuation">[</span>root@docker docker-tomcat<span class="token punctuation">]</span><span class="token comment"># cat Dockerfile</span>
FROM centos:7
MAINTAINER from crushlinux <span class="token operator">&lt;</span>crushlinux@163.com<span class="token operator">></span>
<span class="token comment">#copy jdk and tomcat into image</span>
ADD ./apache-tomcat-8.5.16.tar.gz /usr/local/
ADD ./jdk-8u191-linux-x64.tar.gz /usr/local
<span class="token comment">#set variable</span>
ENV JAVA_HOME /usr/local/jdk1.8.0_191
ENV <span class="token environment constant">PATH</span> <span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token comment">#container starts up</span>
ENTRYPOINT /usr/local/apache-tomcat-8.5.16/bin/startup.sh <span class="token operator">&amp;&amp;</span> <span class="token function">tail</span> <span class="token parameter variable">-F</span>
/usr/local/apache-tomcat-8.5.16/logs/catalina.out
<span class="token punctuation">[</span>root@docker docker-tomcat<span class="token punctuation">]</span><span class="token comment"># docker build -t tomcat:v1 . [root@docker docker-tomcat]# docker images</span>
REPOSITORY TAG IMAGE ID CREATED
SIZE
tomcat v1 1f25cb55c54b <span class="token number">23</span> seconds ago
999MB
centos <span class="token number">7</span> 58584b57ef9c <span class="token number">8</span> minutes ago
589MB
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4ã€æ„å»ºä¸€ä¸ª-maven-é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#_4ã€æ„å»ºä¸€ä¸ª-maven-é¡¹ç›®" aria-hidden="true">#</a> 4ã€æ„å»ºä¸€ä¸ª Maven é¡¹ç›®</h3>
<p>åœ¨ä»¥ä¸Šé…ç½®å®Œæˆåï¼Œå›åˆ° Jenkins é¦–é¡µï¼Œé€‰æ‹©â€œæ–°å»ºä»»åŠ¡â€ï¼Œç„¶åè¾“å…¥ä¸€ä¸ªä»»åŠ¡åç§°â€œprobe-dockerâ€ï¼Œå¹¶é€‰æ‹©â€œMaven projectâ€é…ç½®é¡¹ï¼Œç‚¹å‡»å½“å‰é¡µé¢ä¸‹æ–¹çš„â€œç¡®å®šâ€æŒ‰é’®ã€‚</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/ff31479639bc4487a164c97bd147c9de.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>åœ¨ç‚¹å‡»â€œç¡®å®šâ€æŒ‰é’®ï¼Œé€‰æ‹©â€œæºç ç®¡ç†â€å¹¶é€‰ä¸­â€œGitâ€,è®¾ç½®â€œRepository URLâ€åœ°å€ã€‚</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/d9de0fe87e814d16b8632b1a41575683.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>é€‰æ‹©â€œBuildâ€-&gt; clean package -Dmaven.test.skip=true</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/87414ec4de184fb694c46dc2b9541de3.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>åœ¨ä¸Šä¸€æ­¥åé¢é€‰æ‹©â€œæ„å»ºåæ“ä½œâ€ä¸­çš„â€œSend build artfacts over SSHâ€é€‰é¡¹å¹¶è¿›è¡Œã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token function">scp</span> <span class="token number">172.16</span>.11.202: /var/lib/jenkins/workspace/probe/psi-probe-web/target/probe.war /data/
<span class="token function">docker</span> run <span class="token parameter variable">-itd</span> <span class="token parameter variable">--name</span> tomcat-test <span class="token parameter variable">-p</span> <span class="token number">8090</span>:8080 <span class="token parameter variable">-v</span> /data:/usr/local/apache-tomcat-8.5.16/webapps tomcat:v1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/898a8efe06b948f0b81711f9aca80d3c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>â€ƒâ€ƒä»¥ä¸Šå…¨éƒ¨é…ç½®å®Œæˆåï¼Œç‚¹å‡»ä¿å­˜å³å¯ã€‚ç„¶åç‚¹å‡»åˆšæ‰åˆ›å»ºçš„å·¥ç¨‹ä»»åŠ¡â€œprobe-docker â€œ-&gt;â€ Build newâ€ç›´è‡³ä»»åŠ¡æ„å»ºå®Œæˆã€‚å¼€å§‹æ„å»ºè¿‡ç¨‹ä¸­å¯ä»¥ç‚¹å‡»è¿›åº¦æ¡æŸ¥çœ‹</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/ac1649f7f969422f92b76e35770f9df2.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>â€ƒâ€ƒå¯ä»¥çœ‹åˆ°æ­¤å·¥ç¨‹ä»»åŠ¡å·²æ„å»ºæˆåŠŸï¼Œå¹¶ä¸”åœ¨æ„å»ºåï¼Œåˆ›å»ºç”¨äº docker é¡¹ç›®çš„ Docker Webç¯å¢ƒå‘½ä»¤ä¹Ÿæ‰§è¡ŒæˆåŠŸã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># ls /data/</span>
probe probe.war
<span class="token punctuation">[</span>root@tomcat ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID IMAGE COMMAND CREATED
STATUS PORTS
NAMESac8fefaac75f tomcat:v1 <span class="token string">"/bin/sh -c '/usr/loâ€¦"</span> <span class="token number">39</span>
seconds ago Up <span class="token number">37</span> seconds <span class="token number">0.0</span>.0.0:8090-<span class="token operator">></span><span class="token number">808</span>
<span class="token number">0</span>/tcp tomcat-test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/eec5312712d9417a8f7645fbdbe5474f.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2 id="åŸºäº-jenkins-è‡ªåŠ¨åŒ–éƒ¨ç½²-php-ç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#åŸºäº-jenkins-è‡ªåŠ¨åŒ–éƒ¨ç½²-php-ç¯å¢ƒ" aria-hidden="true">#</a> åŸºäº Jenkins è‡ªåŠ¨åŒ–éƒ¨ç½² PHP ç¯å¢ƒ</h2>
<p>å‡†å¤‡ git ä»“åº“</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># su - git</span>
ä¸Šä¸€æ¬¡ç™»å½•ï¼šäº” <span class="token number">10</span> æœˆ <span class="token number">21</span> <span class="token number">11</span>:40:59 CST 2022pts/0 ä¸Š
<span class="token punctuation">[</span>git@git ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> php.git
<span class="token punctuation">[</span>git@git ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">cd</span> php.git
<span class="token punctuation">[</span>git@git php.git<span class="token punctuation">]</span>$ <span class="token function">git</span> <span class="token parameter variable">--bare</span> init
åˆå§‹åŒ–ç©ºçš„ Git ç‰ˆæœ¬åº“äº /home/git/php.git/
<span class="token punctuation">[</span>git@git php.git<span class="token punctuation">]</span>$ <span class="token builtin class-name">exit</span>
ç™»å‡º
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šä¼ ä»£ç åˆ°ä»“åº“</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@git ~<span class="token punctuation">]</span><span class="token comment"># git clone git@172.16.11.203:/home/git/php.git</span>
æ­£å…‹éš†åˆ° <span class="token string">'php'</span><span class="token punctuation">..</span>. git@172.16.11.203<span class="token string">'s password:
warning: æ‚¨ä¼¼ä¹å…‹éš†äº†ä¸€ä¸ªç©ºç‰ˆæœ¬åº“ã€‚
[root@git ~]# cd php/
[root@git php]# cat &lt;&lt; EOF > index.php
&lt;?php
phpinfo();
?>
EOF
[root@git php]# git add . [root@git php]# git commit -m "all"
[masterï¼ˆæ ¹æäº¤ï¼‰ 4ec0ba3] all
1 file changed, 3 insertions(+)
create mode 100644 index.php
[root@git php]# git push origin master
git@192.168.200.111'</span>s password:
Counting objects: <span class="token number">3</span>, done. Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">3</span>/3<span class="token punctuation">)</span>, <span class="token number">218</span> bytes <span class="token operator">|</span> <span class="token number">0</span> bytes/s, done. Total <span class="token number">3</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>
To git@172.16.11.203:/home/git/php.git * <span class="token punctuation">[</span>new branch<span class="token punctuation">]</span> master -<span class="token operator">></span> master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>éƒ¨ç½² web ä¸»æœºç¯å¢ƒ</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@web ~<span class="token punctuation">]</span><span class="token comment"># yum install -y httpd mariadb-server mariadb mariadb-devel php php-mysql</span>
<span class="token punctuation">[</span>root@web ~<span class="token punctuation">]</span><span class="token comment"># systemctl start httpd</span>
<span class="token punctuation">[</span>root@web ~<span class="token punctuation">]</span><span class="token comment"># systemctl start mariadb</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/838544d4119f4096be8a5803b722762e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Jenkins ä¸»æœºå°†å¯†é’¥å‘å¸ƒåˆ° web ä¸»æœº</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># su -s /bin/bash jenkins</span>
bash-4.2$ ssh-keygen
bash-4.2$ ssh-copy-id root@172.16.11.204
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åŸºäº-rsync-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#åŸºäº-rsync-éƒ¨ç½²" aria-hidden="true">#</a> åŸºäº rsync éƒ¨ç½²</h3>
<p>åˆ›å»ºä¸€ä¸ª Freestyle project</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/e4cc7fc51d7840228ed59865513edf2b.png" alt="" loading="lazy"><br>
<img src="https://img-blog.csdnimg.cn/1d80709ea27e4a8e88fbd460880c2b28.png" alt="" loading="lazy"></p>
<p>rsync -avz --delete * <a href="mailto:root@172.16.11.204">root@172.16.11.204</a>:/var/www/html/</p>
<p><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/1102e0d66a734268b4b16c1bee00c7bc.png" alt="" loading="lazy"><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/f3db1eaa744143929e1bfc40a866203a.png" alt="" loading="lazy"></p>
<div class="language-php line-numbers-mode" data-ext="php"><pre v-pre class="language-php"><code>[root@web ~]# ls /var/www/html/
index.php
[root@web ~]# cat /var/www/html/index.php
<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token delimiter important">?></span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/d14b53d15ba1471982d36e47e41fb372.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3 id="åŸºäº-ansible-éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#åŸºäº-ansible-éƒ¨ç½²" aria-hidden="true">#</a> åŸºäº ansible éƒ¨ç½²</h3>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># rpm -ivh epel-release-latest-7.noarch.rpm</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># yum -y install ansible</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/hosts</span>
<span class="token punctuation">[</span>webserver<span class="token punctuation">]</span>
<span class="token number">172.16</span>.11.204
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¿®æ”¹ jenkins è¿è¡Œç”¨æˆ·</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/sysconfig/jenkins</span>
<span class="token assign-left variable">JENKINS_USER</span><span class="token operator">=</span><span class="token string">"root"</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># /etc/init.d/jenkins restart</span>
Restarting jenkins <span class="token punctuation">(</span>via systemctl<span class="token punctuation">)</span>: <span class="token punctuation">[</span> ç¡®å®š <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ·»åŠ  Ansible æ’ä»¶</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/276415ca9f1641cabd97149518592521.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/58b6523db71e4a73a30ada20619689da.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/bf876d2e58ac486b9937291b21f4b7c5.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/b1164e81748b41109332d8acf5778fa0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># ssh-keygen</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id git@172.16.11.203</span>
<span class="token punctuation">[</span>root@jenkins ~<span class="token punctuation">]</span><span class="token comment"># ssh-copy-id root@172.16.11.204</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/41f1d3469f5545b38da90194049c2838.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>src=${WORKSPACE} dest=/var/www/html rsync_opts=--exclude=.git</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/6d01660b31004f7ab1782b541a049bd0.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/a3508fd728db41ff9102045916515c6e.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@web ~<span class="token punctuation">]</span><span class="token comment"># cat /var/www/html/php-ansible/index.php</span>
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/c6a132d5ac664d5da1202a35d9b06fc4.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>è‡³æ­¤æ‰€æœ‰å°±å®Œæˆäº†ï¼›</p>
</div></template>


