<template><div><blockquote>
<p>🍁<strong>博主简介</strong></p>
<p>  🏅<a href="https://blog.csdn.net/liu_chen_yang?type=blog" target="_blank" rel="noopener noreferrer">云计算领域优质创作者</a><br>
  🏅<a href="https://bbs.huaweicloud.com/community/myblog" target="_blank" rel="noopener noreferrer">华为云开发者社区专家博主</a><br>
  🏅<a href="https://developer.aliyun.com/my?spm=a2c6h.13148508.setting.3.21fc4f0eCmz1v3#/article?_k=zooqoz" target="_blank" rel="noopener noreferrer">阿里云开发者社区专家博主</a><br>
💊<strong>交流社区：</strong><a href="https://bbs.csdn.net/forums/lcy" target="_blank" rel="noopener noreferrer">运维交流社区</a> 欢迎大家的加入！</p>
</blockquote>
<h3 id="clamav简介" tabindex="-1"><a class="header-anchor" href="#clamav简介"><span>ClamAV简介</span></a></h3>
<blockquote>
<p>ClamAV是Linux操作系统一款<font color=green>免费的杀毒工具</font>，可以通过命令执行病毒库升级、查找病毒和删除病毒。<font color=green>ClamAV属于免费开源产品，支持多种平台，如：Linux/Unix、MAC OS X、Windows、OpenVMS。</font><br>
 <br>
ClamAV是基于病毒扫描的命令行工具，但同时也有支持图形界面的ClamTK工具。<br>
 <br>
ClamAV主要用于邮件服务器扫描邮件。它有多种接口从邮件服务器扫描邮件，支持文件格式有如：ZIP、RAR、TAR、GZIP、BZIP2、HTML、DOC、PDF,、SIS CHM、RTF等等。<br>
 <br>
ClamAV可以自动升级病毒库，还可以从共享库中运行。</p>
</blockquote>
<p><strong>clamav 有两个命令：clamdscan、clamscan：</strong></p>
<ul>
<li>clamscan 命令：通用，<font color=orange>不依赖服务</font>，命令参数较多，<font color=red>执行速度稍慢</font></li>
<li>clamdscan 命令：是一个<font color=orange>搭配clamd常驻服务</font>的扫毒工具，功能非常类似clamscan，<font color=green>执行效率较高</font>，但是可用的参数较少（因为部分功能是由 clamd 控制的）。<font color=red>不用带 -r ，默认会递归扫描子目录</font></li>
</ul>
<h3 id="clamav的安装" tabindex="-1"><a class="header-anchor" href="#clamav的安装"><span>ClamAV的安装</span></a></h3>
<p>centos安装方式：</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#添加扩展源</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> epel-release</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clamav</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clamavd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clamav-update</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ubuntu安装方式：</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#升级apt源</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> update</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">apt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clamav</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clamtk</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clamav-daemon</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clamdscan</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> device-tree-compiler</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="更新病毒库" tabindex="-1"><a class="header-anchor" href="#更新病毒库"><span>更新病毒库</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">freshclam</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438396.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>这样就是更新成功了；</p>
<font color=red>如遇到报错，可参考报错： </font> <a href="https://liucy.blog.csdn.net/article/details/129284185" target="_blank" rel="noopener noreferrer">clamav升级问题报错2：Can‘t query current.cvd.clamav.net</a><h3 id="clamav的使用" tabindex="-1"><a class="header-anchor" href="#clamav的使用"><span>ClamAV的使用</span></a></h3>
<h4 id="clamav的语法" tabindex="-1"><a class="header-anchor" href="#clamav的语法"><span>ClamAV的语法</span></a></h4>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">clamscan</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [选项/参数/简便参数] [文件/目录]</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><h4 id="clamav常用参数" tabindex="-1"><a class="header-anchor" href="#clamav常用参数"><span>ClamAV常用参数</span></a></h4>
<table>
<thead>
<tr>
<th>参数</th>
<th>简便参数</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>--help</td>
<td>-h</td>
<td>显示帮助页面</td>
</tr>
<tr>
<td>--version</td>
<td>-V</td>
<td>查看版本号</td>
</tr>
<tr>
<td>--verbose</td>
<td>-v</td>
<td>查看详细信息</td>
</tr>
<tr>
<td>--archive verbose</td>
<td>-a</td>
<td>在扫描的存档中显示文件名</td>
</tr>
<tr>
<td>--recursive[=yes/no(*)]</td>
<td>-r</td>
<td>递归扫描子目录，后面需跟目录</td>
</tr>
<tr>
<td>--infected</td>
<td>-i</td>
<td>仅打印已感染的文件</td>
</tr>
<tr>
<td>--log=FILE</td>
<td>-l</td>
<td>将扫描报告保存到文件中，后面需跟文件名</td>
</tr>
<tr>
<td>--file-list=FILE</td>
<td>-f</td>
<td>从file扫描文件，后面需跟文件名</td>
</tr>
<tr>
<td>--database=FILE/DIR</td>
<td>-d</td>
<td>FILE/DIR从FILE加载病毒数据库或从DIR加载所有支持的数据库文件</td>
</tr>
<tr>
<td>--allmatch[=yes/no(*)]</td>
<td>-z</td>
<td>找到匹配项后继续在文件中扫描</td>
</tr>
<tr>
<td>--quiet</td>
<td></td>
<td>仅输出错误消息</td>
</tr>
<tr>
<td>--tempdir=DIRECTORY</td>
<td></td>
<td>在目录中创建临时文件</td>
</tr>
<tr>
<td>--leave-temps[=yes/no(*)]</td>
<td></td>
<td>不删除临时文件</td>
</tr>
<tr>
<td>--gen-json[=yes/no(*)]</td>
<td></td>
<td>生成扫描文件的json描述并打印</td>
</tr>
<tr>
<td>--remove[=yes/no(*)]</td>
<td></td>
<td>删除受感染的文件，小心使用</td>
</tr>
<tr>
<td>--max-dir-recursion=num</td>
<td></td>
<td>目录深度，=5是扫描最高5层目录结束</td>
</tr>
</tbody>
</table>
<h4 id="clamav的用法" tabindex="-1"><a class="header-anchor" href="#clamav的用法"><span>ClamAV的用法</span></a></h4>
<h5 id="扫描病毒" tabindex="-1"><a class="header-anchor" href="#扫描病毒"><span>扫描病毒</span></a></h5>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#对/data/目录扫描，并将扫描的日志放到该文件中</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">clamscan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /data/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ./clamav.log</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>-i	只显示被感染的文件</li>
<li>-r	扫描目录，后面需跟目录</li>
<li>-l	保存日志文件的位置，后面需跟文件名</li>
</ul>
<p>注意：上述命令仅扫描病毒，不会对病毒文件进行删除，需手动删除。目录越大扫描速度越慢。</p>
<p>扫描结果如下：</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438378.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>这种的是没有病毒；<font color=red>Infected files</font> 显示0，则没有扫到病毒，1或其他则扫出了病毒。</p>
<blockquote>
<p>Known viruses	 	   #已知病毒<br>
Engine version	  	  #发动机版本<br>
Scanned directories 	 #扫描的目录<br>
Scanned files	 	 #扫描的文件<br>
Infected files 	 	 #受感染的文件<br>
Data scanned	 	 #扫描数据<br>
Data read	   	 #数据读取<br>
Time	     	 #时间<br>
Start Date	   	 #开始日期：<br>
End Date	   	 #结束日期</p>
</blockquote>
<h5 id="扫描病毒并自动删除病毒" tabindex="-1"><a class="header-anchor" href="#扫描病毒并自动删除病毒"><span>扫描病毒并自动删除病毒</span></a></h5>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#对/data/目录扫描，并将扫描的日志放到该文件中，有病毒则自动删除</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">clamscan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /data/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --remove=yes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ./clamav.log</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438883.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>删除完可以再去哪个目录看看。</p>
<h5 id="创建日志保存路径" tabindex="-1"><a class="header-anchor" href="#创建日志保存路径"><span>创建日志保存路径</span></a></h5>
<p>后续可以将病毒扫描结果保存到/var/log/clamav/ 文件夹下。</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /var/log/clamav/</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><p>扫描/home/下是否有病毒；目录越大扫描速度越慢。</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">clamscan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /home/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -l</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /var/log/clamav/clamav.log</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><h2 id="安装配置邮件服务" tabindex="-1"><a class="header-anchor" href="#安装配置邮件服务"><span>安装配置邮件服务</span></a></h2>
<p>安装邮件服务可参考： <a href="https://liucy.blog.csdn.net/article/details/129257050" target="_blank" rel="noopener noreferrer">【Linux】部署mailx服务及发送邮件告警</a></p>
<h2 id="配置定时扫描和邮件告警" tabindex="-1"><a class="header-anchor" href="#配置定时扫描和邮件告警"><span>配置定时扫描和邮件告警</span></a></h2>
<p>ClamAV扫描邮件告警脚本可以选择下载也可以选择直接复制，不下载的希望多一个浏览量，谢谢蟹蟹；</p>
<p>ClamAV扫描邮件告警脚本：<a href="https://download.csdn.net/download/liu_chen_yang/87522380" target="_blank" rel="noopener noreferrer">ClamAV病毒扫描之邮件告警脚本<br>
</a></p>
<p>ClamAV扫描邮件告警脚本：</p>
<blockquote>
<p>ClamAV病毒扫描之邮件告警脚本，里面内容可根据自己的情况自行修改。<br>
自行修改的内容有：<br>
  mail 邮件收件人<br>
  要扫描的路径（默认为/根目录）<br>
  日志存储的路径（默认为/var/log/clamav/）<br><br>
  还有就是最后的if判断那边也要记得修改自己的邮件收件人，判断三个都要改。<br>
  如果是一个人的话，可以直接写邮箱地址；如果是多个人的话在判断后面改为$mail_A，然后把需要通知的人写到最上面的mail_A环境变量中</p>
</blockquote>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">freshclam</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">   ##病毒库更新</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mail_A</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">mail1@qq.com,mail2@qq.com,mail3@163.com</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">) </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">## 邮件收件人，可批量</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># 获取当前时间（用于创建、读取日志文件）</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">date</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> +%Y%m%d-%H:%M:%S`</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># *填写扫描路径（可根据自己的情况来自定义，默认为/根目录）</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">clpath</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># *填写要存储日志的路径（可根据自己的情况来自定义，默认为/var/log/clamav/）</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">clamav_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/var/log/clamav"</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># 判断是否有存储日志的目录，如果没有则先创建，为了下面的存放日志而创建</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [ </span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">-e</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clamav_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> ];</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">        echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "有这个目录"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> > </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/dev/null</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">else</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">        echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "没有这个目录"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> > </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/dev/null</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -p</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clamav_log</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#扫描/目录 结果打印到$clamav_log/clamav$date.log</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">clamscan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -r</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clpath</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -l</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clamav_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/clamav</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">.log</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#删除WARING开头的内容</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  '/^WARNING/d'</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clamav_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/clamav</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">.log</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#删除第一行到第三行的内容</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> '1,3d'</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clamav_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/clamav</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">##获取当前服务器ip ，可以先执行这条命令看看自己的ip对不对。</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">ip</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">`</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">hostname</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -I</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> |</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF"> awk</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -F</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> " " '{print $1}'`</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#echo $IP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">""</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">while</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2"> read</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> line</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">do</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#  data_log+=$line"&#x3C;br>"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD">+=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$line</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"\n"</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">done</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x3C; </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$clamav_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/clamav</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">##获取高危病毒的个数</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">infected_files</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">cat</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clamav_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/clamav</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">.log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "Infected files"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">awk</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -F</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ": "</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> '{print $2}'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">##获取执行时的时间</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">scan_time</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">cat</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $clamav_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/clamav</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">.log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "Start Date"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">awk</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -F</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ": "</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> '{print $2}'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">SCAN</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> SUMMARY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/扫描结果</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Known</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> viruses</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/病毒库数量</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Engine</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/引擎版本</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Scanned</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> directories</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/已扫描目录</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Scanned</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/已扫描文件</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Infected</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/已发现病毒文件</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Total</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> errors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/错误总数</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Data</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> scanned</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/已扫描数据</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Data</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> read</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/读取数据</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Time</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/扫描时长</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">Start</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> Date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/开始时间</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">data_log</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">End</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> Date</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">/结束时间</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">body</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"杀毒软件 ClamAV 在</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$scan_time</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">   对您的服务器</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$ip进行了扫描</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">，扫描的路径为：</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$clpath</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">，扫描结果：暂未发现病毒！"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">body2</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"杀毒软件 ClamAV 在</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$scan_time</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">   对您的服务器</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$ip进行了扫描</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">,扫描的路径为：</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$clpath</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">，扫描结果：发现有</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$infected_files个高危病毒</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ；请立即登录服务器处理！详情可见附件↓ "</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">log2</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"杀毒软件 ClamAV 在</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$scan_time</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">   对您的服务器</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$ip进行了扫描</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">,扫描的路径为：</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$clpath</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">，扫描结果：发现有</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$infected_files个高危病毒</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ；病毒为：\n</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$data_log</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">\n请立即登录服务器处理！！！"</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">echo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$log2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> > </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">./</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">ip</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">_clamav.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">if</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$infected_files</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2"> -eq</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "0"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> ];</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">	echo</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $body</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">mail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "$(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">echo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> \r服务器病毒处理通知-无病毒")"</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  mail1@qq.com</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">elif</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [ </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$infected_files</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2"> -gt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "0"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> ];</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">then</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">	echo</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $body2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">mail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ./</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">${</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">ip</span><span style="--shiki-light:#E45649;--shiki-dark:#ABB2BF">}</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">_clamav.txt</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "$(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">echo</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> \r服务器病毒处理通知-有 </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$infected_files</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 个高危病毒")"</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  mail1@qq.com</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">else</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">	echo</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $body2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">mail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$ip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> :此次查询失败，请检查日志！"</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> mail1@qq.com</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD">fi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#$mail_A  ##收件人地址</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><font color=red>注：该脚本只适用于clamscan命令，并不适用于clamdscan命令。</font><h3 id="发送邮件告警样式演示" tabindex="-1"><a class="header-anchor" href="#发送邮件告警样式演示"><span>发送邮件告警样式演示：</span></a></h3>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438162.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p><strong>显示内容：</strong></p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438066.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438147.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3 id="删除病毒方式" tabindex="-1"><a class="header-anchor" href="#删除病毒方式"><span>删除病毒方式</span></a></h3>
<blockquote>
<p>方式一：扫描到病毒可以手动删除，进入病毒目录直接删除就可以；<br>
 <br>
方式二：也可以找到病毒目录，再次执行扫描病毒命令并指定病毒所在目录，<code v-pre>clamscan -i -r /data/ --remove=yes -l ./clamav.log</code> 来实现删除病毒；</p>
</blockquote>
<h3 id="配置定时扫描" tabindex="-1"><a class="header-anchor" href="#配置定时扫描"><span>配置定时扫描</span></a></h3>
<p>配置定时扫描也就是设置周期性计划任务</p>
<blockquote>
<font color=red>提示：</font><p>如果是只扫描某一个路径下的，可以一天扫一次就行；<br>
如果是直接扫根目录，建议一周扫一次。</p>
</blockquote>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/crontab</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#以用户root身份定时执行脚本，sh为执行命令，/data/----为脚本绝对路径；每天凌晨4点扫描一次</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> 4</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> *</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /bin/sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /data/clamav/clamav.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">###每周日凌晨1点clamav扫描漏洞（扫描根目录推荐）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> 1</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> *</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> *</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> 7</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">   root</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /bin/sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /home/clamav/clamav.sh</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438417.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412181438711.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>配置完成之后保存退出即可。</p>
<h3 id="附加-升级clamav报错解决方式及相关文章" tabindex="-1"><a class="header-anchor" href="#附加-升级clamav报错解决方式及相关文章"><span>附加：升级ClamAV报错解决方式及相关文章</span></a></h3>
<table>
<thead>
<tr>
<th style="text-align:left">文章名</th>
<th style="text-align:left">文章链接🔗</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><a href="https://liucy.blog.csdn.net/article/details/129284185" target="_blank" rel="noopener noreferrer">clamav升级问题报错2：Can‘t query current.cvd.clamav.net</a></td>
<td style="text-align:left"><a href="https://liucy.blog.csdn.net/article/details/129284185" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/129284185</a></td>
</tr>
<tr>
<td style="text-align:left"><a href="https://liucy.blog.csdn.net/article/details/129257050" target="_blank" rel="noopener noreferrer">【Linux】部署mailx服务及发送邮件告警</a></td>
<td style="text-align:left"><a href="https://liucy.blog.csdn.net/article/details/129257050" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/129257050</a></td>
</tr>
<tr>
<td style="text-align:left"><a href="https://download.csdn.net/download/liu_chen_yang/87522380" target="_blank" rel="noopener noreferrer">ClamAV病毒扫描之邮件告警脚本</a></td>
<td style="text-align:left"><a href="https://download.csdn.net/download/liu_chen_yang/87522380" target="_blank" rel="noopener noreferrer">https://download.csdn.net/download/liu_chen_yang/87522380</a></td>
</tr>
</tbody>
</table>
</div></template>


