<template><div><blockquote>
<p>ğŸ<strong>åšä¸»ç®€ä»‹</strong></p>
<p>â€ƒâ€ƒğŸ…<a href="https://blog.csdn.net/liu_chen_yang?type=blog" target="_blank" rel="noopener noreferrer">äº‘è®¡ç®—é¢†åŸŸä¼˜è´¨åˆ›ä½œè€…</a><br>
â€ƒâ€ƒğŸ…<a href="https://bbs.huaweicloud.com/community/myblog" target="_blank" rel="noopener noreferrer">åä¸ºäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»</a><br>
â€ƒâ€ƒğŸ…<a href="https://developer.aliyun.com/my?spm=a2c6h.13148508.setting.3.21fc4f0eCmz1v3#/article?_k=zooqoz" target="_blank" rel="noopener noreferrer">é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»</a><br>
ğŸ’Š<strong>äº¤æµç¤¾åŒºï¼š</strong><a href="https://bbs.csdn.net/forums/lcy" target="_blank" rel="noopener noreferrer">è¿ç»´äº¤æµç¤¾åŒº</a> æ¬¢è¿å¤§å®¶çš„åŠ å…¥ï¼</p>
</blockquote>
<h2 id="kubernetesç®€ä»‹" tabindex="-1"><a class="header-anchor" href="#kubernetesç®€ä»‹"><span>Kubernetesç®€ä»‹</span></a></h2>
<blockquote>
<p>â€ƒâ€ƒKubernetes(ç®€ç§°:k8s) æ˜¯Googleåœ¨2014å¹´6æœˆå¼€æºçš„ä¸€ä¸ªå®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨Goè¯­è¨€å¼€å‘ï¼Œç”¨äºç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ï¼ŒKubernetesçš„ç›®æ ‡æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç®€å•å¹¶ä¸”é«˜æ•ˆ,Kubernetesæä¾›äº†èµ„æºè°ƒåº¦ã€éƒ¨ç½²ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ‰©å®¹ç¼©å®¹ã€ç›‘æ§ï¼Œç»´æŠ¤ç­‰ä¸€æ•´å¥—åŠŸèƒ½ã€‚</p>
</blockquote>
<p>å®˜ç½‘åœ°å€: <a href="https://kubernetes.io" target="_blank" rel="noopener noreferrer">https://kubernetes.io</a></p>
<h3 id="_1-kubernetesæ¶æ„" tabindex="-1"><a class="header-anchor" href="#_1-kubernetesæ¶æ„"><span>1 kubernetesæ¶æ„</span></a></h3>
<blockquote>
<p>â€ƒâ€ƒKuberneteså…·æœ‰å»ä¸­å¿ƒåŒ–çš„æ¶æ„ï¼Œä¸ä¼šçº¿æ€§å¤„ç†ä»»åŠ¡ã€‚å®ƒåŸºäºå£°æ˜æ€§æ¨¡å‹è¿è¡Œå¹¶å®ç°&quot;æ‰€éœ€çŠ¶æ€&quot;çš„æ¦‚å¿µã€‚ä¸‹é¢è¿™äº›æ­¥éª¤è¯´æ˜äº†Kubernetesçš„åŸºæœ¬è¿‡ç¨‹:</p>
<ul>
<li>ç®¡ç†å‘˜åˆ›å»ºåº”ç”¨ç¨‹åºçš„æ‰€éœ€çŠ¶æ€å¹¶å°†å…¶æ”¾å…¥æ¸…å•æ–‡ä»¶manifest.ymlä¸­ã€‚</li>
<li>ä½¿ç”¨CLIæˆ–æä¾›çš„ç”¨æˆ·ç•Œé¢å°†æ¸…å•æ–‡ä»¶æä¾›ç»™Kubernetes API Serverã€‚ Kubernetesçš„é»˜è®¤å‘½ä»¤è¡Œå·¥å…·ç§°ä¸ºkubectlã€‚</li>
<li>Kuberneteså°†æ¸…å•æ–‡ä»¶ï¼ˆæè¿°äº†åº”ç”¨ç¨‹åºçš„æœŸæœ›çŠ¶æ€ï¼‰å­˜å‚¨åœ¨ç§°ä¸ºé”®å€¼å­˜å‚¨ï¼ˆetcdï¼‰çš„æ•°æ®åº“ä¸­ã€‚</li>
<li>Kuberneteséšååœ¨é›†ç¾¤å†…çš„æ‰€æœ‰ç›¸å…³åº”ç”¨ç¨‹åºä¸Šå®ç°æ‰€éœ€çš„çŠ¶æ€ã€‚</li>
<li>KubernetesæŒç»­ç›‘æ§é›†ç¾¤çš„å…ƒç´ ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ä¸ä¼šä¸æ‰€éœ€çŠ¶æ€æœ‰æ‰€ä¸åŒã€‚</li>
</ul>
</blockquote>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420964.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h4 id="_1-1masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_1-1masterèŠ‚ç‚¹"><span>1.1masterèŠ‚ç‚¹</span></a></h4>
<blockquote>
<p>â€ƒâ€ƒk8sé›†ç¾¤çš„ç®¡ç†èŠ‚ç‚¹ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤ï¼Œæä¾›é›†ç¾¤çš„èµ„æºæ•°æ®è®¿é—®å…¥å£ã€‚æ‹¥æœ‰Etcdå­˜å‚¨æœåŠ¡ï¼ˆå¯é€‰ï¼‰ï¼Œè¿è¡ŒApi Serverè¿›ç¨‹ï¼ŒController ManageræœåŠ¡è¿›ç¨‹åŠScheduleræœåŠ¡è¿›ç¨‹ï¼Œå…³è”å·¥ä½œèŠ‚ç‚¹Nodeã€‚</p>
<ul>
<li>API Server</li>
</ul>
<p>æä¾›äº†èµ„æºå¯¹è±¡çš„å”¯ä¸€æ“ä½œå…¥å£ï¼Œå…¶ä»–æ‰€æœ‰ç»„ä»¶éƒ½å¿…é¡»é€šè¿‡å®ƒæä¾›çš„APIæ¥æ“ä½œèµ„æºæ•°æ®ï¼Œåªæœ‰API Serverä¸å­˜å‚¨é€šä¿¡ï¼Œå…¶ä»–æ¨¡å—é€šè¿‡API Serverè®¿é—®é›†ç¾¤çŠ¶æ€ã€‚</p>
<ul>
<li>Scheduler</li>
</ul>
<p>æ–°å»ºç«‹çš„Podè¿›è¡ŒèŠ‚ç‚¹(node)é€‰æ‹©(å³åˆ†é…æœºå™¨)ï¼Œè´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦ã€‚ç»„ä»¶æŠ½ç¦»ï¼Œå¯ä»¥æ–¹ä¾¿æ›¿æ¢æˆå…¶ä»–è°ƒåº¦å™¨ã€‚</p>
<ul>
<li>Controller</li>
</ul>
<p>è´Ÿè´£æ‰§è¡Œå„ç§æ§åˆ¶å™¨ï¼Œç›®å‰å·²ç»æä¾›äº†å¾ˆå¤šæ§åˆ¶å™¨æ¥ä¿è¯Kubernetesçš„æ­£å¸¸è¿è¡Œã€‚</p>
<ul>
<li>Cluster state store</li>
</ul>
<p>Kubernetesé»˜è®¤ä½¿ç”¨etcdä½œä¸ºé›†ç¾¤æ•´ä½“å­˜å‚¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒçš„æŠ€æœ¯ã€‚etcdæ˜¯ä¸€ä¸ªç®€å•çš„ã€åˆ†å¸ƒå¼çš„ã€ä¸€è‡´çš„key-valueå­˜å‚¨ï¼Œä¸»è¦è¢«ç”¨æ¥å…±äº«é…ç½®å’ŒæœåŠ¡å‘ç°ã€‚etcdæä¾›äº†ä¸€ä¸ªCRUDæ“ä½œçš„REST APIï¼Œä»¥åŠæä¾›äº†ä½œä¸ºæ³¨å†Œçš„æ¥å£ï¼Œä»¥ç›‘æ§æŒ‡å®šçš„Nodeã€‚é›†ç¾¤çš„æ‰€æœ‰çŠ¶æ€éƒ½å­˜å‚¨åœ¨etcdå®ä¾‹ä¸­ï¼Œå¹¶å…·æœ‰ç›‘æ§çš„èƒ½åŠ›ï¼Œå› æ­¤å½“etcdä¸­çš„ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿçš„é€šçŸ¥é›†ç¾¤ä¸­ç›¸å…³çš„ç»„ä»¶ã€‚</p>
</blockquote>
<table>
<thead>
<tr>
<th>æ§åˆ¶å™¨</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Replication Controller</td>
<td>ç®¡ç†ç»´æŠ¤Replication Controllerï¼Œå…³è”Replication Controllerå’ŒPodï¼Œä¿è¯Replication Controllerå®šä¹‰çš„å‰¯æœ¬æ•°</td>
</tr>
<tr>
<td>Node Controller</td>
<td>ç®¡ç†ç»´æŠ¤Nodeï¼Œå®šæœŸæ£€æŸ¥Nodeçš„å¥åº·çŠ¶æ€ï¼Œæ ‡è¯†å‡º(å¤±æ•ˆ|æœªå¤±æ•ˆ)çš„NodeèŠ‚ç‚¹ã€‚</td>
</tr>
<tr>
<td>Namespace Controller</td>
<td>ç®¡ç†ç»´æŠ¤Namespaceï¼Œå®šæœŸæ¸…ç†æ— æ•ˆçš„Namespaceï¼ŒåŒ…æ‹¬Namesapceä¸‹çš„APIå¯¹è±¡ï¼Œæ¯”å¦‚Podã€Serviceç­‰ã€‚</td>
</tr>
<tr>
<td>Service Controller</td>
<td>ç®¡ç†ç»´æŠ¤Serviceï¼Œæä¾›è´Ÿè½½ä»¥åŠæœåŠ¡ä»£ç†ã€‚</td>
</tr>
<tr>
<td>EndPoints Controller</td>
<td>ç®¡ç†ç»´æŠ¤Endpointsï¼Œå…³è”Serviceå’ŒPodï¼Œåˆ›å»ºEndpointsä¸ºServiceçš„åç«¯ï¼Œå½“Podå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®æ—¶æ›´æ–°Endpointsã€‚</td>
</tr>
<tr>
<td>Service Account Controller</td>
<td>ç®¡ç†ç»´æŠ¤Service Accountï¼Œä¸ºæ¯ä¸ªNamespaceåˆ›å»ºé»˜è®¤çš„Service Accountï¼ŒåŒæ—¶ä¸ºService Accountåˆ›å»ºService Account Secretã€‚</td>
</tr>
<tr>
<td>Persistent Volume Controller</td>
<td>ç®¡ç†ç»´æŠ¤Persistent Volumeå’ŒPersistent Volume Claimï¼Œä¸ºæ–°çš„Persistent Volume Claimåˆ†é…Persistent Volumeè¿›è¡Œç»‘å®šï¼Œä¸ºé‡Šæ”¾çš„Persistent Volumeæ‰§è¡Œæ¸…ç†å›æ”¶ã€‚</td>
</tr>
<tr>
<td>DaemonSet Controller</td>
<td>ç®¡ç†ç»´æŠ¤Daemon Setï¼Œè´Ÿè´£åˆ›å»ºDaemon Podï¼Œä¿è¯æŒ‡å®šçš„Nodeä¸Šæ­£å¸¸çš„è¿è¡ŒDaemon Podã€‚</td>
</tr>
<tr>
<td>Deployment Controller</td>
<td>ç®¡ç†ç»´æŠ¤Deploymentï¼Œå…³è”Deploymentå’ŒReplication Controllerï¼Œä¿è¯è¿è¡ŒæŒ‡å®šæ•°é‡çš„Podã€‚å½“Deploymentæ›´æ–°æ—¶ï¼Œæ§åˆ¶å®ç°Replication Controllerå’ŒPodçš„æ›´æ–°ã€‚</td>
</tr>
<tr>
<td>Job Controller</td>
<td>ç®¡ç†ç»´æŠ¤Jobï¼Œä¸ºJodåˆ›å»ºä¸€æ¬¡æ€§ä»»åŠ¡Podï¼Œä¿è¯å®ŒæˆJobæŒ‡å®šå®Œæˆçš„ä»»åŠ¡æ•°ç›®</td>
</tr>
<tr>
<td>Pod Autoscaler Controller</td>
<td>å®ç°Podçš„è‡ªåŠ¨ä¼¸ç¼©ï¼Œå®šæ—¶è·å–ç›‘æ§æ•°æ®ï¼Œè¿›è¡Œç­–ç•¥åŒ¹é…ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶æ‰§è¡ŒPodçš„ä¼¸ç¼©åŠ¨ä½œã€‚</td>
</tr>
</tbody>
</table>
<h4 id="_1-2-nodeèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_1-2-nodeèŠ‚ç‚¹"><span>1.2 NodeèŠ‚ç‚¹</span></a></h4>
<blockquote>
<p>â€ƒâ€ƒNodeèŠ‚ç‚¹æ˜¯å·¥ä½œèŠ‚ç‚¹ç›‘å¬API Serverå‘é€è¿‡æ¥çš„æ–°çš„å·¥ä½œåˆ†é…ï¼›ä»–ä»¬ä¼šæ‰§è¡Œåˆ†é…ç»™ä»–ä»¬çš„å·¥ä½œï¼Œç„¶åå°†ç»“æœæŠ¥å‘Šç»™Kubernetesä¸»èŠ‚ç‚¹ã€‚</p>
<ul>
<li>Kubelet</li>
</ul>
<p>è´Ÿè´£ç®¡æ§å®¹å™¨ï¼ŒKubeletä¼šä»Kubernetes API Serveræ¥æ”¶Podçš„åˆ›å»ºè¯·æ±‚ï¼Œå¯åŠ¨å’Œåœæ­¢å®¹å™¨ï¼Œç›‘æ§å®¹å™¨è¿è¡ŒçŠ¶æ€å¹¶æ±‡æŠ¥ç»™Kubernetes API Serverã€‚</p>
<ul>
<li>Container Runtime</li>
</ul>
<p>æ¯ä¸€ä¸ªNodeéƒ½ä¼šè¿è¡Œä¸€ä¸ªContainer Runtimeï¼Œå…¶è´Ÿè´£ä¸‹è½½é•œåƒå’Œè¿è¡Œå®¹å™¨ã€‚Kubernetesæœ¬èº«å¹¶ä¸æä¾›å®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒï¼Œä½†æä¾›äº†æ¥å£ï¼Œå¯ä»¥æ’å…¥æ‰€é€‰æ‹©çš„å®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒã€‚kubeletä½¿ç”¨Unix socketä¹‹ä¸Šçš„gRPCæ¡†æ¶ä¸å®¹å™¨è¿è¡Œæ—¶è¿›è¡Œé€šä¿¡ï¼Œkubeletä½œä¸ºå®¢æˆ·ç«¯ï¼Œè€ŒCRI shimä½œä¸ºæœåŠ¡å™¨ã€‚</p>
<ul>
<li>kube proxy</li>
</ul>
<p>åŸºäºä¸€ç§å…¬å…±è®¿é—®ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡ï¼‰ï¼ŒæœåŠ¡æä¾›äº†ä¸€ç§è®¿é—®ä¸€ç¾¤podçš„é€”å¾„ã€‚æ­¤æ–¹å¼é€šè¿‡åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„IPæ¥å®ç°ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®æ­¤IPï¼Œå¹¶èƒ½å¤Ÿå°†æœåŠ¡é€æ˜çš„ä»£ç†è‡³Podã€‚æ¯ä¸€ä¸ªNodeéƒ½ä¼šè¿è¡Œä¸€ä¸ªkube-proxyï¼Œkube proxyé€šè¿‡iptablesè§„åˆ™å¼•å¯¼è®¿é—®è‡³æœåŠ¡IPï¼Œå¹¶å°†é‡å®šå‘è‡³æ­£ç¡®çš„åç«¯åº”ç”¨ï¼Œé€šè¿‡è¿™ç§æ–¹å¼kube-proxyæä¾›äº†ä¸€ä¸ªé«˜å¯ç”¨çš„è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆã€‚æœåŠ¡å‘ç°ä¸»è¦é€šè¿‡DNSå®ç°ã€‚<br>
â€ƒâ€ƒåœ¨Kubernetesä¸­ï¼Œkube proxyè´Ÿè´£ä¸ºPodåˆ›å»ºä»£ç†æœåŠ¡ï¼›å¼•åˆ°è®¿é—®è‡³æœåŠ¡ï¼›å¹¶å®ç°æœåŠ¡åˆ°Podçš„è·¯ç”±å’Œè½¬å‘ï¼Œä»¥åŠé€šè¿‡åº”ç”¨çš„è´Ÿè½½å‡è¡¡ã€‚</p>
<ul>
<li>Pod</li>
</ul>
<p>è¿è¡ŒäºNodeèŠ‚ç‚¹ä¸Šï¼Œè‹¥å¹²ç›¸å…³å®¹å™¨çš„ç»„åˆã€‚Podå†…åŒ…å«çš„å®¹å™¨è¿è¡Œåœ¨åŒä¸€å®¿ä¸»æœºä¸Šï¼Œä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ã€IPåœ°å€,åŒä¸€ä¸ªPodä¸­ï¼Œç«¯å£ä¸èƒ½é‡å¤ï¼Œå¦åˆ™æŠ¥é”™ï¼Œèƒ½å¤Ÿé€šè¿‡localhostè¿›è¡Œé€šä¿¡ã€‚Podæ˜¯Kurbernetesè¿›è¡Œåˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†çš„æœ€å°å•ä½ï¼Œå®ƒæä¾›äº†æ¯”å®¹å™¨æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œä½¿å¾—éƒ¨ç½²å’Œç®¡ç†æ›´åŠ çµæ´»ã€‚ä¸€ä¸ªPodå¯ä»¥åŒ…å«ä¸€ä¸ªå®¹å™¨æˆ–è€…å¤šä¸ªç›¸å…³å®¹å™¨ã€‚<br>
â€ƒâ€ƒPodå…¶å®æœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šPodå’Œé™æ€Podï¼Œåè€…æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå¹¶ä¸å­˜åœ¨Kubernetesçš„etcdå­˜å‚¨ä¸­ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªåœ¨æ­¤Nodeä¸Šå¯åŠ¨ã€‚æ™®é€šPodä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«æ”¾å…¥etcdå­˜å‚¨ä¸­ï¼Œéšåä¼šè¢«Kubernetes Masterè°ƒåº¦åˆ°æ‘¸ä¸ªå…·ä½“çš„Nodeä¸Šè¿›è¡Œç»‘å®šï¼Œéšåè¯¥Podè¢«å¯¹åº”çš„Nodeä¸Šçš„kubeletè¿›ç¨‹å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨èµ·æ¥ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®èµ·å¹¶ä¸”é‡å¯è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼Œå¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œåˆ™ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podé‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚</p>
</blockquote>
<h4 id="_1-3-kubectl" tabindex="-1"><a class="header-anchor" href="#_1-3-kubectl"><span>1.3 kubectl</span></a></h4>
<blockquote>
<p>â€ƒâ€ƒ é›†ç¾¤ç®¡ç†å‘½ä»¤è¡Œå·¥å…·é›†ï¼Œé€šè¿‡å®¢æˆ·ç«¯çš„kubectlå‘½ä»¤é›†æ“ä½œï¼ŒAPI Serverå“åº”å¯¹åº”çš„å‘½ä»¤ç»“æœï¼Œä»è€Œè¾¾åˆ°å¯¹kubernetesé›†ç¾¤çš„ç®¡ç†ã€‚</p>
</blockquote>
<h3 id="_2-kubeadm" tabindex="-1"><a class="header-anchor" href="#_2-kubeadm"><span>2 kubeadm</span></a></h3>
<p>â€ƒâ€ƒKubeadmæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæä¾›äº†kubeadm initä»¥åŠkubeadm joinè¿™ä¸¤ä¸ªå‘½ä»¤ä½œä¸ºå¿«é€Ÿåˆ›å»ºkubernetes é›†ç¾¤çš„æœ€ä½³å®è·µã€‚</p>
<p>â€ƒâ€ƒkubeadmé€šè¿‡æ‰§è¡Œå¿…è¦çš„æ“ä½œæ¥å¯åŠ¨å’Œè¿è¡Œä¸€ä¸ªæœ€å°å¯ç”¨çš„é›†ç¾¤ã€‚kubeadmåªå…³å¿ƒå¯åŠ¨é›†ç¾¤ï¼Œè€Œä¸å…³å¿ƒå…¶ä»–å·¥ä½œï¼Œå¦‚éƒ¨ç½²å‰çš„èŠ‚ç‚¹å‡†å¤‡å·¥ä½œã€å®‰è£…å„ç§Kubernetes Dashboardã€ç›‘æ§è§£å†³æ–¹æ¡ˆä»¥åŠç‰¹å®šäº‘æä¾›å•†çš„æ’ä»¶ï¼Œè¿™äº›éƒ½ä¸å±äºkubeadmå…³æ³¨èŒƒå›´ã€‚</p>
<h4 id="_2-1-kubeadmåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#_2-1-kubeadmåŠŸèƒ½"><span>2.1 kubeadmåŠŸèƒ½</span></a></h4>
<ul>
<li>kubeadm init å¯åŠ¨/åˆå§‹åŒ–ä¸€ä¸ª Kubernetes ä¸»èŠ‚ç‚¹ï¼›</li>
<li>kubeadm join å¯åŠ¨ä¸€ä¸ª Kubernetes å·¥ä½œèŠ‚ç‚¹å¹¶ä¸”å°†å…¶åŠ å…¥åˆ°é›†ç¾¤ï¼›</li>
<li>kubeadm upgrade æ›´æ–°ä¸€ä¸ª Kubernetes é›†ç¾¤åˆ°æ–°ç‰ˆæœ¬ï¼›</li>
<li>kubeadm config å¦‚æœä½¿ç”¨ v1.7.x æˆ–è€…æ›´ä½ç‰ˆæœ¬çš„ kubeadm åˆå§‹åŒ–é›†ç¾¤ï¼Œæ‚¨éœ€è¦å¯¹é›†ç¾¤åšä¸€äº›é…ç½®ä»¥ä¾¿ä½¿ç”¨ kubeadm upgrade å‘½ä»¤ï¼›</li>
<li>kubeadm token ç®¡ç† kubeadm join ä½¿ç”¨çš„ä»¤ç‰Œï¼›</li>
<li>kubeadm reset è¿˜åŸ kubeadm init æˆ–è€… kubeadm join å¯¹ä¸»æœºæ‰€åšçš„ä»»ä½•æ›´æ”¹ï¼›</li>
<li>kubeadm version æ‰“å° kubeadm ç‰ˆæœ¬ï¼›</li>
<li>kubeadm alpha é¢„è§ˆä¸€ç»„å¯ç”¨çš„æ–°åŠŸèƒ½ä»¥ä¾¿ä»ç¤¾åŒºæœé›†åé¦ˆã€‚</li>
</ul>
<h2 id="kubernetesé›†ç¾¤éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#kubernetesé›†ç¾¤éƒ¨ç½²"><span>Kubernetesé›†ç¾¤éƒ¨ç½²</span></a></h2>
<h2 id="å‡†å¤‡å·¥ä½œ-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦åšåŒæ ·çš„æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡å·¥ä½œ-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦åšåŒæ ·çš„æ“ä½œ"><span>å‡†å¤‡å·¥ä½œï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦åšåŒæ ·çš„æ“ä½œï¼‰</span></a></h2>
<h3 id="æœåŠ¡å™¨é…ç½®" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å™¨é…ç½®"><span>æœåŠ¡å™¨é…ç½®</span></a></h3>
<table>
<thead>
<tr>
<th>é›†ç¾¤ï¼ˆä¸€ä¸»ä¸¤ä»ï¼‰</th>
<th>ipåœ°å€</th>
<th>ä¸»æœºå</th>
<th>é…ç½®</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä¸»</td>
<td>172.16.11.221</td>
<td>k8s-master</td>
<td>2C/2G/50G</td>
</tr>
<tr>
<td>ä»</td>
<td>172.16.11.222</td>
<td>k8s-node1</td>
<td>2C/2G/50G</td>
</tr>
<tr>
<td>ä»</td>
<td>172.16.11.223</td>
<td>k8s-node2</td>
<td>2C/2G/50G</td>
</tr>
</tbody>
</table>
<h3 id="å…³é—­é˜²ç«å¢™" tabindex="-1"><a class="header-anchor" href="#å…³é—­é˜²ç«å¢™"><span>å…³é—­é˜²ç«å¢™</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> firewalld</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x26;&#x26; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> disable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> firewalld</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><p>å¦‚æœåœ¨çº¿ä¸ŠæœåŠ¡å™¨ä¹‹ç±»çš„ä¸èƒ½å…³é—­é˜²ç«å¢™ï¼Œé‚£å°±éœ€è¦å¼€å¯å‡ ä¸ªç«¯å£ï¼›ï¼ˆè¿™é‡Œè¯´çš„æ˜¯k8æ‰€ç”¨åˆ°çš„ç«¯å£ï¼‰</p>
<ul>
<li>masterèŠ‚ç‚¹:</li>
</ul>
<table>
<thead>
<tr>
<th>è§„åˆ™</th>
<th>ç«¯å£èŒƒå›´</th>
<th>ä½œç”¨</th>
<th>ä½¿ç”¨è€…</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP</td>
<td>6443*</td>
<td>Kubernetes API server</td>
<td>All</td>
</tr>
<tr>
<td>TCP</td>
<td>2379-2380</td>
<td>etcd server client API</td>
<td>kube-apiserver, etcd</td>
</tr>
<tr>
<td>TCP</td>
<td>10250</td>
<td>Kubelet API</td>
<td>Self, Control plane</td>
</tr>
<tr>
<td>TCP</td>
<td>10251</td>
<td>kube-scheduler</td>
<td>Self</td>
</tr>
<tr>
<td>TCP</td>
<td>10252</td>
<td>kube-controller-manager</td>
<td>Self</td>
</tr>
</tbody>
</table>
<ul>
<li>nodeèŠ‚ç‚¹ï¼š</li>
</ul>
<table>
<thead>
<tr>
<th>è§„åˆ™</th>
<th>ç«¯å£èŒƒå›´</th>
<th>ä½œç”¨</th>
<th>ä½¿ç”¨è€…</th>
</tr>
</thead>
<tbody>
<tr>
<td>TCP</td>
<td>10252</td>
<td>Kubelet API</td>
<td>Self, Control plane</td>
</tr>
<tr>
<td>TCP</td>
<td>30000-32767</td>
<td>NodePort Services**</td>
<td>All</td>
</tr>
</tbody>
</table>
<h3 id="å…³é—­selinux" tabindex="-1"><a class="header-anchor" href="#å…³é—­selinux"><span>å…³é—­selinux</span></a></h3>
<p>ä¸´æ—¶å…³é—­selinuxï¼ˆæ²™æ²³ï¼‰å¦‚éœ€æ°¸ä¹…å…³é—­selinuxéœ€è¦ä¿®æ”¹ä¸º<code v-pre>sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config</code></p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#ä¸´æ—¶å…³é—­selinux</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">setenforce</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æ°¸ä¹…å…³é—­selinux</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 's/^SELINUX=enforcing$/SELINUX=permissive/'</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/selinux/config</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…³é—­äº¤æ¢åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#å…³é—­äº¤æ¢åˆ†åŒº"><span>å…³é—­äº¤æ¢åˆ†åŒº</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#ä¸´æ—¶å…³é—­æ‰€æœ‰çš„äº¤æ¢åˆ†åŒº</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">swapoff</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -a</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æ°¸ä¹…å…³é—­æ‰€æœ‰çš„äº¤æ¢åˆ†åŒº</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> '/swap/s/^\(.*\)$/#\1/g'</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/fstab</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¿®æ”¹ä¸‰å°é›†ç¾¤çš„ä¸»æœºå-æ¯ä¸ªä¸»æœºé™ä¸€æ¡å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹ä¸‰å°é›†ç¾¤çš„ä¸»æœºå-æ¯ä¸ªä¸»æœºé™ä¸€æ¡å‘½ä»¤"><span>ä¿®æ”¹ä¸‰å°é›†ç¾¤çš„ä¸»æœºåï¼šï¼ˆæ¯ä¸ªä¸»æœºé™ä¸€æ¡å‘½ä»¤ï¼‰</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@k8s-master1 ~]# hostnamectl set-hostname k8s-master</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@k8s-node1 ~]# hostnamectl set-hostname k8s-node1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@k8s-node2 ~]# hostnamectl set-hostname k8s-node2</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰€æœ‰èŠ‚ç‚¹éƒ½æ·»åŠ é›†ç¾¤ipä¸ä¸»æœºååˆ°hostsä¸­" tabindex="-1"><a class="header-anchor" href="#æ‰€æœ‰èŠ‚ç‚¹éƒ½æ·»åŠ é›†ç¾¤ipä¸ä¸»æœºååˆ°hostsä¸­"><span>æ‰€æœ‰èŠ‚ç‚¹éƒ½æ·»åŠ é›†ç¾¤ipä¸ä¸»æœºååˆ°hostsä¸­ï¼š</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> >> </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/etc/hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x3C;&#x3C; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">172.16.11.221 k8s-master</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">172.16.11.222 k8s-node1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">172.16.11.223 k8s-node2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><font color=red>æ³¨æ„ï¼šipä¸€å®šè¦æ”¹æˆè‡ªå·±çš„ipï¼Œä¸è¦ç›´æ¥å¤åˆ¶ç²˜è´´</font><h3 id="ä¸‰å°æœºå™¨è¿›è¡Œæ—¶é—´åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#ä¸‰å°æœºå™¨è¿›è¡Œæ—¶é—´åŒæ­¥"><span>ä¸‰å°æœºå™¨è¿›è¡Œæ—¶é—´åŒæ­¥</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å®‰è£åŒæ­¥æ—¶é—´å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ntpdate</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -y</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#åŒæ­¥æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ntpdate</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> cn.pool.ntp.org</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#è®¾ç½®å®šæ—¶ä»»åŠ¡æ¯äº”åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æ—¶é—´</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "*/5 * * * * root /usr/sbin/ntpdate cn.pool.ntp.org &#x26;>/dev/null"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> >> </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/etc/crontab</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç‰¹æ®Šè¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ®Šè¯´æ˜"><span>ç‰¹æ®Šè¯´æ˜:</span></a></h3>
<blockquote>
<p>å¦‚æœæ˜¯å…‹éš†è™šæ‹Ÿæœºå»ºè®®æ‰§è¡Œ<font color=red>rm -rf /etc/udev/*</font> ä¿è¯ç½‘å¡UUIDä¸åŒ</p>
</blockquote>
<h3 id="ä¸‰å°éƒ½å®‰è£…éœ€è¦çš„ä¸€äº›å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ä¸‰å°éƒ½å®‰è£…éœ€è¦çš„ä¸€äº›å‘½ä»¤"><span>ä¸‰å°éƒ½å®‰è£…éœ€è¦çš„ä¸€äº›å‘½ä»¤ï¼š</span></a></h3>
<ul>
<li>æ·»åŠ centosæºå¹¶å°†ä¸‹è½½åœ°å€æ›´æ¢ä¸ºé˜¿é‡Œäº‘åœ°å€</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æ·»åŠ centosæº</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/yum.repos.d/CentOS-Base.repo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> https://mirrors.aliyun.com/repo/Centos-7.repo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å°†ä¸‹è½½åœ°å€æ›´æ¢ä¸ºé˜¿é‡Œäº‘åœ°å€</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sed</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> '/mirrors.cloud.aliyuncs.com/d'</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> '/mirrors.aliyuncs.com/d'</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/yum.repos.d/CentOS-Base.repo</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>æ·»åŠ epelæ‰©å±•æº</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">curl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/yum.repos.d/epel.repo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> http://mirrors.aliyun.com/repo/epel-7.repo</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><ul>
<li>æ¸…é™¤ç¼“å­˜</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> clean</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> all</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><ul>
<li>é‡æ–°åŠ è½½æºç¼“å­˜</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> makecache</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><ul>
<li>å‡çº§yumå¹¶å®‰è£…ä¸€äº›ä¼šç”¨åˆ°çš„å‘½ä»¤</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x26;&#x26; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> lrzsz</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> conntrack</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ipvsadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ipset</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> jq</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> psmisc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> sysstat</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> curl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> iptables</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> net-tools</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> libseccomp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> gcc</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> gcc-c++</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> yum-utils</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> device-mapper-persistent-data</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> lvm2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> bash-completion</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><p>å®‰è£…éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå°±ç­‰å¾…å®‰è£…å³å¯ï¼›</p>
<h2 id="éƒ¨ç½²-docker-æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-docker-æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦éƒ¨ç½²"><span>éƒ¨ç½² dockerï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦éƒ¨ç½²ï¼‰</span></a></h2>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å®‰è£…dockeræ‰€éœ€çš„ä¾èµ–åŒ…</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# yum install -y yum-utils device-mapper-persistent-data lvm2	</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æ·»åŠ é˜¿é‡Œäº‘çš„dockeré•œåƒåœ°å€</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">&#x26;&#x26;#æˆ–è€…ï¼ˆäºŒé€‰ä¸€å³å¯ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æ›´æ–°ç¼“å­˜ï¼Œåªå¤„ç†æ–°æ·»åŠ çš„yumæºç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# yum makecache fast</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#éƒ¨ç½²dockerï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# yum install -y docker-ce-20.10.14 docker-ce-cli-20.10.14 containerd.io</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹å®‰è£…dockerç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# docker --version(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">æˆ–è€…ä½¿ç”¨docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">Docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 20.10.14,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> build</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> a224086</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#åŠ è½½dockeré…ç½®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# systemctl daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å¯åŠ¨dockeræœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# systemctl start docker</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#è®¾ç½®dockeræœåŠ¡å¼€æœºè‡ªå¯</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# systemctl enable docker</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹dockerå¯ä»¥å®‰è£…çš„ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œyum -y install docker-ce-19.03.12.el7</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# yum list docker-ce --showduplicates | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sort</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -r</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»™dockeræ·»åŠ é•œåƒåŠ é€Ÿå™¨åŠcgroupå¹¶é‡å¯dockeræœåŠ¡" tabindex="-1"><a class="header-anchor" href="#ç»™dockeræ·»åŠ é•œåƒåŠ é€Ÿå™¨åŠcgroupå¹¶é‡å¯dockeræœåŠ¡"><span>ç»™dockeræ·»åŠ é•œåƒåŠ é€Ÿå™¨åŠcgroupå¹¶é‡å¯dockeræœåŠ¡</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# mkdir -p /etc/docker</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# tee /etc/docker/daemon.json &#x3C;&#x3C;-</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">'EOF'</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  "registry-mirrors": ["https://mrlmpasq.mirror.aliyuncs.com"],</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  "exec-opts": ["native.cgroupdriver=systemd"]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#ç”±äºæ–°ç‰ˆkubeletå»ºè®®ä½¿ç”¨systemdï¼Œæ‰€ä»¥å¯ä»¥æŠŠdockerçš„CgroupDriveræ”¹æˆsystemd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#é‡æ–°åŠ è½½dockeré…ç½®</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# systemctl daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#é‡æ–°å¯åŠ¨dockeræœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# systemctl restart docker</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dockeréƒ¨ç½²å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#dockeréƒ¨ç½²å®Œæˆ"><span>dockeréƒ¨ç½²å®Œæˆ</span></a></h3>
<h2 id="éƒ¨ç½²-kubernetes-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-kubernetes-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦éƒ¨ç½²"><span>éƒ¨ç½² kubernetesï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦éƒ¨ç½²ï¼‰</span></a></h2>
<h3 id="é…ç½®ç›¸å…³çš„å†…æ ¸å‚æ•°" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç›¸å…³çš„å†…æ ¸å‚æ•°"><span>é…ç½®ç›¸å…³çš„å†…æ ¸å‚æ•°</span></a></h3>
<p>å°†æ¡¥æ¥çš„IPv4 æµé‡ä¼ é€’åˆ°iptables çš„é“¾</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# cat &#x3C;&#x3C;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> >  </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#è®©å…¶ç”Ÿæ•ˆ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sysctl</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --system</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ·»åŠ -k8s-yumæº" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ -k8s-yumæº"><span>æ·»åŠ  k8s yumæº</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@docker ~]# cat > /etc/yum.repos.d/kubernetes.repo &#x3C;&#x3C; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">[kubernetes]</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">name=Kubernetes</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">enabled=1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">gpgcheck=0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">repo_gpgcheck=0</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#é‡æ–°åŠ è½½ç¼“å­˜</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> makecache</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> fast</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®‰è£…-kubeadm-kubelet-kubectl" tabindex="-1"><a class="header-anchor" href="#å®‰è£…-kubeadm-kubelet-kubectl"><span>å®‰è£… kubeadm kubelet kubectl</span></a></h3>
<blockquote>
<p>æ³¨ï¼šå®‰è£…è¿™å‡ ä¸ªç‰ˆæœ¬ä¸è¦ç”¨æœ€æ–°çš„ï¼Œå®¹æ˜“å‡ºé—®é¢˜</p>
</blockquote>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kubeadm-1.20.0-0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kubelet-1.20.0-0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kubectl-1.20.0-0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹kubeadmç‰ˆæœ¬</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> version</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºè‡ªå¯</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kubelet</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x26;&#x26; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kubelet</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><h3 id="kuberneteså¼ºåŒ–tab-å®‰è£…ä¹‹åä¼štabå¯ä»¥è¡¥å…¨å‘½ä»¤åŠå‚æ•°" tabindex="-1"><a class="header-anchor" href="#kuberneteså¼ºåŒ–tab-å®‰è£…ä¹‹åä¼štabå¯ä»¥è¡¥å…¨å‘½ä»¤åŠå‚æ•°"><span>kuberneteså¼ºåŒ–tabï¼ˆå®‰è£…ä¹‹åä¼štabå¯ä»¥è¡¥å…¨å‘½ä»¤åŠå‚æ•°ï¼‰</span></a></h3>
<ul>
<li>é…ç½®ç¯å¢ƒ</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 'source  &#x3C;(kubectl  completion  bash)'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> >> </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">~/.bashrc</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><blockquote>
<p>1ã€é€€å‡ºè¿æ¥ï¼Œé‡æ–°è¿æ¥ï¼›<br>
2ã€æˆ–è€…<code v-pre>bash</code>æ›´æ–°ç¯å¢ƒå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p>
</blockquote>
<h3 id="æŸ¥çœ‹kubeadmä½¿ç”¨çš„é•œåƒ" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹kubeadmä½¿ç”¨çš„é•œåƒ"><span>æŸ¥çœ‹kubeadmä½¿ç”¨çš„é•œåƒ</span></a></h3>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> config</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> images</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> list</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><blockquote>
<p>å¯ä»¥å‘ç°è¿™é‡Œéƒ½æ˜¯å›½å¤–çš„é•œåƒ<br><br>
<a href="http://k8s.gcr.io/kube-apiserver:v1.20.15" target="_blank" rel="noopener noreferrer">k8s.gcr.io/kube-apiserver:v1.20.15</a><br>
<a href="http://k8s.gcr.io/kube-controller-manager:v1.20.15" target="_blank" rel="noopener noreferrer">k8s.gcr.io/kube-controller-manager:v1.20.15</a><br>
<a href="http://k8s.gcr.io/kube-scheduler:v1.20.15" target="_blank" rel="noopener noreferrer">k8s.gcr.io/kube-scheduler:v1.20.15</a><br>
<a href="http://k8s.gcr.io/kube-proxy:v1.20.15" target="_blank" rel="noopener noreferrer">k8s.gcr.io/kube-proxy:v1.20.15</a><br>
<a href="http://k8s.gcr.io/pause:3.2" target="_blank" rel="noopener noreferrer">k8s.gcr.io/pause:3.2</a><br>
<a href="http://k8s.gcr.io/etcd:3.4.13-0" target="_blank" rel="noopener noreferrer">k8s.gcr.io/etcd:3.4.13-0</a><br>
<a href="http://k8s.gcr.io/coredns:1.7.0" target="_blank" rel="noopener noreferrer">k8s.gcr.io/coredns:1.7.0</a></p>
</blockquote>
<ul>
<li>è§£å†³å›½å¤–é•œåƒä¸èƒ½è®¿é—®çš„é—®é¢˜ï¼Œæ‰§è¡Œkubeadm.shè„šæœ¬ï¼Œç”¨äºæ‹‰å–é•œåƒ/æ‰“tag/åˆ é™¤åŸæœ‰é•œåƒï¼›</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">wget</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -O</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kubeadm.sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> https://files.rundreams.net/sh/kubeadm.sh</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x26;&#x26; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sh</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kubeadm.sh</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><p>ç­‰å¾…æ‹‰å–å®Œæˆã€‚</p>
<blockquote>
<p>å¦‚æœæ„Ÿè§‰æ‹‰å–æ¯”è¾ƒè´¹åŠ²ï¼Œå¯ä»¥ä¸‹è½½kubeadmæ‰€éœ€çš„é•œåƒå’Œè„šæœ¬ï¼š<a href="https://download.csdn.net/download/liu_chen_yang/87587297" target="_blank" rel="noopener noreferrer">kubeadmæ‰€éœ€é•œåƒåŒ…åŠè„šæœ¬v1.20.15ç‰ˆæœ¬<br>
</a></p>
</blockquote>
<p>æ‹‰å–å®ŒæˆæŸ¥çœ‹é•œåƒï¼›</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">docker</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> images</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420231.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2 id="masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#masterèŠ‚ç‚¹"><span>masterèŠ‚ç‚¹</span></a></h2>
<h3 id="åˆå§‹åŒ–masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–masterèŠ‚ç‚¹"><span>åˆå§‹åŒ–masterèŠ‚ç‚¹</span></a></h3>
<p>å¦‚æœæ‰§è¡Œkubeadm initåˆå§‹åŒ–k8sé›†ç¾¤å¤±è´¥äº†ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œkubeadm initåˆå§‹åŒ–è¯­å¥ä¹‹å‰ï¼Œå¯ä»¥å…ˆæ‰§è¡Œ<code v-pre>kubeadm reset</code>å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯é‡ç½®èŠ‚ç‚¹ï¼Œå¤§å®¶å¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤ç†è§£ä¸ºï¼šä¸Šä¸€æ¬¡kubeadm initåˆå§‹åŒ–é›†ç¾¤æ“ä½œå¤±è´¥äº†ï¼Œè¯¥å‘½ä»¤æ¸…ç†äº†ä¹‹å‰çš„å¤±è´¥ç¯å¢ƒã€‚</p>
<p>æ­¤å‘½ä»¤åªåœ¨masterèŠ‚ç‚¹æ‰§è¡Œï¼Œ<code v-pre>172.16.11.221</code>æ›¿æ¢ä¸ºè‡ªå·±çš„masterèŠ‚ç‚¹IPï¼Œ<code v-pre>172.17.10.1/18</code>æ›¿æ¢ä¸ºè‡ªå·±çš„podç½‘æ®µã€‚</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> init</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --kubernetes-version=1.20.15</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --apiserver-advertise-address=172.16.11.221</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --pod-network-cidr=172.17.10.1/18</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><p>åˆå§‹åŒ–æˆåŠŸå›¾ä¸ºä¸‹ï¼š</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420398.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<blockquote>
<p>å¦‚é‡åˆå§‹åŒ–æŠ¥é”™å¯æ ¹æ®<code v-pre>systemctl status kubelet</code> æˆ–è€… <code v-pre>journalctl -xeu kubelet</code> æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯æ¥è§£ã€‚å†³</p>
</blockquote>
<ul>
<li>æ ¹æ®æˆåŠŸæç¤ºå…ˆæ‰§è¡Œä¸‹é¢å†…å®¹<br>
è¿™äº›æ˜¯æˆåŠŸå›¾ä¸­æç¤ºçš„é‚£äº›ï¼Œè¦ç»™ä»–åˆ›å»ºä¸€ä¸‹</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -p</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $HOME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/.kube</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> cp</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/kubernetes/admin.conf</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75"> $HOME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/.kube/config</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">sudo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> chown</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -u</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">id</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -g</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">) </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">$HOME</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/.kube/config</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹nodesèŠ‚ç‚¹</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> nodes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#è¿™ä¸ªæ—¶å€™masteræ˜¯å¤„äºNotReadyçŠ¶æ€çš„ã€‚</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nodeèŠ‚ç‚¹çš„åŠ å…¥" tabindex="-1"><a class="header-anchor" href="#nodeèŠ‚ç‚¹çš„åŠ å…¥"><span>nodeèŠ‚ç‚¹çš„åŠ å…¥</span></a></h3>
<ul>
<li>å®Œæˆä¹‹åå°†åˆšåˆšåˆå§‹åŒ–masterèŠ‚ç‚¹æˆåŠŸåçš„<code v-pre>kubeadm joinä¿¡æ¯</code>å¤åˆ¶åˆ°å…¶ä»–nodeèŠ‚ç‚¹è¿›è¡ŒåŠ å…¥ã€‚</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">node1ï¼š</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">	kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> join</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 172.16.11.221:6443</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --token</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ckgdsy.xa5x21lsjqak2zmr</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> sha256:3bc8dd07b7e88a5f7b0efa81b4ae4918abb440f93f4940c72f9b4a842d6c872b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">node2ï¼š</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">	kubeadm</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> join</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 172.16.11.221:6443</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --token</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ckgdsy.xa5x21lsjqak2zmr</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2"> \</span></span>
<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66">    --discovery-token-ca-cert-hash</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> sha256:3bc8dd07b7e88a5f7b0efa81b4ae4918abb440f93f4940c72f9b4a842d6c872b</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420434.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>nodeèŠ‚ç‚¹æ˜¾ç¤ºè¿™æ ·å°±æ˜¯åŠ è½½æˆåŠŸï¼›</p>
<p>åŠ è½½æˆåŠŸä¹‹åè¿”å›masterèŠ‚ç‚¹æŸ¥çœ‹é›†ç¾¤</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@k8s-master ~]# kubectl get nodes</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420835.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>ç°åœ¨çš„é›†ç¾¤çŠ¶æ€éƒ½æ˜¯<code v-pre>NotReady</code>è¡¨ç¤ºä¸å¯è¾¾ï¼›è¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®‰è£…ä¸€ä¸‹<code v-pre>ç½‘ç»œæ’ä»¶ï¼ˆcaclicoï¼‰</code></p>
<h3 id="ç»™masterèŠ‚ç‚¹å®‰è£…podç½‘ç»œæ’ä»¶-calico" tabindex="-1"><a class="header-anchor" href="#ç»™masterèŠ‚ç‚¹å®‰è£…podç½‘ç»œæ’ä»¶-calico"><span>ç»™masterèŠ‚ç‚¹å®‰è£…Podç½‘ç»œæ’ä»¶ï¼ˆcalicoï¼‰</span></a></h3>
<blockquote>
<p>é€‰æ‹©ç½‘ç»œæ’ä»¶ï¼š<a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/" target="_blank" rel="noopener noreferrer">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a><br>
å¿«é€Ÿå¼€å§‹é…ç½®ï¼š<a href="https://projectcalico.docs.tigera.io/archive/v3.20/getting-started/clis/calicoctl/install" target="_blank" rel="noopener noreferrer">https://projectcalico.docs.tigera.io/archive/v3.20/getting-started/clis/calicoctl/install</a><br>
calicoç½‘ç»œæ’ä»¶ï¼š<a href="https://docs.projectcalico.org/v3.9/getting-started/kubernetes/" target="_blank" rel="noopener noreferrer">https://docs.projectcalico.org/v3.9/getting-started/kubernetes/</a></p>
</blockquote>
<ul>
<li>åœ¨masterèŠ‚ç‚¹å®‰è£…calico</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> apply</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> https://docs.projectcalico.org/v3.9/manifests/calico.yaml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420304.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<ul>
<li>ç¡®è®¤ä¸€ä¸‹calicoæ˜¯å¦å®‰è£…æˆåŠŸ</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pods</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --all-namespaces</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -w</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pods</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -n</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> kube-system</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -w</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æŸ¥çœ‹èŠ‚ç‚¹è¿æ¥çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹èŠ‚ç‚¹è¿æ¥çŠ¶æ€"><span>æŸ¥çœ‹èŠ‚ç‚¹è¿æ¥çŠ¶æ€</span></a></h3>
<p>å®‰è£…å®Œæˆä¹‹åï¼Œå†æ¬¡è¿”å›masterèŠ‚ç‚¹æŸ¥çœ‹é›†ç¾¤ï¼Œåœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤çœ‹é›†ç¾¤æ˜¯å¦æˆåŠŸ</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> nodes</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æˆ–è€…ä½¿ç”¨åŠ -o wideæŸ¥çœ‹è¯¦ç»†</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> nodes</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> wide</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>STATUS çŠ¶æ€ä¸º<code v-pre>Ready</code>åˆ™è¿æ¥æˆåŠŸã€‚</p>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420932.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420435.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2 id="æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•"><span>æµ‹è¯•</span></a></h2>
<ul>
<li>å†™ä¸€ä¸ªnginxçš„yamlæ–‡ä»¶</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> > </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">pod_nginx_rs.yaml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x3C;&#x3C;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">apiVersion: apps/v1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">kind: ReplicaSet</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">metadata:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  name: nginx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  labels:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    tier: frontend</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">spec:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  replicas: 3</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  selector:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    matchLabels:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">      tier: frontend</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  template:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    metadata:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">      name: nginx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">      labels:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">        tier: frontend</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    spec:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">      containers:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">      - name: nginx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">        image: nginx</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">        ports:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">        - containerPort: 80</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>æ ¹æ®pod_nginx_rs.ymlæ–‡ä»¶åˆ›å»ºpod</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> apply</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pod_nginx_rs.yaml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><ul>
<li>æŸ¥çœ‹pod</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹æ‰€æœ‰çš„pod</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pods</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹æ‰€æœ‰çš„podè¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pods</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> wide</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹æ‰€æœ‰çš„podè¶…çº§è¯¦ç»†ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> describe</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pod</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> nginx</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420100.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<ul>
<li>é€šè¿‡rså°†podæ‰©å®¹ä¸º5ä¸ªnginxæœåŠ¡</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å°†nginxæœåŠ¡ç”±3ä¸ªæ‰©å®¹ä¸º5ä¸ª</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> scale</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> rs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> nginx</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --replicas=5</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æŸ¥çœ‹æ‰€æœ‰çš„pod</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pods</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> wide</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>å…‰æœ‰ReplicaSetæ˜¯ä¸è¡Œçš„ï¼ŒReplicaSetä¸ä¼šæä¾›æœåŠ¡çš„ï¼Œéœ€è¦ä¸€ä¸ªServiceã€‚å°†å®ƒåº”ç”¨åˆ°é›†ç¾¤é‡Œé¢å»ã€‚</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> > </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">pod_nginx_rs_svc.yaml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> &#x3C;&#x3C;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">apiVersion: v1</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">kind: Service              # ç±»å‹æ˜¯service</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">metadata:                  </span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  name: nginx              # è¿™ä¸ªserviceçš„å…¨å±€å”¯ä¸€åç§°</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">spec:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  type: NodePort</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  ports:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    - port: 80             # serviceæä¾›æœåŠ¡çš„ç«¯å£å·</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">      nodePort: 30000      # æƒ³è¦å¯¹å¤–çš„ç«¯å£</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">  selector:</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    tier: frontend         # æŠŠæ‹¥æœ‰{tier:labels}æˆ–è€…{app:labels}è¿™ä¸ªæ ‡ç­¾çš„podåº”ç”¨åˆ°è¿™ä¸ªæœåŠ¡é‡Œé¢</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">EOF</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸åŠ <code v-pre>nodePort</code>ä¹Ÿå°±æ˜¯ä¸æŒ‡å®šnodeportï¼Œé»˜è®¤ä¼šéšæœºè¾“å‡ºç«¯å£ï¼Œå¯ä»¥é€šè¿‡<code v-pre>kubectl get svc</code>æŸ¥çœ‹ï¼›</p>
<p>å¦‚æœéœ€è¦ä¿®æ”¹ç«¯å£èŒƒå›´ï¼Œå¦‚æœæ˜¯æŒ‰ç…§æˆ‘çš„æ–¹å¼éƒ¨ç½²çš„ï¼Œå¯åœ¨ï¼š<code v-pre>vim /etc/kubernetes/manifests/kube-apiserver.yaml</code> çš„ç¬¬17è¡Œè¿›è¡Œä¿®æ”¹ï¼Œé»˜è®¤èŒƒå›´æ˜¯30000-32767ã€‚</p>
<ul>
<li>æ ¹æ® pod_nginx_rs_svc.yml æ–‡ä»¶åˆ›å»ºservicesï¼Œéœ€å¯¹å¤–è®¿é—®</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> apply</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pod_nginx_rs_svc.yaml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><ul>
<li>æŸ¥çœ‹services</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> svc</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> services</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420085.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<blockquote>
<p>kubectl get svc ä¸­çš„ type ã€‚</p>
<ul>
<li>Cluster IP ä¸ºæœåŠ¡å™¨å†…éƒ¨ä½¿ç”¨</li>
<li>Node Port ä¸ºæœåŠ¡å™¨å†…éƒ¨å¤–éƒ¨éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥æŒ‡å®šç«¯å£ä¹Ÿå¯ä»¥éšæœºç«¯å£ã€‚</li>
</ul>
</blockquote>
<ul>
<li>å¯åŠ¨servicesä¹‹åï¼ŒæŸ¥çœ‹ç«¯å£</li>
</ul>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420877.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>ç«¯å£ä¸º30000ï¼Œé¡µé¢è®¿é—®ï¼Œ<font color=red>èŠ‚ç‚¹çš„ip+30000;</font></p>
<blockquote>
<font color=red>èŠ‚ç‚¹çš„ipå¯ä»¥ä¸ºä¸»èŠ‚ç‚¹çš„ipï¼Œä¹Ÿå¯ä»¥ä¸ºä»èŠ‚ç‚¹çš„ipã€‚</font></blockquote>
<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161419732.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<ul>
<li>åˆ é™¤serviecså’Œpod</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#åˆ é™¤serviecs</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> delete</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pod_nginx_rs_svc.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#åˆ é™¤pod</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">kubectl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> delete</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> pod_nginx_rs.yaml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®Œç»“â­•" tabindex="-1"><a class="header-anchor" href="#å®Œç»“â­•"><span>å®Œç»“â­•</span></a></h2>
<p>å†…å®¹ä¸»è¦å‚è€ƒä¸ï¼š<a href="https://blog.csdn.net/u010800804/article/details/124524688?app_version=5.15.0&amp;csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22124524688%22,%22source%22:%22liu_chen_yang%22%7D&amp;utm_source=app" target="_blank" rel="noopener noreferrer">ã€äº‘åŸç”Ÿ-K8sã€‘kubeadmæ­å»ºk8sé›†ç¾¤ã€ä¸æˆåŠŸæ‰‹æŠŠæ‰‹æ•™å­¦ã€‘<br>
</a><br>
æ„Ÿè°¢å¤§å®¶çš„è§‚çœ‹ï¼ï¼ï¼</p>
</div></template>


