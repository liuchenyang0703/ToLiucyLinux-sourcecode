<template><div><blockquote>
<p>ğŸ‘¨â€ğŸ“<strong>åšä¸»ç®€ä»‹</strong></p>
<p>â€ƒâ€ƒğŸ…<a href="https://blog.csdn.net/liu_chen_yang?type=blog" target="_blank" rel="noopener noreferrer">äº‘è®¡ç®—é¢†åŸŸä¼˜è´¨åˆ›ä½œè€…</a><br>
â€ƒâ€ƒğŸ…<a href="https://bbs.huaweicloud.com/community/myblog" target="_blank" rel="noopener noreferrer">åä¸ºäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»</a><br>
â€ƒâ€ƒğŸ…<a href="https://developer.aliyun.com/my?spm=a2c6h.13148508.setting.3.21fc4f0eCmz1v3#/article?_k=zooqoz" target="_blank" rel="noopener noreferrer">é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»</a><br>
ğŸ’Š<strong>äº¤æµç¤¾åŒºï¼š</strong><a href="https://bbs.csdn.net/forums/lcy" target="_blank" rel="noopener noreferrer">è¿ç»´äº¤æµç¤¾åŒº</a> æ¬¢è¿å¤§å®¶çš„åŠ å…¥ï¼<br>
ğŸ‹ å¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥ï¼ğŸ˜„<br>
ğŸ‰å¦‚æœæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿ ç‚¹èµ ğŸ‘ğŸ» è¯„è®º ğŸ’¬ æ”¶è— â­ï¸ åŠ å…³æ³¨+ğŸ’—</p>
</blockquote>
<hr>
<h2 id="ä¸€ã€ansible-ä¸­çš„-playbook-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ansible-ä¸­çš„-playbook-æ¨¡å¼"><span>ä¸€ã€Ansible ä¸­çš„ Playbook æ¨¡å¼</span></a></h2>
<p>â€ƒâ€ƒPlaybookä¸åŒäºä½¿ç”¨å•ä¸ªæ¨¡å—æ“ä½œè¿œç¨‹æœåŠ¡å™¨ï¼ŒPlaybookçš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚å¦‚æœè¯´å•ä¸ªæ¨¡å—æ‰§è¡Œç±»ä¼¼äºLinuxç³»ç»Ÿä¸­çš„å‘½ä»¤ï¼Œé‚£ä¹ˆPlaybookå°±ç±»ä¼¼äºshellè„šæœ¬ï¼Œå°†å¤šä¸ªæ¨¡å—ç»„åˆèµ·æ¥å®ç°ä¸€ç»„çš„æ“ä½œã€‚</p>
<p><code v-pre>Playbook</code>è¿˜æ˜¯ä¼šç”¨åˆ°<code v-pre>ad-hoc</code>æ¨¡å¼ä¸­çš„æ¨¡å—åŠå‚æ•°ï¼Œåªä¸è¿‡<code v-pre>Playbookä¸ad-hoc</code>çš„å†™æ³•ä¸ä¸€æ ·ã€‚</p>
<h3 id="_1-1-playbook-çš„ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#_1-1-playbook-çš„ä¼˜åŠ¿"><span>1.1 Playbook çš„ä¼˜åŠ¿</span></a></h3>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> åŠŸèƒ½æ¯”<code v-pre>ad-hoc</code>æ›´å…¨</label></li>
</ul>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> èƒ½å¾ˆå¥½çš„æ§åˆ¶å…ˆåæ‰§è¡Œé¡ºåº, ä»¥åŠä¾èµ–å…³ç³»</label></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> è¯­æ³•å±•ç°æ›´åŠ çš„ç›´è§‚</label></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> ad-hocæ— æ³•æŒä¹…ä½¿ç”¨ï¼Œplaybookå¯ä»¥æŒä¹…ä½¿ç”¨</label></li>
</ul>
<h3 id="_1-2-playbook-çš„ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#_1-2-playbook-çš„ç»„æˆ"><span>1.2 Playbook çš„ç»„æˆ</span></a></h3>
<p><code v-pre>play</code>ï¼šä¸€ä¸ªå®Œæ•´çš„éƒ¨ç½²ä»»åŠ¡ï¼Œå¹¶ä¸”å¿…é¡»åŒ…å«ä»¥ä¸‹å‰ä¸¤é¡¹:</p>
<p>â€ƒâ€ƒ<code v-pre>hosts</code>ï¼šå®šä¹‰å¯¹å“ªäº›ä¸»æœºè¿›ç¨‹æ“ä½œ</p>
<p>â€ƒâ€ƒ<code v-pre>tasks</code>ï¼šå®šä¹‰çš„æ˜¯å…·ä½“æ‰§è¡Œçš„ä»»åŠ¡</p>
<p>â€ƒâ€ƒ<code v-pre>become</code>ï¼šè¡¨ç¤ºæ˜¯å¦è¦ä»¥ç‰¹æƒç”¨æˆ·ï¼ˆé€šå¸¸æ˜¯rootï¼‰èº«ä»½æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœè®¾ç½®ä¸º<code v-pre>yes</code>ï¼Œåˆ™ä»»åŠ¡ä¼šä»¥ç‰¹æƒèº«ä»½æ‰§è¡Œã€‚</p>
<p><code v-pre>playbook</code>: ç”±ä¸€ä¸ªæˆ–å¤šä¸ª<code v-pre>play</code>ç»„æˆï¼Œä¸€ä¸ªplayå¯ä»¥åŒ…å«å¤šä¸ª<code v-pre>task</code>ä»»åŠ¡</p>
<font color=red>è¯´æ˜ï¼š`Ansible` ä¸­çš„ `Playbook` æ–‡ä»¶ç»“å°¾ä¸º`.yml` æ ¼å¼</font><p>ç¤ºä¾‹httpd.ymlï¼šå®‰è£…httpdï¼›</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">apache</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  become</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Install httpd Server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£æï¼š</p>
<p><code v-pre>name</code>ï¼šå®šä¹‰ä¸€ä¸ªPlaybookçš„åç§°ï¼Œç”¨äºæ ‡è¯†Playbookçš„ç”¨é€”ï¼›</p>
<p><code v-pre>hosts</code>ï¼šæŒ‡å®šè¦åœ¨å“ªä¸ªä¸»æœºä¸Šæ‰§è¡Œï¼Œä¹Ÿæ˜¯å†™ä¸»æœºæˆ–ä¸»æœºç»„åï¼Œéœ€è¦æå‰åœ¨<code v-pre>/etc/ansible/hosts</code>ä¸­é…ç½®å¥½ï¼›</p>
<p><code v-pre>become</code>ï¼šyesè¡¨ç¤ºä½¿ç”¨ç‰¹æƒç”¨æˆ·ï¼›</p>
<p><code v-pre>tasks</code>ï¼šå±äºæ˜¯ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œä¸»è¦å†™å…·ä½“æ‰§è¡Œä»€ä¹ˆçš„ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼‰ï¼›</p>
<p>â€ƒâ€ƒ<code v-pre>name</code>ï¼šæ¯ä¸ªä»»åŠ¡çš„åç§°ï¼Œç”¨äºæè¿°å¹²ä»€ä¹ˆçš„ï¼›ä¸Šè¿°ymlä¸­åˆ™æ˜¯<code v-pre>å®‰è£…httpdæœåŠ¡</code>ï¼›</p>
<p>â€ƒâ€ƒ<code v-pre>yum</code>ï¼šè¡¨ç¤ºä½¿ç”¨å“ªä¸ªæ¨¡å—æ¥è¿›è¡Œæ“ä½œï¼›<code v-pre>æ¨¡å—çš„å‚æ•°å¯ä»¥çœ‹ad-hocä¸­çš„ï¼Œç”¨çš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå†™æ³•ä¸ä¸€æ ·å°±æ˜¯ï¼›</code></p>
<p>â€ƒâ€ƒâ€ƒâ€ƒ<code v-pre>name</code>ï¼šè¦å®‰è£…çš„æœåŠ¡åç§°ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯httpdï¼š</p>
<p>â€ƒâ€ƒâ€ƒâ€ƒ<code v-pre>state</code>ï¼šè¦è¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ˜¯å®‰è£…ã€å¸è½½ã€æ›´æ–°ï¼›</p>
<p>å…¶å®<code v-pre>tasks</code>å°±æ˜¯Ansibleçš„æ¨¡å—ä»¥YAMLè¯­æ³•å†™å…¥åˆ°playbookä¸­ã€‚</p>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§é€šå¸¸ä¸€ä¸ªplaybookä¸­åªç¼–å†™ä¸€ä¸ªplayï¼Œå¦‚æœæŸäº›ä¸»æœºéœ€è¦æ‰§è¡Œå¤šä¸ªplay,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨includeå…³é”®å­—åœ¨ä¸€ä¸ªplaybookä¸­å¯¼å…¥å…¶ä»–çš„playbookã€‚</p>
<h3 id="_1-3-playbook-å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_1-3-playbook-å‘½ä»¤"><span>1.3 Playbook å‘½ä»¤</span></a></h3>
<p>æ ¼å¼ï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [é€‰é¡¹] playbook.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><p>å¸¸ç”¨é€‰é¡¹ï¼š</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹/å‚æ•°</th>
<th>é€‰é¡¹/å‚æ•° è§£æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>-T</td>
<td>å»ºç«‹SSHè¿æ¥çš„è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td>-i</td>
<td>æŒ‡å®šInventoryæ–‡ä»¶</td>
</tr>
<tr>
<td>-f</td>
<td>å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º5</td>
</tr>
<tr>
<td>- -list-hosts</td>
<td>åŒ¹é…çš„æœåŠ¡å™¨åˆ—è¡¨</td>
</tr>
<tr>
<td>- -list-tasks</td>
<td>åˆ—å‡ºä»»åŠ¡åˆ—è¡¨</td>
</tr>
<tr>
<td>- -step</td>
<td>æ¯æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ååœæ­¢ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤</td>
</tr>
<tr>
<td>- -syntax-check</td>
<td>è¯­æ³•æ£€æµ‹</td>
</tr>
<tr>
<td>- -list-tags</td>
<td>åˆ—å‡ºæ­¤ymlæ–‡ä»¶ä¸­çš„æ‰€æœ‰tagæ ‡ç­¾</td>
</tr>
<tr>
<td>- -skip-tags</td>
<td>æ‰§è¡Œâ€“skip-tagsä¹‹å¤–çš„æ ‡ç­¾ä»»åŠ¡</td>
</tr>
<tr>
<td>-C</td>
<td>æ£€æŸ¥å½“å‰è¿™ä¸ªPlaybookæ˜¯å¦ä¼šä¿®æ”¹å—æ§ç«¯ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œ</td>
</tr>
</tbody>
</table>
<h3 id="_1-4-playbook-çš„è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#_1-4-playbook-çš„è¯­æ³•"><span>1.4 Playbook çš„è¯­æ³•</span></a></h3>
<ul>
<li>æƒé™</li>
</ul>
<p><code v-pre>remote_user</code>æŒ‡å®š<code v-pre>playbook</code>è¿è¡Œæ—¶çš„ç”¨æˆ·èº«ä»½ï¼Œå¯ä»¥å†™åœ¨hostsä¸‹ï¼Œä¹Ÿå¯ä»¥æ¯ä¸ªtasksåšå®šä¹‰ï¼›</p>
<p><code v-pre>become  </code>è¯¥é€‰é¡¹ä¸ºå¸ƒå°”å€¼ï¼Œå½“ç­‰äºyesè¡¨ç¤ºä»¥ç®¡ç†å‘˜èº«ä»½é€šå¸¸ä¸<code v-pre>become_method</code>ä¸€èµ·ä½¿ç”¨ï¼›</p>
<p><code v-pre>become_method</code>ï¼šsuæˆ–sudo</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æŒ‡å®šä½¿ç”¨å“ªä¸ªç”¨æˆ·æ‰§è¡Œæ­¤ä»»åŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ˜¯å¦ä½¿ç”¨ç‰¹æƒç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">become</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>é€šçŸ¥ä¸è§¦å‘</li>
</ul>
<p><code v-pre>notify</code> å¦‚æœæŒ‡å®šçš„æ“ä½œæ‰§è¡Œäº†ï¼Œä¼šè§¦å‘<code v-pre>handlers</code>çš„æ“ä½œï¼ŒæŒ‡å®šçš„æ˜¯handlerçš„åç§°ï¼›</p>
<p><code v-pre>handlers</code>å’Œ<code v-pre>notify</code>æŒ‡å®šçš„åç§°å¿…é¡»ç›¸åŒï¼Œå¦åˆ™æ— æ³•è§¦å‘ã€‚</p>
<p><code v-pre>handlers</code> ä¸­éœ€è¦<code v-pre>- name</code>æŒ‡å®šåç§°	ï¼Œ<code v-pre>handlers</code>åªä¼šåœ¨æ‰€æœ‰çš„<code v-pre>tasks</code>æ‰§è¡Œå®Œåæ‰§è¡Œï¼Œå¹¶ä¸”ï¼Œå³ä¾¿ä¸€ä¸ª<code v-pre>handlers</code>è¢«è§¦å‘å¤šæ¬¡ï¼Œä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ <code v-pre>handlers</code>æ˜¯ä¸€ç§ç‰¹æ®Šçš„<code v-pre>tasks</code>ã€‚</p>
<ul>
<li>handlersï¼ˆè§¦å‘äº‹ä»¶ï¼‰</li>
</ul>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">notify:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> è§¦å‘</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">handlersï¼šè§¦å‘çš„åŠ¨ä½œ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># ä¸¤è€…çš„åç§°ä¸€å®šè¦ç›¸åŒï¼Œå¦åˆ™æ— æ³•è§¦å‘ã€‚</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ä¸Šåœºæ™¯ï¼šä¸€èˆ¬éƒ½æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶</p>
<p>æ­£å¸¸æƒ…å†µæ—¶handlersæ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œé™¤éè§¦å‘ä»»åŠ¡ï¼Œæ‰ä¼šæ‰§è¡Œ</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">installredis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">name=redis</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">copyfile</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    template</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">src=redis.conf dest=/etc/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">copyfile</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    notify</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">restart</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">		# è§¦å‘ï¼šè§¦å‘åç§°</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">start</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">     service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">started</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  handlers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:				</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è§¦å‘åŠ¨ä½œ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">restart</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">     service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">restarted</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-5-playbook-ä¸­çš„å˜é‡" tabindex="-1"><a class="header-anchor" href="#_1-5-playbook-ä¸­çš„å˜é‡"><span>1.5 Playbook ä¸­çš„å˜é‡</span></a></h3>
<blockquote>
<p>â€ƒâ€ƒå˜é‡æä¾›äº†ä¾¿æ·çš„æ–¹å¼æ¥ç®¡ç†<code v-pre>Ansible playbook</code>çš„æ¯ä¸€ä¸ªé¡¹ç›®ä¸­çš„åŠ¨æ€å€¼ï¼Œæ¯”å¦‚nginx-1.6.3è¿™ä¸ªè½¯ä»¶åŒ…çš„ç‰ˆæœ¬ï¼Œåœ¨å…¶å®ƒåœ°æ–¹æˆ–è®¸ä¼šåå¤ä½¿ç”¨ï¼Œé‚£ä¹ˆå¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºå˜é‡ï¼Œç„¶åå†åœ¨å…¶ä»–çš„playbookä¸­è°ƒç”¨ï¼Œä¼šæ–¹ä¾¿è®¸å¤šã€‚å¦‚æ­¤ä¸€æ¥è¿˜æ–¹ä¾¿ç»´æŠ¤ï¼Œå‡å°‘ç»´æŠ¤çš„æˆæœ¬ã€‚</p>
</blockquote>
<ul>
<li>å˜é‡çš„å®šä¹‰æ–¹å¼</li>
</ul>
<p>1.é€šè¿‡<code v-pre>å‘½ä»¤è¡Œ</code>è¿›è¡Œå˜é‡å®šä¹‰</p>
<p>2.åœ¨<code v-pre>playæ–‡ä»¶</code>ä¸­è¿›è¡Œå˜é‡å®šä¹‰</p>
<p>3.é€šè¿‡<code v-pre>Inventoryä¸»æœºä¿¡æ¯</code>æ–‡ä»¶ä¸­è¿›è¡Œå˜é‡å®šä¹‰</p>
<font color=red>å˜é‡è¯»å–çš„ä¼˜å…ˆçº§ä¸º: `å‘½ä»¤è¡Œ > playbookæ–‡ä»¶ > Inventory`æ–‡ä»¶</font><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-4" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-4"> é€šè¿‡varså®šä¹‰å˜é‡</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">LAMP</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  vars</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    packages_name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">mariadb-server</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">php</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">php-mysql</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">install LAMP</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">         name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{packages_name}}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">         state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œæ­¤ymlï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> LAMP.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œyml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> LAMP.ymlï¼ˆå®šä¹‰çš„ymlæ–‡ä»¶åï¼‰</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-5" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-5"> é€šè¿‡vars_fileså®šä¹‰å˜é‡</label></li>
</ul>
<p>å½“å˜é‡è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨varså®šä¹‰æ²¡æœ‰é—®é¢˜ï¼Œå½“å˜é‡è¾ƒå¤šæ—¶ï¼Œå¯ä»¥å°†å˜é‡ä¿å­˜åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼›</p>
<p>éœ€è¦å¤šä¸ªymlæ–‡ä»¶ï¼Œä¸€ä¸ªä¸»æ–‡ä»¶ï¼Œéœ€è¦è°ƒç”¨å…¶ä»–ymlç‹¬ç«‹æ–‡ä»¶ï¼Œä¸»è¦æ˜¯æœ€åè¿è¡Œçš„ï¼›å…¶ä»–æ˜¯å®šä¹‰åŒ…åçš„ymlæ–‡ä»¶ã€‚</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å®šä¹‰é˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># my_vars.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">httpd_package</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mariadb_package</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">mariadb-server</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#è°ƒç”¨é˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># apache.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">apache</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  become</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  vars_files</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">my_vars.yml</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">  # å¼•å…¥å˜é‡æ–‡ä»¶</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Install httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ httpd_package }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      become</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Install mariadb-server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ mariadb_package }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      become</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œæ­¤ymlï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> apache.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œyml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> apache.ymlï¼ˆå®šä¹‰çš„ymlæ–‡ä»¶åï¼‰</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-6" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-6"> å®˜æ–¹æ¨èå®šä¹‰å˜é‡æ–¹æ³•</label></li>
</ul>
<p>ä¹‹å‰çš„å‡ ç§å˜é‡å®šä¹‰éƒ½ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œæ¯”è¾ƒå¥½ç”¨çš„æ˜¯åœ¨Ansibleé¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªå˜é‡ç›®å½•ï¼š</p>
<p>host_vars</p>
<p>group_vars</p>
<p>ç›®å½•åå­—ä¸€å®šè¦ä¸€è‡´ï¼Œä¸èƒ½åšä»»ä½•ä¿®æ”¹ã€‚</p>
<p>â€ƒâ€ƒç†è§£å¦‚ä½•è®¾ç½®å’Œä½¿ç”¨<code v-pre>host_vars</code>å’Œ<code v-pre>group_vars</code>å¯ä»¥ä½¿ä½ çš„Ansibleç®¡ç†æ›´åŠ çµæ´»å’Œæœ‰ç»„ç»‡ã€‚ä»¥ä¸‹æ˜¯æ›´è¯¦ç»†çš„æ­¥éª¤ï¼Œä»è®¾ç½®ç›®å½•ç»“æ„åˆ°åˆ›å»ºPlaybookçš„æ‰§è¡Œï¼š</p>
<ol>
<li>
<p><strong>ç›®å½•ç»“æ„</strong>ï¼š<br>
åœ¨ä½ çš„Ansibleé¡¹ç›®ç›®å½•ä¸‹ï¼Œç¡®ä¿è®¾ç½®ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š</p>
<div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span>your_ansible_project/</span></span>
<span class="line"><span>â”œâ”€â”€ group_vars/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ web-servers.yml</span></span>
<span class="line"><span>â”œâ”€â”€ host_vars/</span></span>
<span class="line"><span>â”‚   â””â”€â”€ web-server.yml</span></span>
<span class="line"><span>â”œâ”€â”€ playbook.yml</span></span>
<span class="line"><span>â””â”€â”€ inventory.ini</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code v-pre>group_vars</code>ç›®å½•ç”¨äºå­˜æ”¾ç»„çº§åˆ«çš„å˜é‡å®šä¹‰ã€‚</li>
<li><code v-pre>host_vars</code>ç›®å½•ç”¨äºå­˜æ”¾ä¸»æœºçº§åˆ«çš„å˜é‡å®šä¹‰ã€‚</li>
<li><code v-pre>playbook.yml</code>æ˜¯ä½ çš„Ansible Playbookã€‚</li>
<li><code v-pre>inventory.ini</code>æ˜¯Ansibleçš„ä¸»æœºæ¸…å•æ–‡ä»¶ï¼Œå…¶ä¸­åˆ—å‡ºäº†ä½ çš„ä¸»æœºå’Œä¸»æœºç»„ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ¸…å•æ–‡ä»¶ (<code v-pre>inventory.ini</code>)</strong>ï¼š<br>
ç¡®ä¿åœ¨æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰äº†ä½ çš„ä¸»æœºå’Œä¸»æœºç»„ã€‚ä¾‹å¦‚ï¼š</p>
<p><code v-pre>vim /etc/ansible/inventory.ini</code></p>
<div class="language-ini line-numbers-mode" data-highlighter="shiki" data-ext="ini" data-title="ini" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div></li>
</ol>
<p>[web-servers]<br>
172.16.11.209 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass='123123'</p>
<div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>3. **ç»„çº§åˆ«å˜é‡ (`group_vars/web-servers.yml`)**ï¼š</span></span>
<span class="line"><span>åœ¨`group_vars`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œä¾‹å¦‚`web-servers.yml`ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ç»„çº§åˆ«çš„å˜é‡ï¼Œå¦‚ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span>`mkdir -p /etc/ansible/group_vars &#x26;&#x26; vim /etc/ansible/group_vars/web-servers.yml`</span></span>
<span class="line"><span></span></span>
<span class="line"><span>```yaml</span></span>
<span class="line"><span># group_vars/web-servers.yml</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>httpd_package: httpd</span></span>
<span class="line"><span>mariadb_package: mariadb-server</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4">
<li>
<p><strong>ä¸»æœºçº§åˆ«å˜é‡ (<code v-pre>host_vars/web-server.yml</code>)</strong>ï¼š<br>
åœ¨<code v-pre>host_vars</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œä¾‹å¦‚<code v-pre>web-server.yml</code>ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ä¸»æœºçº§åˆ«çš„å˜é‡ï¼Œå¦‚ï¼š</p>
<p><code v-pre>mkdir -p /etc/ansible/host_vars &amp;&amp; vim /etc/ansible/host_vars/web-servers.yml</code></p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># host_vars/web-server.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">http_port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">80</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><strong>Playbook (<code v-pre>playbook.yml</code>)</strong>ï¼š<br>
åˆ›å»ºä½ çš„Ansible Playbookï¼Œä¾‹å¦‚ï¼š</p>
<p><code v-pre>vim /etc/ansible/playbook.yml</code></p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Configure Web Server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web-servers</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  become</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Install HTTPd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ httpd_package }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Start HTTPd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">started</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><strong>è¿è¡ŒPlaybook</strong>ï¼š<br>
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œä½ çš„Playbookï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -i</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> inventory.ini</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> playbook.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div></li>
</ol>
<p>æ­¤æ—¶ï¼ŒAnsibleä¼šè‡ªåŠ¨åŠ è½½<code v-pre>group_vars</code>å’Œ<code v-pre>host_vars</code>ç›®å½•ä¸­çš„å˜é‡ï¼Œä½ çš„Playbookå°†ä½¿ç”¨è¿™äº›å˜é‡æ¥é…ç½®ä¸»æœºã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ›´åŠ æœ‰ç»„ç»‡åœ°ç®¡ç†å˜é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤šä¸»æœºå’Œå¤šç»„çš„ç¯å¢ƒã€‚ä½ å¯ä»¥ä¸ºä¸åŒçš„ç»„æˆ–ä¸»æœºè®¾ç½®ç‰¹å®šçš„å˜é‡ï¼Œè€Œä¸å¿…åœ¨Playbookä¸­ç¡¬ç¼–ç è¿™äº›å€¼ï¼Œæé«˜äº†å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-7" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-7"> å‘½ä»¤è¡Œå®šä¹‰å˜é‡</label></li>
</ul>
<p>ansible-playbookå‘½ä»¤æä¾›-eé€‰é¡¹ï¼Œç”¨äºåœ¨å‘½ä»¤è¡Œå®šä¹‰å˜é‡ï¼Œå‘½ä»¤è¡Œå®šä¹‰å˜é‡çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost yml]# cat /etc/ansible/hosts</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[web]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">172.16.11.209</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[web:vars]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">ansible_ssh_pass</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'123123'</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œï¼šå‘½ä»¤è¡Œå®šä¹‰å˜é‡</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost yml]# vim test.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">---</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> apache</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  hosts:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> web</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  become:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  vars:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    httpd_package:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">       -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> httpd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  tasks:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> httpd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> service</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      yum:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "{{ httpd_package }}"</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        state:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> present</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å®šä¹‰é˜¶æ®µ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@ansible ~]# ansible-playbook test.yml -e </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"web_server=vsftpd"</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_1-6-å˜é‡æ³¨å†Œ" tabindex="-1"><a class="header-anchor" href="#_1-6-å˜é‡æ³¨å†Œ"><span>1.6 å˜é‡æ³¨å†Œ</span></a></h3>
<p>â€ƒâ€ƒå½“anbsibleçš„æ¨¡å—åœ¨è¿è¡Œä¹‹åï¼Œå…¶å®éƒ½ä¼šè¿”å›ä¸€äº›resultç»“æœï¼Œå°±åƒæ˜¯æ‰§è¡Œè„šæœ¬ï¼Œæˆ‘ä»¬æœ‰çš„æ—¶å€™éœ€è¦è„šæœ¬ç»™æˆ‘ä»¬ä¸€äº›returnè¿”å›å€¼ï¼Œæˆ‘ä»¬æ‰çŸ¥é“ï¼Œä¸Šä¸€æ­¥æ˜¯å¦å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œansibleçš„resultå¹¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›è¿”å›å€¼'å­˜å‚¨'åˆ°å˜é‡ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡'è°ƒç”¨'å¯¹åº”çš„å˜é‡åï¼Œä»è€Œè·å–åˆ°è¿™äº›resultï¼Œè¿™ç§å°†æ¨¡å—çš„è¿”å›å€¼ï¼Œå†™å…¥åˆ°å˜é‡ä¸­çš„æ–¹æ³•è¢«ç§°ä¸ºå˜é‡æ³¨å†Œã€‚</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@ansible ~]# vim register.yml</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">---</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> hosts:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> web</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  tasks:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> define</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> var1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      shell:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "whoami"</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      register:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> user_name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> msg</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      debug:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        msg:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "{{ user_name }}"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> get</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> stdout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> msg</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      debug:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        msg:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "{{ user_name.stdout_lines }}"</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost yml]# ansible-playbook register.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">PLAY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [web] ****************************************************************************************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">TASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [Gathering </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Facts]</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> ****************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ok:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [172.16.11.209]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">TASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [define </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> var1]</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> ******************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">changed:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [172.16.11.209]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">TASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [get </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">msg]</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> ************************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ok:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [172.16.11.209] => {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    "msg"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "changed"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> true</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "cmd"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "whoami",</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "delta"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "0:00:00.004924",</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "end"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "2023-10-12 23:21:29.231407",</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "failed"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> false</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "rc"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 0,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "start"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "2023-10-12 23:21:29.226483",</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "stderr"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "",</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "stderr_lines"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [], </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "stdout"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "root",</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "stdout_lines"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">            "root"</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">TASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [get </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">stdout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> msg]</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> *****************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ok:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [172.16.11.209] => {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    "msg"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "root"</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">PLAY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> RECAP</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> ****************************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">172.16.11.209</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">              :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ok=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">4</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    changed=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    unreachable=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    failed=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    skipped=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    rescued=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    ignored=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜:</p>
<p><code v-pre>debug</code>ï¼šæ¨¡å—å¸¸ç”¨å‚æ•°</p>
<p><code v-pre>msg</code>ï¼š    #è°ƒè¯•è¾“å‡ºçš„æ¶ˆæ¯</p>
<p><code v-pre>var</code>:      #å°†æŸä¸ªä»»åŠ¡æ‰§è¡Œçš„è¾“å‡ºä½œä¸ºå˜é‡ä¼ é€’ç»™debugæ¨¡å—ï¼Œdebugä¼šç›´æ¥å°†å…¶æ‰“å°è¾“å‡º</p>
<p><code v-pre>verbosity</code>:    #debugçš„çº§åˆ«ï¼ˆé»˜è®¤æ˜¯0çº§ï¼Œå…¨éƒ¨æ˜¾ç¤ºï¼‰</p>
<h3 id="_1-7-debug-æ¨¡å—-å°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥" tabindex="-1"><a class="header-anchor" href="#_1-7-debug-æ¨¡å—-å°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥"><span>1.7 debug æ¨¡å—ï¼šå°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥</span></a></h3>
<p>å°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥ï¼Œä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šè¿”å›ï¼›</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">debugæµ‹è¯•</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">   - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">æŸ¥çœ‹rootç›®å½•ä¸‹çš„æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">     command</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">ls /root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">     register</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root_directory_contents</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">  # å­˜å‚¨å‘½ä»¤è¾“å‡º</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">   - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">è¾“å‡ºçš„ç»“æœ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">     debug</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       var</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root_directory_contents.stdout_lines</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/885e636225a249ddbfd6d95101b59752.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3 id="_1-8-facts-ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_1-8-facts-ç¼“å­˜"><span>1.8 facts ç¼“å­˜</span></a></h3>
<p>â€ƒâ€ƒAnsible factsæ˜¯åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šé€šè¿‡Ansibleè‡ªåŠ¨é‡‡é›†å‘ç°çš„å˜é‡ã€‚factsåŒ…å«æ¯å°ç‰¹å®šçš„ä¸»æœºä¿¡æ¯ã€‚æ¯”å¦‚ï¼šè¢«æ§ç«¯çš„ä¸»æœºåã€IPåœ°å€ã€ç³»ç»Ÿç‰ˆæœ¬ã€CPUæ•°é‡ã€å†…å­˜çŠ¶æ€ã€ç£ç›˜çŠ¶æ€ç­‰ç­‰ã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-8" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-8"> factså˜é‡çš„ä½¿ç”¨åœºæ™¯</label></li>
</ul>
<ol>
<li>
<p>é€šè¿‡factsç¼“å­˜æ£€æŸ¥CPUï¼Œæ¥ç”Ÿæˆå¯¹åº”çš„nginxé…ç½®æ–‡ä»¶</p>
</li>
<li>
<p>é€šè¿‡factsç¼“å­˜æ£€æŸ¥ä¸»æœºåï¼Œç”Ÿæˆä¸åŒçš„zabbixé…ç½®æ–‡ä»¶</p>
</li>
<li>
<p>é€šè¿‡factsç¼“å­˜æ£€ç´¢ç‰©ç†æœºçš„å†…å­˜å¤§å°æ¥ç”Ÿæˆä¸åŒçš„mysqlé…ç½®æ–‡ä»¶</p>
</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨setupæ¨¡å—æŸ¥çœ‹factså˜é‡åˆ—è¡¨:</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost yml]# ansible nginx -m setup </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">172.16.11.209</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">SUCCESS</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> => </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    "ansible_facts"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "ansible_all_ipv4_addresses"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">            "172.17.0.1"</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">,</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">            "172.16.11.209"</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        ], </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "ansible_all_ipv6_addresses"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">            "fe80::20c:29ff:feaf:dbfa"</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        ], </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">		   ä»¥ä¸‹çœç•¥â€¦</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨playbookä¸­å¼•ç”¨factså˜é‡ï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost ansible]# vim /etc/ansible/hosts </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[web]</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">172.16.11.209</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[web:vars]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">ansible_ssh_pass</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'123123'</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># ymlæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost yml]# cat facts.yml </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">-</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> hosts:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> web</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  tasks:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> shell:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> {{ ansible_os_family }}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      register:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> my_vars</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> debug:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        var:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> my_vars.stdout_lines</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost yml]# ansible-playbook facts.yml </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">PLAY</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [web] ****************************************************************************************************************************************************</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">TASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [Gathering </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Facts]</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> ****************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ok:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [172.16.11.209]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">TASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [shell] **************************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">changed:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [172.16.11.209]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">TASK</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [debug] **************************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ok:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [172.16.11.209] => {</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    "my_vars.stdout_lines"</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">        "RedHat"</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">PLAY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> RECAP</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B"> ****************************************************************************************************************************************************</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">172.16.11.209</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">              :</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ok=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    changed=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    unreachable=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    failed=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    skipped=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    rescued=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">    ignored=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#åœ¨playbookä¸­ï¼Œå¯ä»¥é€šè¿‡gather_factsé€‰é¡¹æ§åˆ¶æ˜¯å¦æ”¶é›†è¿œç¨‹ä¸»æœºï¼Œé»˜è®¤å€¼ä¸ºyes</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="äºŒã€playbook-ä¸­çš„æµç¨‹æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#äºŒã€playbook-ä¸­çš„æµç¨‹æ§åˆ¶"><span>äºŒã€Playbook ä¸­çš„æµç¨‹æ§åˆ¶</span></a></h2>
<h3 id="_2-1-æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-1-æ¡ä»¶"><span>2.1 æ¡ä»¶</span></a></h3>
<p>â€ƒâ€ƒåœ¨æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€æµç¨‹æ§åˆ¶è¯­å¥ä¸­ï¼Œæ¡ä»¶è¯­å¥æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨ä½¿ç”¨Ansibleçš„è¿‡ç¨‹ä¸­ï¼Œæ¡ä»¶åˆ¤æ–­çš„ä½¿ç”¨é¢‘ç‡æå…¶é«˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul class="task-list-container">
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" id="task-item-9" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-9"> ä½¿ç”¨ä¸åŒçš„ç³»ç»Ÿçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åˆ¤æ–­ç³»ç»Ÿæ¥å¯¹è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ã€‚</label></p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" id="task-item-10" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-10"> åœ¨nfså’Œrsyncå®‰è£…è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æœåŠ¡å™¨ä¸éœ€è¦æ¨é€é…ç½®æ–‡ä»¶ï¼Œä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯å†™å¤šä¸ªplayï¼Œä¼šå½±å“æ•ˆç‡ã€‚</label></p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" id="task-item-11" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-11"> åœ¨æºç å®‰è£…nginxçš„æ—¶å€™ï¼Œæ‰§è¡Œç¬¬äºŒéå°±æ— æ³•æ‰§è¡Œäº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦å®‰è£…è¿‡ã€‚</label></p>
</li>
</ul>
<font color=red>playbookä¸­çš„æ¡ä»¶åˆ¤æ–­è¯­å¥ä½¿ç”¨`when`</font><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#å®˜æ–¹æ¡ˆä¾‹</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"shut down Debian flavored systems"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    command</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/sbin/shutdown -t now</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">ansible_facts['os_family'] == "Debian"</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    # note that all variables can be used directly in conditionals without double curly braces</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web_group</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Install CentOS Httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    #å®˜æ–¹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">ansible_facts['os_family'] == "CentOS"</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">    #éå®˜æ–¹</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">ansible_distribution == "CentOS"</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Install Ubuntu Httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">apache2</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">ansible_facts['os_family'] == "Ubuntu"</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿˜å¯ä»¥ä½¿ç”¨æ‹¬å·å¯¹æ¡ä»¶è¿›è¡Œåˆ†ç»„</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"shut down CentOS 6 and Debian 7 systems"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    command</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/sbin/shutdown -t now</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">(ansible_facts['distribution'] == "CentOS" and ansible_facts['distribution_major_version'] == "6") or</span></span>
<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">          (ansible_facts['distribution'] == "Debian" and ansible_facts['distribution_major_version'] == "7")</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥æŒ‡å®šå¤šæ¡ä»¶ä¸ºåˆ—è¡¨</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">tasks:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> name:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "shut down CentOS 6 systems"</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2">    command</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /sbin/shutdown</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -t</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> now</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    when:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ansible_facts['distribution']</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "CentOS"</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ansible_facts['distribution_major_version']</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "6"</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¡ä»¶è¿ç®—</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">tasks:</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  -</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> shell:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "only on Red Hat 6, derivatives, and later"</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">    when:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ansible_facts['os_family']</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ==</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "RedHat"</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> and</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> ansible_facts['distribution_major_version ']</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">|</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">int</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> ></span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> 6</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ä¾‹ï¼š</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">vim when.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">   #ä»£è¡¨ç”¨rootç”¨æˆ·æ‰§è¡Œï¼Œé»˜è®¤æ˜¯rootï¼Œå¯ä»¥çœç•¥</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">createfile</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    copy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">content="test3" dest=/etc/ansible/yml/when.yml</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">a=='3'</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">createfile</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    copy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">content="test4" dest=/etc/ansible/yml/when.yml</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">    when</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">a=='4'</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>å¦‚æœa&quot;3&quot;ï¼Œå°±å°†â€œtest3â€ï¼Œå†™å…¥åˆ°webç»„ä¸‹è¢«ç®¡æ§æœºçš„/etc/ansible/yml/when.ymlä¸­ï¼Œ<br>
å¦‚æœa&quot;4&quot;ï¼Œå°±å°†â€œtest4â€ï¼Œå†™å…¥åˆ°webç»„ä¸‹è¢«ç®¡æ§æœºçš„/etc/ansible/yml/when.ymlä¸­ã€‚</p>
</blockquote>
<p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">  --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> when.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic">#æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -e</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> 'a="3"'</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> when.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-å¾ªç¯" tabindex="-1"><a class="header-anchor" href="#_2-2-å¾ªç¯"><span>2.2 å¾ªç¯</span></a></h3>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-12" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-12"> 1ã€æ ‡å‡†å¾ªç¯ä½¿ç”¨åœºæ™¯ - æ‰¹é‡å®‰è£…è½¯ä»¶</label></li>
</ul>
<div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">vim with_items.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Installed packages</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ item }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">       state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">       - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">wget</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">       - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">tree</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">       - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">lrzsz</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> with_items.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> with_items.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/9ebc2064addb4037b5e5b84db33b5d30.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-13" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-13"> 2ã€æ ‡å‡†å¾ªç¯ä½¿ç”¨åœºæ™¯ - æ‰¹é‡åˆ›å»ºç”¨æˆ·</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">vim item2.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">æ‰¹é‡åˆ›å»ºç”¨æˆ·</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">é…ç½®åˆ›å»ºç”¨æˆ·æ“ä½œ</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ item }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs3</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item2.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item2.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹ï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">tail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> -3</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> /etc/passwd</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/bd06fcb21140445a8912e70c27d75d35.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-14" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-14"> 3ã€å¾ªç¯åµŒå¥—ä½¿ç”¨åœºæ™¯ - æ‰¹é‡åˆ›å»ºç”¨æˆ·å¹¶ç»™ç”¨æˆ·æ·»åŠ ç”¨æˆ·ç»„</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">vim item3.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">æ‰¹é‡åˆ›å»ºç”¨æˆ·ååŠç”¨æˆ·ç»„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">create group</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">name={{ item }} state=present</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">create user</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">name={{ item.name }} group={{ item.groups }} state=present</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'name'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'groups'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'name'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'groups'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'name'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'groups'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item3.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item3.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-15" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-15"> 4ã€å¾ªç¯åµŒå¥—ä½¿ç”¨åœºæ™¯ - æ‰¹é‡åˆ é™¤ç”¨æˆ·åŠç”¨æˆ·ç»„</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">vim item3_1.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">æ‰¹é‡åˆ é™¤ç”¨æˆ·åŠç”¨æˆ·ç»„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">  </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">drop user</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ item.name }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ item.group }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        remove</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">absent</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'name'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'group'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group1</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'name'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'group'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group2</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - {</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'name'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cs3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">'group'</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group3</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">drop group</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      group</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"{{ item }}"</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">absent</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group1</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group2</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">      - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">group3</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item3_1.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item3_1.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-16" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-16"> 5ã€æ ‡å‡†å¾ªç¯ä½¿ç”¨åœºæ™¯ - æ‰¹é‡æ‹·è´å¤šä¸ªæ–‡ä»¶</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">vim item4.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">æ‰¹é‡æ‹·è´æ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">bulk copy</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      copy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">src=/home/test/{{ item.src }} dest=/home/cs/{{ item.dest }} mode={{ item.mode }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"a.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"a.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"0777"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"tongji.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"tongji.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"0777"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># -------------------------------æ­¤ä¸ºåˆ†ç•Œçº¿ï¼Œä¸Šä¸‹äº’ä¸ç›¸å¹²---------------------------------    </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">æ‰¹é‡æ‹·è´æ–‡ä»¶åˆ°ä¸åŒçš„è·¯å¾„</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">bulk copy</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      copy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">src=/home/test/{{ item.src }} dest={{ item.dest }} mode={{ item.mode }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"a.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/home/cs/a.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"0777"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"tongji.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/home/cs1/tongji.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"0777"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è¯­æ³•æ ¡éªŒ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --syntax-check</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item4.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> item4.yml</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-3-å¼‚å¸¸å¤„ç†"><span>2.3 å¼‚å¸¸å¤„ç†</span></a></h3>
<p>é»˜è®¤Playbookä¼šæ£€æŸ¥å‘½ä»¤å’Œæ¨¡å—çš„è¿”å›çŠ¶æ€ï¼Œå¦‚é‡åˆ°é”™è¯¯å°±ä¸­æ–­playbookçš„æ‰§è¡Œ</p>
<p>åŠ å…¥å‚æ•°: <font color=red>ignore_errors: yes</font> 	# å¿½ç•¥é”™è¯¯</p>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cat expect.yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">å¿½ç•¥é”™è¯¯æ¼”ç¤º</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">all</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">ä½¿ç”¨ä¸€ä¸ªæœªçŸ¥çš„å‘½ä»¤</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      command</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">a</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      ignore_errors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">åˆ›å»ºä¸€ä¸ªæ–‡ä»¶</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      file</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">path=/home/cs/yichang state=touch</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç è§£æï¼š</p>
<blockquote>
<p>å¦‚ä¸Šä»£ç ï¼Œæ‰§è¡Œåˆ°commandçš„aå‘½ä»¤æ—¶ï¼ŒæœåŠ¡å™¨æ—¶æ²¡æœ‰è¿™ä¸ªå‘½ä»¤çš„ï¼Œå°±ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™äº†ä¹‹åï¼Œä¸‹é¢çš„æœåŠ¡å°±ä¸ä¼šç»§ç»­æ‰§è¡Œäº†ï¼›</p>
</blockquote>
<blockquote>
<p>æˆ‘ä»¬ç°åœ¨æ·»åŠ äº†ä¸€ä¸ª<code v-pre>ignore_errors: yes</code>ï¼Œè¿™æ ·å°±å¯ä»¥è·³è¿‡è¿™ä¸ªæŠ¥é”™ï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„å†…å®¹ï¼›</p>
</blockquote>
<h3 id="_2-4-tags-æ ‡ç­¾" tabindex="-1"><a class="header-anchor" href="#_2-4-tags-æ ‡ç­¾"><span>2.4 tags æ ‡ç­¾</span></a></h3>
<p>â€ƒâ€ƒé»˜è®¤æƒ…å†µä¸‹ï¼ŒAnsibleåœ¨æ‰§è¡Œä¸€ä¸ªplaybookæ—¶ï¼Œä¼šæ‰§è¡Œplaybookä¸­å®šä¹‰çš„æ‰€æœ‰ä»»åŠ¡ï¼›Ansible playbookä¸­çš„tagæ ‡ç­¾æ˜¯ä¸€ç§ç”¨äºé€‰æ‹©æ€§è¿è¡Œç‰¹å®šä»»åŠ¡æˆ–ä»»åŠ¡é›†çš„æœºåˆ¶ã€‚é€šè¿‡ä¸ºæ¯ä¸ªä»»åŠ¡æŒ‡å®šæ ‡ç­¾ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œplaybookæ—¶é€‰æ‹©åªè¿è¡Œå¸¦æœ‰ç‰¹å®šæ ‡ç­¾çš„ä»»åŠ¡ï¼Œè€Œä¸è¿è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™å¯¹äºæ§åˆ¶å’Œç®¡ç†Ansible playbookçš„æ‰§è¡Œéå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“æ‚¨çš„playbookåŒ…å«è®¸å¤šä»»åŠ¡æ—¶ã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-17" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-17"> 1ã€æ‰“æ ‡ç­¾çš„æ–¹å¼</label></li>
</ul>
<p>å¯¹ä¸€ä¸ªå¯¹è±¡æ‰“ä¸€ä¸ªæ ‡ç­¾</p>
<p>å¯¹ä¸€ä¸ªå¯¹è±¡æ‰“å¤šä¸ªæ ‡ç­¾</p>
<p>å¯¹å¤šä¸ªå¯¹è±¡æ‰“ä¸€ä¸ªæ ‡ç­¾</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-18" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-18"> 2ã€æ ‡ç­¾ä½¿ç”¨ï¼Œé€šè¿‡tagså’Œä»»åŠ¡å¯¹è±¡è¿›è¡Œæ†ç»‘ï¼Œæ§åˆ¶éƒ¨åˆ†æˆ–è€…æŒ‡å®šçš„taskæ‰§è¡Œ</label></li>
</ul>
<p><code v-pre>-t</code>ï¼šæ‰§è¡ŒæŒ‡å®šçš„tagæ ‡ç­¾ä»»åŠ¡</p>
<p><code v-pre>--list-tags</code>ï¼šåˆ—å‡ºæ­¤ymlæ–‡ä»¶ä¸­çš„æ‰€æœ‰tagæ ‡ç­¾</p>
<p><code v-pre>--skip-tags</code>ï¼šæ‰§è¡Œ--skip-tagsä¹‹å¤–çš„æ ‡ç­¾ä»»åŠ¡</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-19" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-19"> 3ã€ä»¥ä¸‹æ˜¯tagæ ‡ç­¾çš„ä½œç”¨ï¼š</label></li>
</ul>
<ol>
<li>
<p>é€‰æ‹©æ€§è¿è¡Œä»»åŠ¡ï¼šå¯ä»¥ä½¿ç”¨<code v-pre>--tags</code>å‚æ•°åœ¨è¿è¡Œansible-playbookå‘½ä»¤æ—¶æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ï¼Œåªæœ‰å¸¦æœ‰æŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡ä¼šè¿è¡Œã€‚è¿™å¯¹äºåœ¨å¤§å‹playbookä¸­åªè¿è¡Œç‰¹å®šä»»åŠ¡éå¸¸æœ‰ç”¨ï¼Œè€Œä¸æ˜¯è¿è¡Œæ•´ä¸ªplaybookã€‚</p>
</li>
<li>
<p>æ’é™¤ä»»åŠ¡ï¼šæ‚¨å¯ä»¥ä½¿ç”¨<code v-pre>--skip-tags</code>å‚æ•°æ¥æ’é™¤å…·æœ‰ç‰¹å®šæ ‡ç­¾çš„ä»»åŠ¡ï¼Œä»è€Œè¿è¡Œé™¤å¸¦æœ‰æŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡ä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–ä»»åŠ¡ã€‚è¿™å¯¹äºåœ¨å¤§å‹playbookä¸­æ’é™¤ä¸éœ€è¦è¿è¡Œçš„ä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚</p>
</li>
<li>
<p>ç»„ç»‡ä»»åŠ¡ï¼šæ ‡ç­¾å¯ä»¥å¸®åŠ©æ‚¨ç»„ç»‡å’Œåˆ†ç±»ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸ºé…ç½®ä»»åŠ¡æ·»åŠ ä¸€ä¸ª<code v-pre>config</code>æ ‡ç­¾ï¼Œä¸ºå®‰è£…ä»»åŠ¡æ·»åŠ ä¸€ä¸ª<code v-pre>install</code>æ ‡ç­¾ï¼Œä»¥ä¾¿æ›´å®¹æ˜“äº†è§£æ¯ä¸ªä»»åŠ¡çš„ç”¨é€”ã€‚</p>
</li>
<li>
<p>æ–‡æ¡£å’Œæ³¨é‡Šï¼šæ ‡ç­¾è¿˜å¯ä»¥ä½œä¸ºä»»åŠ¡çš„æ–‡æ¡£å’Œæ³¨é‡Šã€‚æ‚¨å¯ä»¥å°†æ ‡ç­¾ç”¨ä½œæè¿°ä»»åŠ¡çš„æ–¹å¼ï¼Œä»¥ä¾¿å…¶ä»–äººæ›´å®¹æ˜“ç†è§£æ¯ä¸ªä»»åŠ¡çš„ç›®çš„ã€‚</p>
</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨è¿è¡Œansible-playbookæ—¶ä½¿ç”¨æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p>ä»…è¿è¡Œå¸¦æœ‰<code v-pre>install</code>æ ‡ç­¾çš„ä»»åŠ¡ï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> your_playbook.yml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --tags</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div></li>
<li>
<p>æ’é™¤å¸¦æœ‰<code v-pre>test</code>æ ‡ç­¾çš„ä»»åŠ¡ï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> your_playbook.yml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --skip-tags</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> test</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div></li>
<li>
<p>è¿è¡Œå¸¦æœ‰å¤šä¸ªæ ‡ç­¾çš„ä»»åŠ¡ï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> your_playbook.yml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --tags</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> "install,config"</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div></li>
</ul>
<ul>
<li>
<p>åˆ—å‡ºymlæ–‡ä»¶ä¸­æ‰€æœ‰çš„æ ‡ç­¾</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">ansible-playbook</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> your_playbook.yml</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66"> --list-tags</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div></div></div></li>
</ul>
<p>æ ‡ç­¾åŠŸèƒ½æœ‰åŠ©äºå¢åŠ Ansible playbookçš„å¯ç»´æŠ¤æ€§ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ›´ç²¾ç»†åœ°æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-20" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-20"> 4ã€ã€å®ä¾‹ã€‘éƒ¨ç½²apacheæœåŠ¡å¹¶å¯åŠ¨ï¼Œä¸­é—´å¯ä»¥è‡ªè¡Œè®¾ç½®tagsæ ‡ç­¾ã€‚</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root@localhost yml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">]# </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">vim tags.yml</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">---</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">- </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">éƒ¨ç½²apacheæœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  hosts</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">web</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  remote_user</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">root</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  vars</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">http_port</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">8080</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  tasks</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Install Http Server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">present</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">install_httpd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd_server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">configure httpd server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      copy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">./httpd.conf</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/etc/httpd/conf/httpd.conf</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">0777</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      notify</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Restart Httpd Server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">config_httpd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd_server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">start httpd server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">started</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        enabled</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">start_httpd</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">   </span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">stop httpd server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">stopped</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">stop_httpd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">uninstall httpd server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      yum</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">absent</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">uninstall_httpd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">  handlers</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">Restart Httpd Server</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      systemd</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">        state</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">restarted</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ä¸€ä¸ªAnsible playbookçš„YAMLæ–‡ä»¶ï¼Œç”¨äºéƒ¨ç½²Apache HTTPæœåŠ¡å™¨ã€‚YAMLæ–‡ä»¶è§£æï¼š</p>
<ol>
<li><code v-pre>name: éƒ¨ç½²apacheæœåŠ¡</code>ï¼šè¿™æ˜¯æ•´ä¸ªAnsible playbookçš„åç§°æˆ–æè¿°ã€‚</li>
<li><code v-pre>hosts: web</code>ï¼šè¿™æŒ‡å®šäº†è¯¥playbookå°†åœ¨åä¸º<code v-pre>web</code>çš„ä¸»æœºç»„ä¸Šæ‰§è¡Œã€‚æ‚¨éœ€è¦åœ¨æ‚¨çš„Ansible inventoryæ–‡ä»¶ä¸­å®šä¹‰ä¸»æœºç»„<code v-pre>web</code>ï¼Œæˆ–è€…åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šä¸»æœºã€‚</li>
<li><code v-pre>remote_user: root</code>ï¼šæŒ‡å®šäº†è¿è¡Œä»»åŠ¡æ—¶ä½¿ç”¨rootç”¨æˆ·èº«ä»½æ‰§è¡Œã€‚</li>
<li><code v-pre>vars:</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå˜é‡éƒ¨åˆ†ï¼Œç”¨äºå®šä¹‰å˜é‡ã€‚åœ¨è¿™é‡Œï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code v-pre>http_port</code>çš„å˜é‡ï¼Œå…¶å€¼ä¸º8080ã€‚</li>
<li><code v-pre>tasks:</code>ï¼šè¿™æ˜¯å®é™…ä»»åŠ¡éƒ¨åˆ†ï¼Œå…¶ä¸­åŒ…å«ä¸€ç³»åˆ—ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªåç§°å’Œç›¸åº”çš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªä»»åŠ¡çš„è§£é‡Šï¼š
<ul>
<li>ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼š<code v-pre>Install Http Server</code>ï¼šè¿™ä¸ªä»»åŠ¡ä½¿ç”¨<code v-pre>yum</code>æ¨¡å—æ¥å®‰è£…<code v-pre>httpd</code>è½¯ä»¶åŒ…ï¼Œç¡®ä¿Apache HTTPæœåŠ¡å™¨å·²ç»å®‰è£…åœ¨ä¸»æœºä¸Šã€‚æ­¤ä»»åŠ¡æœ‰ä¸¤ä¸ªtagsï¼š<code v-pre>install_httpd</code>å’Œ<code v-pre>httpd_server</code>ï¼Œä»¥ä¾¿åç»­å¯ä»¥é€‰æ‹©æ€§åœ°è¿è¡Œè¿™äº›ä»»åŠ¡ã€‚</li>
<li>ç¬¬äºŒä¸ªä»»åŠ¡ï¼š<code v-pre>configure httpd server</code>ï¼šè¿™ä¸ªä»»åŠ¡ä½¿ç”¨<code v-pre>copy</code>æ¨¡å—å°†æœ¬åœ°æ–‡ä»¶<code v-pre>httpd.conf</code>å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœºçš„<code v-pre>/etc/httpd/conf/httpd.conf</code>ä½ç½®ï¼Œå¹¶ç»™ç›®æ ‡æ–‡ä»¶è®¾ç½®æ‰§è¡Œæƒé™ï¼Œä»è€Œé…ç½®Apache HTTPæœåŠ¡å™¨ã€‚æ­¤ä»»åŠ¡æœ‰ä¸¤ä¸ªtagsï¼š<code v-pre>config_httpd</code>å’Œ<code v-pre>httpd_server</code>ã€‚ï¼ˆä¸ºä»€ä¹ˆè¦å¤šä½™ç§»åŠ¨è¿™ä¸ªå‘¢ï¼Œå› ä¸ºè¿™ä¸ªé…ç½®é‡Œæˆ‘ä»¬è‡ªå·±å†™çš„ï¼ŒåŒæ—¶ä¹Ÿä¿®æ”¹äº†httpdçš„ç«¯å£ä¸ºï¼š8080ï¼‰ã€‚<code v-pre>notify: Restart Httpd Server</code>æ„å‘³ç€å½“è¯¥ä»»åŠ¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆé€šå¸¸æ˜¯æˆåŠŸå®Œæˆä»»åŠ¡ï¼‰ï¼Œå®ƒå°†è§¦å‘åä¸º &quot;Restart Httpd Server&quot; çš„å¤„ç†ç¨‹åº<code v-pre>handlers</code>ã€‚</li>
<li>ç¬¬ä¸‰ä¸ªä»»åŠ¡ï¼š<code v-pre>start httpd server</code>ï¼šè¿™ä¸ªä»»åŠ¡ä½¿ç”¨<code v-pre>service</code>æ¨¡å—æ¥å¯åŠ¨å¹¶å¯ç”¨Apache HTTPæœåŠ¡å™¨ã€‚æ­¤ä»»åŠ¡æœ‰ä¸€ä¸ªtagï¼š<code v-pre>start_httpd</code>ã€‚</li>
<li>ç¬¬å››ä¸ªä»»åŠ¡ï¼š<code v-pre>stop httpd server</code>ï¼šåœæ­¢HTTPæœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ <code v-pre>service</code> æ¨¡å—å°† <code v-pre>httpd</code> æœåŠ¡åœæ­¢ã€‚æ­¤ä»»åŠ¡æœ‰ä¸€ä¸ªæ ‡ç­¾ <code v-pre>stop_httpd</code>ã€‚</li>
<li>ç¬¬äº”ä¸ªä»»åŠ¡ï¼š<code v-pre>uninstall httpd server</code>ï¼šå¸è½½HTTPæœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ <code v-pre>yum</code> æ¨¡å—å¸è½½ <code v-pre>httpd</code> è½¯ä»¶åŒ…ã€‚æ­¤ä»»åŠ¡æœ‰ä¸€ä¸ªæ ‡ç­¾ <code v-pre>uninstall_httpd</code>ã€‚</li>
</ul>
</li>
<li><code v-pre>handlers:</code>ï¼šè¿™éƒ¨åˆ†å®šä¹‰äº†å¤„ç†ç¨‹åºï¼Œè¿™æ˜¯ä¸€äº›åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨çš„å‘½ååŠ¨ä½œï¼Œé€šå¸¸ä¸é€šçŸ¥ä¸€èµ·ä½¿ç”¨ã€‚åœ¨è¿™é‡Œï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code v-pre>Restart Httpd Server</code>çš„å¤„ç†ç¨‹åºï¼Œå½“<code v-pre>copy</code>ä»»åŠ¡å®Œæˆåï¼Œå¯ä»¥é€šçŸ¥å®ƒã€‚æ­¤å¤„ç†ç¨‹åºä½¿ç”¨<code v-pre>systemd</code>æ¨¡å—æ¥é‡æ–°å¯åŠ¨<code v-pre>httpd</code>æœåŠ¡ã€‚</li>
</ol>
<p>è¿™ä¸ªPlaybookå…è®¸æ‚¨æ‰§è¡Œä¸Apache HTTPæœåŠ¡å™¨æœ‰å…³çš„å„ç§æ“ä½œï¼Œå¦‚å®‰è£…ã€é…ç½®ã€å¯åŠ¨ã€åœæ­¢å’Œå¸è½½ã€‚ä½¿ç”¨ä¸åŒçš„æ ‡ç­¾å¯ä»¥é€‰æ‹©æ€§åœ°è¿è¡Œç‰¹å®šä»»åŠ¡æˆ–ä»»åŠ¡ç»„ã€‚</p>
<hr>
<p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æŸ¥çœ‹æ­¤ymlæ–‡ä»¶ä¸­çš„æ‰€æœ‰tagsæ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost http]# ansible-playbook tags.yml --list-tags</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">playbook:</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> tags.yml</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">  play</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"> #1 (web): éƒ¨ç½²apacheæœåŠ¡	TAGS: []</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF">      TASK</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> TAGS:</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF"> [config_httpd, </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">httpd_server,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> install_httpd,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> start_httpd,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> stop_httpd,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379"> uninstall_httpd]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ install_httpd,config_httpdï¼ˆå®‰è£…ã€ç§»åŠ¨é…ç½®æ–‡ä»¶ï¼‰æ ‡ç­¾ï¼›æ‰§è¡Œç§»åŠ¨é…ç½®æ–‡ä»¶ä¼šè§¦å‘å¤„ç†ç¨‹åºï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡ï¼›</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost http]# ansible-playbook tags.yml -t install_httpd,config_httpd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ uninstall_httpdï¼ˆå¸è½½httpdæœåŠ¡ï¼‰ æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost http]# ansible-playbook tags.yml -t uninstall_httpd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œ httpd_server æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost http]# ansible-playbook tags.yml -t httpd_server</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># httpd_serveræ ‡ç­¾åŒ…å«ï¼ˆInstall Http Serverã€configure httpd serverã€Restart Httpd Serverï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰€ä»¥ä¼šç›´æ¥æ‰§è¡Œè¿™ä¸‰ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯å®‰è£…ã€ç§»åŠ¨é…ç½®æ–‡ä»¶(å› ä¸ºä½¿ç”¨ç§»åŠ¨æ–‡ä»¶è§¦å‘äº†å¤„ç†ç¨‹åºnotifyï¼Œæ‰€ä»¥å°±ä¼šæ‰§è¡ŒRestart Httpd Serveré‡å¯æœåŠ¡ï¼‰</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ€»ç»“å°±æ˜¯ï¼šæ‰§è¡Œhttpd_serveræ ‡ç­¾ï¼Œä¼šå®‰è£…æœåŠ¡å¹¶å¯åŠ¨æœåŠ¡ã€‚</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># è·³è¿‡ httpd_server,start_httpdï¼ˆå®‰è£…åŠ å¯åŠ¨ï¼Œå¯åŠ¨ï¼‰æ ‡ç­¾</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">[root@localhost http]# ansible-playbook tags.yml --skip-tags httpd_server,start_httpd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic"># æ‰§è¡Œç»“æœä¸ºï¼Œå…³é—­httpdæœåŠ¡å¹¶å¸è½½httpdæœåŠ¡ï¼›å› ä¸ºå·²ç»è·³è¿‡ httpd_server ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œå®‰è£…å’Œå¯åŠ¨ï¼›</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/95046449a23d4d99b7936dca174c5b7c.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2 id="ä¸‰ã€playbook-ä¸­å¸¸ç”¨çš„æ¨¡å—ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€playbook-ä¸­å¸¸ç”¨çš„æ¨¡å—ä½¿ç”¨"><span>ä¸‰ã€Playbook ä¸­å¸¸ç”¨çš„æ¨¡å—ä½¿ç”¨</span></a></h2>
<ul>
<li>æ‰¹é‡å¤‡ä»½æ–‡ä»¶</li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">backup file</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      shell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">mv {{ item }} {{ item }}-$(date +"%Y-%m-%d")</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/home/cs/a.sh</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/home/cs/b.sh</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">/home/cs/c.sh</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      ignore_errors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">backup_file</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œç»“æœä¸ºï¼š/home/cs/a.sh-2023-10-31ã€/home/cs/b.sh-2023-10-31ã€/home/cs/c.sh-2023-10-31<br>
ignore_errors: yes ä¸ºï¼šæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´æŠ¥é”™ï¼Œè·³è¿‡æŠ¥é”™ç»§ç»­æ‰§è¡Œï¼Œä¸è¿‡æœ€åè¿˜æ˜¯è¦è¿”å›æ¥çœ‹ï¼Œéœ€è¦å•ç‹¬å¤åˆ¶ã€‚</p>
<ul>
<li>æ‰¹é‡å¤åˆ¶æ–‡ä»¶ï¼šä»æœ¬åœ°å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä¸åŒè·¯å¾„</li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">copy file</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      copy</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">src=/etc/ansible/yml/update/{{ item.src }} dest={{ item.dest }} mode={{ item.mode }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"a.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/data/cs/a.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"0777"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"b.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/data/abc/b.sh"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"0777"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"cs.jar"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/data/conf/cs.jar"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"0644"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">copy_file</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>æ‰¹é‡å¤åˆ¶æ–‡ä»¶ï¼šä»å…¶ä»–æœåŠ¡å™¨å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä¸åŒè·¯å¾„</li>
</ul>
<div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34"><pre v-pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">    - </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">copy shell/file</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      shell</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">cp -ar {{ item.src }} {{ item.dest }}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      with_items</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/home/test/nginx/conf/nginx.conf"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/usr/local/cs/nginx/conf/nginx.conf"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/home/test/nginx/conf/cs.conf"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/usr/local/cs/nginx/conf/cs.conf"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">        - {</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">src</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/home/test/nginx/src/nginx"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">, </span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">dest</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">"/usr/local/cs/nginx/src/nginx"</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">	  ignore_errors</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#986801;--shiki-dark:#D19A66">yes</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75">      tags</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379">fugai</span></span></code></pre>
<div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ignore_errors: yes ä¸ºï¼šæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´æŠ¥é”™ï¼Œè·³è¿‡æŠ¥é”™ç»§ç»­æ‰§è¡Œï¼Œä¸è¿‡æœ€åè¿˜æ˜¯è¦è¿”å›æ¥çœ‹ï¼Œéœ€è¦å•ç‹¬å¤åˆ¶ã€‚</p>
<h2 id="å››ã€ç›¸å…³æ–‡ç« " tabindex="-1"><a class="header-anchor" href="#å››ã€ç›¸å…³æ–‡ç« "><span>å››ã€ç›¸å…³æ–‡ç« </span></a></h2>
<table>
<thead>
<tr>
<th style="text-align:center">æ–‡ç« æ ‡é¢˜</th>
<th style="text-align:center">æ–‡ç« é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133769300" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆä¸€ï¼‰ç®€ä»‹åŠéƒ¨ç½²ã€æ¸…å•</a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133769300" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133769300</a></td>
</tr>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133772023" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆäºŒï¼‰ad-hoc æ¨¡å¼è¯¦è§£</a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133772023" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133772023</a></td>
</tr>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133899966" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆä¸‰ï¼‰Playbook æ¨¡å¼è¯¦è§£</a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133899966" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133899966</a></td>
</tr>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133994509" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆå››ï¼‰jinja2 æ¨¡æ¿ã€Rolesè§’è‰²è¯¦è§£</a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133994509" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133994509</a></td>
</tr>
</tbody>
</table>
</div></template>


