<template><div><blockquote>
<p>ğŸ‘¨â€ğŸ“<strong>åšä¸»ç®€ä»‹</strong></p>
<p>â€ƒâ€ƒğŸ…<a href="https://blog.csdn.net/liu_chen_yang?type=blog" target="_blank" rel="noopener noreferrer">äº‘è®¡ç®—é¢†åŸŸä¼˜è´¨åˆ›ä½œè€…<ExternalLinkIcon/></a><br>
â€ƒâ€ƒğŸ…<a href="https://bbs.huaweicloud.com/community/myblog" target="_blank" rel="noopener noreferrer">åä¸ºäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»<ExternalLinkIcon/></a><br>
â€ƒâ€ƒğŸ…<a href="https://developer.aliyun.com/my?spm=a2c6h.13148508.setting.3.21fc4f0eCmz1v3#/article?_k=zooqoz" target="_blank" rel="noopener noreferrer">é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»<ExternalLinkIcon/></a><br>
ğŸ’Š<strong>äº¤æµç¤¾åŒºï¼š</strong><a href="https://bbs.csdn.net/forums/lcy" target="_blank" rel="noopener noreferrer">è¿ç»´äº¤æµç¤¾åŒº<ExternalLinkIcon/></a> æ¬¢è¿å¤§å®¶çš„åŠ å…¥ï¼<br>
ğŸ‹ å¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥ï¼ğŸ˜„<br>
ğŸ‰å¦‚æœæ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿ ç‚¹èµ ğŸ‘ğŸ» è¯„è®º ğŸ’¬ æ”¶è— â­ï¸ åŠ å…³æ³¨+ğŸ’—</p>
</blockquote>
<hr>
<p>@[toc]</p>
<h1 id="ä¸€ã€ansible-ä¸­çš„-playbook-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ä¸€ã€ansible-ä¸­çš„-playbook-æ¨¡å¼" aria-hidden="true">#</a> ä¸€ã€Ansible ä¸­çš„ Playbook æ¨¡å¼</h1>
<p>â€ƒâ€ƒPlaybookä¸åŒäºä½¿ç”¨å•ä¸ªæ¨¡å—æ“ä½œè¿œç¨‹æœåŠ¡å™¨ï¼ŒPlaybookçš„åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚å¦‚æœè¯´å•ä¸ªæ¨¡å—æ‰§è¡Œç±»ä¼¼äºLinuxç³»ç»Ÿä¸­çš„å‘½ä»¤ï¼Œé‚£ä¹ˆPlaybookå°±ç±»ä¼¼äºshellè„šæœ¬ï¼Œå°†å¤šä¸ªæ¨¡å—ç»„åˆèµ·æ¥å®ç°ä¸€ç»„çš„æ“ä½œã€‚</p>
<p><code v-pre>Playbook</code>è¿˜æ˜¯ä¼šç”¨åˆ°<code v-pre>ad-hoc</code>æ¨¡å¼ä¸­çš„æ¨¡å—åŠå‚æ•°ï¼Œåªä¸è¿‡<code v-pre>Playbookä¸ad-hoc</code>çš„å†™æ³•ä¸ä¸€æ ·ã€‚</p>
<h2 id="_1-1-playbook-çš„ä¼˜åŠ¿" tabindex="-1"><a class="header-anchor" href="#_1-1-playbook-çš„ä¼˜åŠ¿" aria-hidden="true">#</a> 1.1 Playbook çš„ä¼˜åŠ¿</h2>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-0" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-0"> åŠŸèƒ½æ¯”<code v-pre>ad-hoc</code>æ›´å…¨</label></li>
</ul>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-1" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-1"> èƒ½å¾ˆå¥½çš„æ§åˆ¶å…ˆåæ‰§è¡Œé¡ºåº, ä»¥åŠä¾èµ–å…³ç³»</label></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-2" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-2"> è¯­æ³•å±•ç°æ›´åŠ çš„ç›´è§‚</label></li>
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-3" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-3"> ad-hocæ— æ³•æŒä¹…ä½¿ç”¨ï¼Œplaybookå¯ä»¥æŒä¹…ä½¿ç”¨</label></li>
</ul>
<h2 id="_1-2-playbook-çš„ç»„æˆ" tabindex="-1"><a class="header-anchor" href="#_1-2-playbook-çš„ç»„æˆ" aria-hidden="true">#</a> 1.2 Playbook çš„ç»„æˆ</h2>
<p><code v-pre>play</code>ï¼šä¸€ä¸ªå®Œæ•´çš„éƒ¨ç½²ä»»åŠ¡ï¼Œå¹¶ä¸”å¿…é¡»åŒ…å«ä»¥ä¸‹å‰ä¸¤é¡¹:</p>
<p>â€ƒâ€ƒ<code v-pre>hosts</code>ï¼šå®šä¹‰å¯¹å“ªäº›ä¸»æœºè¿›ç¨‹æ“ä½œ</p>
<p>â€ƒâ€ƒ<code v-pre>tasks</code>ï¼šå®šä¹‰çš„æ˜¯å…·ä½“æ‰§è¡Œçš„ä»»åŠ¡</p>
<p>â€ƒâ€ƒ<code v-pre>become</code>ï¼šè¡¨ç¤ºæ˜¯å¦è¦ä»¥ç‰¹æƒç”¨æˆ·ï¼ˆé€šå¸¸æ˜¯rootï¼‰èº«ä»½æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœè®¾ç½®ä¸º<code v-pre>yes</code>ï¼Œåˆ™ä»»åŠ¡ä¼šä»¥ç‰¹æƒèº«ä»½æ‰§è¡Œã€‚</p>
<p><code v-pre>playbook</code>: ç”±ä¸€ä¸ªæˆ–å¤šä¸ª<code v-pre>play</code>ç»„æˆï¼Œä¸€ä¸ªplayå¯ä»¥åŒ…å«å¤šä¸ª<code v-pre>task</code>ä»»åŠ¡</p>
<font color=red>è¯´æ˜ï¼š`Ansible` ä¸­çš„ `Playbook` æ–‡ä»¶ç»“å°¾ä¸º`.yml` æ ¼å¼</font><p>ç¤ºä¾‹httpd.ymlï¼šå®‰è£…httpdï¼›</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> apache
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">become</span><span class="token punctuation">:</span> yes
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd Server
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è§£æï¼š</p>
<p><code v-pre>name</code>ï¼šå®šä¹‰ä¸€ä¸ªPlaybookçš„åç§°ï¼Œç”¨äºæ ‡è¯†Playbookçš„ç”¨é€”ï¼›</p>
<p><code v-pre>hosts</code>ï¼šæŒ‡å®šè¦åœ¨å“ªä¸ªä¸»æœºä¸Šæ‰§è¡Œï¼Œä¹Ÿæ˜¯å†™ä¸»æœºæˆ–ä¸»æœºç»„åï¼Œéœ€è¦æå‰åœ¨<code v-pre>/etc/ansible/hosts</code>ä¸­é…ç½®å¥½ï¼›</p>
<p><code v-pre>become</code>ï¼šyesè¡¨ç¤ºä½¿ç”¨ç‰¹æƒç”¨æˆ·ï¼›</p>
<p><code v-pre>tasks</code>ï¼šå±äºæ˜¯ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œä¸»è¦å†™å…·ä½“æ‰§è¡Œä»€ä¹ˆçš„ï¼ˆå¯ä»¥æœ‰å¤šä¸ªï¼‰ï¼›</p>
<p>â€ƒâ€ƒ<code v-pre>name</code>ï¼šæ¯ä¸ªä»»åŠ¡çš„åç§°ï¼Œç”¨äºæè¿°å¹²ä»€ä¹ˆçš„ï¼›ä¸Šè¿°ymlä¸­åˆ™æ˜¯<code v-pre>å®‰è£…httpdæœåŠ¡</code>ï¼›</p>
<p>â€ƒâ€ƒ<code v-pre>yum</code>ï¼šè¡¨ç¤ºä½¿ç”¨å“ªä¸ªæ¨¡å—æ¥è¿›è¡Œæ“ä½œï¼›<code v-pre>æ¨¡å—çš„å‚æ•°å¯ä»¥çœ‹ad-hocä¸­çš„ï¼Œç”¨çš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå†™æ³•ä¸ä¸€æ ·å°±æ˜¯ï¼›</code></p>
<p>â€ƒâ€ƒâ€ƒâ€ƒ<code v-pre>name</code>ï¼šè¦å®‰è£…çš„æœåŠ¡åç§°ï¼Œæˆ‘ä»¬è¿™é‡Œæ˜¯httpdï¼š</p>
<p>â€ƒâ€ƒâ€ƒâ€ƒ<code v-pre>state</code>ï¼šè¦è¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ˜¯å®‰è£…ã€å¸è½½ã€æ›´æ–°ï¼›</p>
<p>å…¶å®<code v-pre>tasks</code>å°±æ˜¯Ansibleçš„æ¨¡å—ä»¥YAMLè¯­æ³•å†™å…¥åˆ°playbookä¸­ã€‚</p>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ä¸ºäº†å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§é€šå¸¸ä¸€ä¸ªplaybookä¸­åªç¼–å†™ä¸€ä¸ªplayï¼Œå¦‚æœæŸäº›ä¸»æœºéœ€è¦æ‰§è¡Œå¤šä¸ªplay,é‚£ä¹ˆå¯ä»¥ä½¿ç”¨includeå…³é”®å­—åœ¨ä¸€ä¸ªplaybookä¸­å¯¼å…¥å…¶ä»–çš„playbookã€‚</p>
<h2 id="_1-3-playbook-å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#_1-3-playbook-å‘½ä»¤" aria-hidden="true">#</a> 1.3 Playbook å‘½ä»¤</h2>
<p>æ ¼å¼ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>ansible-playbook <span class="token punctuation">[</span>é€‰é¡¹<span class="token punctuation">]</span> playbook.yml 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¸¸ç”¨é€‰é¡¹ï¼š</p>
<table>
<thead>
<tr>
<th>é€‰é¡¹/å‚æ•°</th>
<th>é€‰é¡¹/å‚æ•° è§£æ</th>
</tr>
</thead>
<tbody>
<tr>
<td>-T</td>
<td>å»ºç«‹SSHè¿æ¥çš„è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td>-i</td>
<td>æŒ‡å®šInventoryæ–‡ä»¶</td>
</tr>
<tr>
<td>-f</td>
<td>å¹¶å‘æ‰§è¡Œçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º5</td>
</tr>
<tr>
<td>- -list-hosts</td>
<td>åŒ¹é…çš„æœåŠ¡å™¨åˆ—è¡¨</td>
</tr>
<tr>
<td>- -list-tasks</td>
<td>åˆ—å‡ºä»»åŠ¡åˆ—è¡¨</td>
</tr>
<tr>
<td>- -step</td>
<td>æ¯æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ååœæ­¢ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤</td>
</tr>
<tr>
<td>- -syntax-check</td>
<td>è¯­æ³•æ£€æµ‹</td>
</tr>
<tr>
<td>- -list-tags</td>
<td>åˆ—å‡ºæ­¤ymlæ–‡ä»¶ä¸­çš„æ‰€æœ‰tagæ ‡ç­¾</td>
</tr>
<tr>
<td>- -skip-tags</td>
<td>æ‰§è¡Œâ€“skip-tagsä¹‹å¤–çš„æ ‡ç­¾ä»»åŠ¡</td>
</tr>
<tr>
<td>-C</td>
<td>æ£€æŸ¥å½“å‰è¿™ä¸ªPlaybookæ˜¯å¦ä¼šä¿®æ”¹å—æ§ç«¯ï¼Œæ¨¡æ‹Ÿæ‰§è¡Œ</td>
</tr>
</tbody>
</table>
<h2 id="_1-4-playbook-çš„è¯­æ³•" tabindex="-1"><a class="header-anchor" href="#_1-4-playbook-çš„è¯­æ³•" aria-hidden="true">#</a> 1.4 Playbook çš„è¯­æ³•</h2>
<ul>
<li>æƒé™</li>
</ul>
<p><code v-pre>remote_user</code>æŒ‡å®š<code v-pre>playbook</code>è¿è¡Œæ—¶çš„ç”¨æˆ·èº«ä»½ï¼Œå¯ä»¥å†™åœ¨hostsä¸‹ï¼Œä¹Ÿå¯ä»¥æ¯ä¸ªtasksåšå®šä¹‰ï¼›</p>
<p><code v-pre>become  </code>è¯¥é€‰é¡¹ä¸ºå¸ƒå°”å€¼ï¼Œå½“ç­‰äºyesè¡¨ç¤ºä»¥ç®¡ç†å‘˜èº«ä»½é€šå¸¸ä¸<code v-pre>become_method</code>ä¸€èµ·ä½¿ç”¨ï¼›</p>
<p><code v-pre>become_method</code>ï¼šsuæˆ–sudo</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token comment"># æŒ‡å®šä½¿ç”¨å“ªä¸ªç”¨æˆ·æ‰§è¡Œæ­¤ä»»åŠ¡</span>
<span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

<span class="token comment"># æ˜¯å¦ä½¿ç”¨ç‰¹æƒç”¨æˆ·</span>
<span class="token key atrule">become</span><span class="token punctuation">:</span> yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>é€šçŸ¥ä¸è§¦å‘</li>
</ul>
<p><code v-pre>notify</code> å¦‚æœæŒ‡å®šçš„æ“ä½œæ‰§è¡Œäº†ï¼Œä¼šè§¦å‘<code v-pre>handlers</code>çš„æ“ä½œï¼ŒæŒ‡å®šçš„æ˜¯handlerçš„åç§°ï¼›</p>
<p><code v-pre>handlers</code>å’Œ<code v-pre>notify</code>æŒ‡å®šçš„åç§°å¿…é¡»ç›¸åŒï¼Œå¦åˆ™æ— æ³•è§¦å‘ã€‚</p>
<p><code v-pre>handlers</code> ä¸­éœ€è¦<code v-pre>- name</code>æŒ‡å®šåç§°	ï¼Œ<code v-pre>handlers</code>åªä¼šåœ¨æ‰€æœ‰çš„<code v-pre>tasks</code>æ‰§è¡Œå®Œåæ‰§è¡Œï¼Œå¹¶ä¸”ï¼Œå³ä¾¿ä¸€ä¸ª<code v-pre>handlers</code>è¢«è§¦å‘å¤šæ¬¡ï¼Œä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ <code v-pre>handlers</code>æ˜¯ä¸€ç§ç‰¹æ®Šçš„<code v-pre>tasks</code>ã€‚</p>
<ul>
<li>handlersï¼ˆè§¦å‘äº‹ä»¶ï¼‰</li>
</ul>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>notify: è§¦å‘
handlersï¼šè§¦å‘çš„åŠ¨ä½œ
<span class="token comment"># ä¸¤è€…çš„åç§°ä¸€å®šè¦ç›¸åŒï¼Œå¦åˆ™æ— æ³•è§¦å‘ã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ä¸Šåœºæ™¯ï¼šä¸€èˆ¬éƒ½æ˜¯ä¿®æ”¹é…ç½®æ–‡ä»¶æ—¶</p>
<p>æ­£å¸¸æƒ…å†µæ—¶handlersæ˜¯ä¸ä¼šæ‰§è¡Œçš„ï¼Œé™¤éè§¦å‘ä»»åŠ¡ï¼Œæ‰ä¼šæ‰§è¡Œ</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> installredis
    <span class="token key atrule">yum</span><span class="token punctuation">:</span> name=redis
    
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copyfile
    <span class="token key atrule">template</span><span class="token punctuation">:</span> src=redis.conf dest=/etc/redis.conf
    <span class="token key atrule">tags</span><span class="token punctuation">:</span> copyfile
    <span class="token key atrule">notify</span><span class="token punctuation">:</span> restart		<span class="token comment"># è§¦å‘ï¼šè§¦å‘åç§°</span>
    
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start
     <span class="token key atrule">service</span><span class="token punctuation">:</span>
       <span class="token key atrule">name</span><span class="token punctuation">:</span> redis
       <span class="token key atrule">state</span><span class="token punctuation">:</span> started
       <span class="token key atrule">enabled</span><span class="token punctuation">:</span> yes
    
  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>				<span class="token comment"># è§¦å‘åŠ¨ä½œ</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> restart
     <span class="token key atrule">service</span><span class="token punctuation">:</span>
       <span class="token key atrule">name</span><span class="token punctuation">:</span> redis
       <span class="token key atrule">state</span><span class="token punctuation">:</span> restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-5-playbook-ä¸­çš„å˜é‡" tabindex="-1"><a class="header-anchor" href="#_1-5-playbook-ä¸­çš„å˜é‡" aria-hidden="true">#</a> 1.5 Playbook ä¸­çš„å˜é‡</h2>
<blockquote>
<p>â€ƒâ€ƒå˜é‡æä¾›äº†ä¾¿æ·çš„æ–¹å¼æ¥ç®¡ç†<code v-pre>Ansible playbook</code>çš„æ¯ä¸€ä¸ªé¡¹ç›®ä¸­çš„åŠ¨æ€å€¼ï¼Œæ¯”å¦‚nginx-1.6.3è¿™ä¸ªè½¯ä»¶åŒ…çš„ç‰ˆæœ¬ï¼Œåœ¨å…¶å®ƒåœ°æ–¹æˆ–è®¸ä¼šåå¤ä½¿ç”¨ï¼Œé‚£ä¹ˆå¦‚æœå°†æ­¤å€¼è®¾ç½®ä¸ºå˜é‡ï¼Œç„¶åå†åœ¨å…¶ä»–çš„playbookä¸­è°ƒç”¨ï¼Œä¼šæ–¹ä¾¿è®¸å¤šã€‚å¦‚æ­¤ä¸€æ¥è¿˜æ–¹ä¾¿ç»´æŠ¤ï¼Œå‡å°‘ç»´æŠ¤çš„æˆæœ¬ã€‚</p>
</blockquote>
<ul>
<li>å˜é‡çš„å®šä¹‰æ–¹å¼</li>
</ul>
<p>1.é€šè¿‡<code v-pre>å‘½ä»¤è¡Œ</code>è¿›è¡Œå˜é‡å®šä¹‰</p>
<p>2.åœ¨<code v-pre>playæ–‡ä»¶</code>ä¸­è¿›è¡Œå˜é‡å®šä¹‰</p>
<p>3.é€šè¿‡<code v-pre>Inventoryä¸»æœºä¿¡æ¯</code>æ–‡ä»¶ä¸­è¿›è¡Œå˜é‡å®šä¹‰</p>
<font color=red>å˜é‡è¯»å–çš„ä¼˜å…ˆçº§ä¸º: `å‘½ä»¤è¡Œ > playbookæ–‡ä»¶ > Inventory`æ–‡ä»¶</font><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-4" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-4"> é€šè¿‡varså®šä¹‰å˜é‡</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> LAMP
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token key atrule">packages_name</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> httpd
      <span class="token punctuation">-</span> mariadb<span class="token punctuation">-</span>server
      <span class="token punctuation">-</span> php
      <span class="token punctuation">-</span> php<span class="token punctuation">-</span>mysql

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install LAMP
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
         <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{packages_name}}"</span>
         <span class="token key atrule">state</span><span class="token punctuation">:</span> present
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œæ­¤ymlï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook --syntax-check LAMP.yml

<span class="token comment"># æ‰§è¡Œyml</span>
ansible-playbook LAMP.ymlï¼ˆå®šä¹‰çš„ymlæ–‡ä»¶åï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-5" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-5"> é€šè¿‡vars_fileså®šä¹‰å˜é‡</label></li>
</ul>
<p>å½“å˜é‡è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨varså®šä¹‰æ²¡æœ‰é—®é¢˜ï¼Œå½“å˜é‡è¾ƒå¤šæ—¶ï¼Œå¯ä»¥å°†å˜é‡ä¿å­˜åˆ°ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ä¸­ï¼›</p>
<p>éœ€è¦å¤šä¸ªymlæ–‡ä»¶ï¼Œä¸€ä¸ªä¸»æ–‡ä»¶ï¼Œéœ€è¦è°ƒç”¨å…¶ä»–ymlç‹¬ç«‹æ–‡ä»¶ï¼Œä¸»è¦æ˜¯æœ€åè¿è¡Œçš„ï¼›å…¶ä»–æ˜¯å®šä¹‰åŒ…åçš„ymlæ–‡ä»¶ã€‚</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token comment">#å®šä¹‰é˜¶æ®µ</span>
<span class="token comment"># my_vars.yml</span>
<span class="token punctuation">---</span>
<span class="token key atrule">httpd_package</span><span class="token punctuation">:</span> httpd
<span class="token key atrule">mariadb_package</span><span class="token punctuation">:</span> mariadb<span class="token punctuation">-</span>server


<span class="token comment">#è°ƒç”¨é˜¶æ®µ</span>
<span class="token comment"># apache.yml</span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> apache
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">become</span><span class="token punctuation">:</span> yes
  <span class="token key atrule">vars_files</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> my_vars.yml  <span class="token comment"># å¼•å…¥å˜é‡æ–‡ä»¶</span>

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ httpd_package }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
      <span class="token key atrule">become</span><span class="token punctuation">:</span> yes

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install mariadb<span class="token punctuation">-</span>server
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ mariadb_package }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
      <span class="token key atrule">become</span><span class="token punctuation">:</span> yes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œæ­¤ymlï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook --syntax-check apache.yml

<span class="token comment"># æ‰§è¡Œyml</span>
ansible-playbook apache.ymlï¼ˆå®šä¹‰çš„ymlæ–‡ä»¶åï¼‰
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-6" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-6"> å®˜æ–¹æ¨èå®šä¹‰å˜é‡æ–¹æ³•</label></li>
</ul>
<p>ä¹‹å‰çš„å‡ ç§å˜é‡å®šä¹‰éƒ½ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œæ¯”è¾ƒå¥½ç”¨çš„æ˜¯åœ¨Ansibleé¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªå˜é‡ç›®å½•ï¼š</p>
<p>host_vars</p>
<p>group_vars</p>
<p>ç›®å½•åå­—ä¸€å®šè¦ä¸€è‡´ï¼Œä¸èƒ½åšä»»ä½•ä¿®æ”¹ã€‚</p>
<p>â€ƒâ€ƒç†è§£å¦‚ä½•è®¾ç½®å’Œä½¿ç”¨<code v-pre>host_vars</code>å’Œ<code v-pre>group_vars</code>å¯ä»¥ä½¿ä½ çš„Ansibleç®¡ç†æ›´åŠ çµæ´»å’Œæœ‰ç»„ç»‡ã€‚ä»¥ä¸‹æ˜¯æ›´è¯¦ç»†çš„æ­¥éª¤ï¼Œä»è®¾ç½®ç›®å½•ç»“æ„åˆ°åˆ›å»ºPlaybookçš„æ‰§è¡Œï¼š</p>
<ol>
<li>
<p><strong>ç›®å½•ç»“æ„</strong>ï¼š<br>
åœ¨ä½ çš„Ansibleé¡¹ç›®ç›®å½•ä¸‹ï¼Œç¡®ä¿è®¾ç½®ä»¥ä¸‹ç›®å½•ç»“æ„ï¼š</p>
<div class="language-text line-numbers-mode" data-ext="text"><pre v-pre class="language-text"><code>your_ansible_project/
â”œâ”€â”€ group_vars/
â”‚   â””â”€â”€ web-servers.yml
â”œâ”€â”€ host_vars/
â”‚   â””â”€â”€ web-server.yml
â”œâ”€â”€ playbook.yml
â””â”€â”€ inventory.ini
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li><code v-pre>group_vars</code>ç›®å½•ç”¨äºå­˜æ”¾ç»„çº§åˆ«çš„å˜é‡å®šä¹‰ã€‚</li>
<li><code v-pre>host_vars</code>ç›®å½•ç”¨äºå­˜æ”¾ä¸»æœºçº§åˆ«çš„å˜é‡å®šä¹‰ã€‚</li>
<li><code v-pre>playbook.yml</code>æ˜¯ä½ çš„Ansible Playbookã€‚</li>
<li><code v-pre>inventory.ini</code>æ˜¯Ansibleçš„ä¸»æœºæ¸…å•æ–‡ä»¶ï¼Œå…¶ä¸­åˆ—å‡ºäº†ä½ çš„ä¸»æœºå’Œä¸»æœºç»„ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ¸…å•æ–‡ä»¶ (<code v-pre>inventory.ini</code>)</strong>ï¼š<br>
ç¡®ä¿åœ¨æ¸…å•æ–‡ä»¶ä¸­å®šä¹‰äº†ä½ çš„ä¸»æœºå’Œä¸»æœºç»„ã€‚ä¾‹å¦‚ï¼š</p>
<p><code v-pre>vim /etc/ansible/inventory.ini</code></p>
<div class="language-ini line-numbers-mode" data-ext="ini"><pre v-pre class="language-ini"><code></code></pre><div class="line-numbers" aria-hidden="true"></div></div></li>
</ol>
<p>[web-servers]<br>
172.16.11.209 ansible_ssh_port=22 ansible_ssh_user=root ansible_ssh_pass='123123'</p>
<div class="language-text line-numbers-mode" data-ext="text"><pre v-pre class="language-text"><code>
3. **ç»„çº§åˆ«å˜é‡ (`group_vars/web-servers.yml`)**ï¼š
åœ¨`group_vars`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œä¾‹å¦‚`web-servers.yml`ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ç»„çº§åˆ«çš„å˜é‡ï¼Œå¦‚ï¼š

`mkdir -p /etc/ansible/group_vars &amp;&amp; vim /etc/ansible/group_vars/web-servers.yml`

```yaml
# group_vars/web-servers.yml
---
httpd_package: httpd
mariadb_package: mariadb-server
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4">
<li>
<p><strong>ä¸»æœºçº§åˆ«å˜é‡ (<code v-pre>host_vars/web-server.yml</code>)</strong>ï¼š<br>
åœ¨<code v-pre>host_vars</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œä¾‹å¦‚<code v-pre>web-server.yml</code>ï¼Œå¹¶åœ¨å…¶ä¸­å®šä¹‰ä¸»æœºçº§åˆ«çš„å˜é‡ï¼Œå¦‚ï¼š</p>
<p><code v-pre>mkdir -p /etc/ansible/host_vars &amp;&amp; vim /etc/ansible/host_vars/web-servers.yml</code></p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token comment"># host_vars/web-server.yml</span>
<span class="token punctuation">---</span>
<span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">80</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><strong>Playbook (<code v-pre>playbook.yml</code>)</strong>ï¼š<br>
åˆ›å»ºä½ çš„Ansible Playbookï¼Œä¾‹å¦‚ï¼š</p>
<p><code v-pre>vim /etc/ansible/playbook.yml</code></p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Configure Web Server
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web<span class="token punctuation">-</span>servers
  <span class="token key atrule">become</span><span class="token punctuation">:</span> yes

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install HTTPd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ httpd_package }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Start HTTPd
      <span class="token key atrule">service</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> started
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li>
<li>
<p><strong>è¿è¡ŒPlaybook</strong>ï¼š<br>
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œä½ çš„Playbookï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>ansible-playbook <span class="token parameter variable">-i</span> inventory.ini playbook.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
</ol>
<p>æ­¤æ—¶ï¼ŒAnsibleä¼šè‡ªåŠ¨åŠ è½½<code v-pre>group_vars</code>å’Œ<code v-pre>host_vars</code>ç›®å½•ä¸­çš„å˜é‡ï¼Œä½ çš„Playbookå°†ä½¿ç”¨è¿™äº›å˜é‡æ¥é…ç½®ä¸»æœºã€‚</p>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥æ›´åŠ æœ‰ç»„ç»‡åœ°ç®¡ç†å˜é‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¤šä¸»æœºå’Œå¤šç»„çš„ç¯å¢ƒã€‚ä½ å¯ä»¥ä¸ºä¸åŒçš„ç»„æˆ–ä¸»æœºè®¾ç½®ç‰¹å®šçš„å˜é‡ï¼Œè€Œä¸å¿…åœ¨Playbookä¸­ç¡¬ç¼–ç è¿™äº›å€¼ï¼Œæé«˜äº†å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§ã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-7" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-7"> å‘½ä»¤è¡Œå®šä¹‰å˜é‡</label></li>
</ul>
<p>ansible-playbookå‘½ä»¤æä¾›-eé€‰é¡¹ï¼Œç”¨äºåœ¨å‘½ä»¤è¡Œå®šä¹‰å˜é‡ï¼Œå‘½ä»¤è¡Œå®šä¹‰å˜é‡çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># cat /etc/ansible/hosts</span>
<span class="token punctuation">[</span>web<span class="token punctuation">]</span>
<span class="token number">172.16</span>.11.209

<span class="token punctuation">[</span>web:vars<span class="token punctuation">]</span>
<span class="token assign-left variable">ansible_ssh_pass</span><span class="token operator">=</span><span class="token string">'123123'</span>

<span class="token comment"># æ‰§è¡Œï¼šå‘½ä»¤è¡Œå®šä¹‰å˜é‡</span>
<span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim test.yml</span>
---
- name: apache 
  hosts: web
  become: <span class="token function">yes</span>
  vars: 
    httpd_package:
       - httpd

  tasks:
    - name: <span class="token function">install</span> httpd <span class="token function">service</span>
      yum:
        name: <span class="token string">"{{ httpd_package }}"</span>
        state: present
<span class="token comment">#å®šä¹‰é˜¶æ®µ</span>
<span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># ansible-playbook test.yml -e "web_server=vsftpd"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_1-6-å˜é‡æ³¨å†Œ" tabindex="-1"><a class="header-anchor" href="#_1-6-å˜é‡æ³¨å†Œ" aria-hidden="true">#</a> 1.6 å˜é‡æ³¨å†Œ</h2>
<p>â€ƒâ€ƒå½“anbsibleçš„æ¨¡å—åœ¨è¿è¡Œä¹‹åï¼Œå…¶å®éƒ½ä¼šè¿”å›ä¸€äº›resultç»“æœï¼Œå°±åƒæ˜¯æ‰§è¡Œè„šæœ¬ï¼Œæˆ‘ä»¬æœ‰çš„æ—¶å€™éœ€è¦è„šæœ¬ç»™æˆ‘ä»¬ä¸€äº›returnè¿”å›å€¼ï¼Œæˆ‘ä»¬æ‰çŸ¥é“ï¼Œä¸Šä¸€æ­¥æ˜¯å¦å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œansibleçš„resultå¹¶ä¸ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›è¿”å›å€¼'å­˜å‚¨'åˆ°å˜é‡ä¸­ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡'è°ƒç”¨'å¯¹åº”çš„å˜é‡åï¼Œä»è€Œè·å–åˆ°è¿™äº›resultï¼Œè¿™ç§å°†æ¨¡å—çš„è¿”å›å€¼ï¼Œå†™å…¥åˆ°å˜é‡ä¸­çš„æ–¹æ³•è¢«ç§°ä¸ºå˜é‡æ³¨å†Œã€‚</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@ansible ~<span class="token punctuation">]</span><span class="token comment"># vim register.yml</span>
---
- hosts: web 
  tasks:
  
    - name: define a var1
      shell: <span class="token string">"whoami"</span>
      register: user_name

    - name: get msg 
      debug: 
        msg: <span class="token string">"{{ user_name }}"</span>

    - name: get stdout msg
      debug:
        msg: <span class="token string">"{{ user_name.stdout_lines }}"</span>
        
<span class="token comment"># æ‰§è¡Œ</span>
<span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># ansible-playbook register.yml</span>

PLAY <span class="token punctuation">[</span>web<span class="token punctuation">]</span> ****************************************************************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> ****************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">172.16</span>.11.209<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>define a var1<span class="token punctuation">]</span> ******************************************************************************************************************************************
changed: <span class="token punctuation">[</span><span class="token number">172.16</span>.11.209<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>get msg<span class="token punctuation">]</span> ************************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">172.16</span>.11.209<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"changed"</span><span class="token builtin class-name">:</span> true, 
        <span class="token string">"cmd"</span><span class="token builtin class-name">:</span> <span class="token string">"whoami"</span>, 
        <span class="token string">"delta"</span><span class="token builtin class-name">:</span> <span class="token string">"0:00:00.004924"</span>, 
        <span class="token string">"end"</span><span class="token builtin class-name">:</span> <span class="token string">"2023-10-12 23:21:29.231407"</span>, 
        <span class="token string">"failed"</span><span class="token builtin class-name">:</span> false, 
        <span class="token string">"rc"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>, 
        <span class="token string">"start"</span><span class="token builtin class-name">:</span> <span class="token string">"2023-10-12 23:21:29.226483"</span>, 
        <span class="token string">"stderr"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>, 
        <span class="token string">"stderr_lines"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>, 
        <span class="token string">"stdout"</span><span class="token builtin class-name">:</span> <span class="token string">"root"</span>, 
        <span class="token string">"stdout_lines"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">"root"</span>
        <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

TASK <span class="token punctuation">[</span>get stdout msg<span class="token punctuation">]</span> *****************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">172.16</span>.11.209<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token string">"msg"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">"root"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

PLAY RECAP ****************************************************************************************************************************************************
<span class="token number">172.16</span>.11.209              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">4</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯´æ˜:</p>
<p><code v-pre>debug</code>ï¼šæ¨¡å—å¸¸ç”¨å‚æ•°</p>
<p><code v-pre>msg</code>ï¼š    #è°ƒè¯•è¾“å‡ºçš„æ¶ˆæ¯</p>
<p><code v-pre>var</code>:      #å°†æŸä¸ªä»»åŠ¡æ‰§è¡Œçš„è¾“å‡ºä½œä¸ºå˜é‡ä¼ é€’ç»™debugæ¨¡å—ï¼Œdebugä¼šç›´æ¥å°†å…¶æ‰“å°è¾“å‡º</p>
<p><code v-pre>verbosity</code>:    #debugçš„çº§åˆ«ï¼ˆé»˜è®¤æ˜¯0çº§ï¼Œå…¨éƒ¨æ˜¾ç¤ºï¼‰</p>
<h2 id="_1-7-debug-æ¨¡å—-å°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥" tabindex="-1"><a class="header-anchor" href="#_1-7-debug-æ¨¡å—-å°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥" aria-hidden="true">#</a> 1.7 debug æ¨¡å—ï¼šå°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥</h2>
<p>å°†ä¸Šä¸€æ­¥ä»»åŠ¡æ‰§è¡Œçš„ç»“æœæ‰“å°å‡ºæ¥ï¼Œä¸ç®¡æˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½ä¼šè¿”å›ï¼›</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> debugæµ‹è¯• 
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
   <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æŸ¥çœ‹rootç›®å½•ä¸‹çš„æ–‡ä»¶
     <span class="token key atrule">command</span><span class="token punctuation">:</span> ls /root
     <span class="token key atrule">register</span><span class="token punctuation">:</span> root_directory_contents  <span class="token comment"># å­˜å‚¨å‘½ä»¤è¾“å‡º</span>

   <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> è¾“å‡ºçš„ç»“æœ
     <span class="token key atrule">debug</span><span class="token punctuation">:</span>
       <span class="token key atrule">var</span><span class="token punctuation">:</span> root_directory_contents.stdout_lines
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://img-blog.csdnimg.cn/885e636225a249ddbfd6d95101b59752.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure>
<h2 id="_1-8-facts-ç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_1-8-facts-ç¼“å­˜" aria-hidden="true">#</a> 1.8 facts ç¼“å­˜</h2>
<p>â€ƒâ€ƒAnsible factsæ˜¯åœ¨è¢«ç®¡ç†ä¸»æœºä¸Šé€šè¿‡Ansibleè‡ªåŠ¨é‡‡é›†å‘ç°çš„å˜é‡ã€‚factsåŒ…å«æ¯å°ç‰¹å®šçš„ä¸»æœºä¿¡æ¯ã€‚æ¯”å¦‚ï¼šè¢«æ§ç«¯çš„ä¸»æœºåã€IPåœ°å€ã€ç³»ç»Ÿç‰ˆæœ¬ã€CPUæ•°é‡ã€å†…å­˜çŠ¶æ€ã€ç£ç›˜çŠ¶æ€ç­‰ç­‰ã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-8" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-8"> factså˜é‡çš„ä½¿ç”¨åœºæ™¯</label></li>
</ul>
<ol>
<li>
<p>é€šè¿‡factsç¼“å­˜æ£€æŸ¥CPUï¼Œæ¥ç”Ÿæˆå¯¹åº”çš„nginxé…ç½®æ–‡ä»¶</p>
</li>
<li>
<p>é€šè¿‡factsç¼“å­˜æ£€æŸ¥ä¸»æœºåï¼Œç”Ÿæˆä¸åŒçš„zabbixé…ç½®æ–‡ä»¶</p>
</li>
<li>
<p>é€šè¿‡factsç¼“å­˜æ£€ç´¢ç‰©ç†æœºçš„å†…å­˜å¤§å°æ¥ç”Ÿæˆä¸åŒçš„mysqlé…ç½®æ–‡ä»¶</p>
</li>
</ol>
<p>å¯ä»¥ä½¿ç”¨setupæ¨¡å—æŸ¥çœ‹factså˜é‡åˆ—è¡¨:</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># ansible nginx -m setup </span>
<span class="token number">172.16</span>.11.209 <span class="token operator">|</span> SUCCESS <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token string">"ansible_facts"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
        <span class="token string">"ansible_all_ipv4_addresses"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">"172.17.0.1"</span>, 
            <span class="token string">"172.16.11.209"</span>
        <span class="token punctuation">]</span>, 
        <span class="token string">"ansible_all_ipv6_addresses"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token string">"fe80::20c:29ff:feaf:dbfa"</span>
        <span class="token punctuation">]</span>, 
		   ä»¥ä¸‹çœç•¥â€¦
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨playbookä¸­å¼•ç”¨factså˜é‡ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token punctuation">[</span>root@localhost ansible<span class="token punctuation">]</span><span class="token comment"># vim /etc/ansible/hosts </span>
<span class="token punctuation">[</span>web<span class="token punctuation">]</span>
<span class="token number">172.16</span>.11.209

<span class="token punctuation">[</span>web:vars<span class="token punctuation">]</span>
<span class="token assign-left variable">ansible_ssh_pass</span><span class="token operator">=</span><span class="token string">'123123'</span>

<span class="token comment"># ymlæ–‡ä»¶</span>
<span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># cat facts.yml </span>
- hosts: web
  tasks:
    - shell: <span class="token builtin class-name">echo</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> ansible_os_family <span class="token punctuation">}</span><span class="token punctuation">}</span>
      register: my_vars

    - debug: 
        var: my_vars.stdout_lines
        

<span class="token comment"># æ‰§è¡Œ</span>
<span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># ansible-playbook facts.yml </span>

PLAY <span class="token punctuation">[</span>web<span class="token punctuation">]</span> ****************************************************************************************************************************************************

TASK <span class="token punctuation">[</span>Gathering Facts<span class="token punctuation">]</span> ****************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">172.16</span>.11.209<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>shell<span class="token punctuation">]</span> **************************************************************************************************************************************************
changed: <span class="token punctuation">[</span><span class="token number">172.16</span>.11.209<span class="token punctuation">]</span>

TASK <span class="token punctuation">[</span>debug<span class="token punctuation">]</span> **************************************************************************************************************************************************
ok: <span class="token punctuation">[</span><span class="token number">172.16</span>.11.209<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token string">"my_vars.stdout_lines"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
        <span class="token string">"RedHat"</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

PLAY RECAP ****************************************************************************************************************************************************
<span class="token number">172.16</span>.11.209              <span class="token builtin class-name">:</span> <span class="token assign-left variable">ok</span><span class="token operator">=</span><span class="token number">3</span>    <span class="token assign-left variable">changed</span><span class="token operator">=</span><span class="token number">1</span>    <span class="token assign-left variable">unreachable</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">failed</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">skipped</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">rescued</span><span class="token operator">=</span><span class="token number">0</span>    <span class="token assign-left variable">ignored</span><span class="token operator">=</span><span class="token number">0</span>   

<span class="token comment">#åœ¨playbookä¸­ï¼Œå¯ä»¥é€šè¿‡gather_factsé€‰é¡¹æ§åˆ¶æ˜¯å¦æ”¶é›†è¿œç¨‹ä¸»æœºï¼Œé»˜è®¤å€¼ä¸ºyes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="äºŒã€playbook-ä¸­çš„æµç¨‹æ§åˆ¶" tabindex="-1"><a class="header-anchor" href="#äºŒã€playbook-ä¸­çš„æµç¨‹æ§åˆ¶" aria-hidden="true">#</a> äºŒã€Playbook ä¸­çš„æµç¨‹æ§åˆ¶</h1>
<h2 id="_2-1-æ¡ä»¶" tabindex="-1"><a class="header-anchor" href="#_2-1-æ¡ä»¶" aria-hidden="true">#</a> 2.1 æ¡ä»¶</h2>
<p>â€ƒâ€ƒåœ¨æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€æµç¨‹æ§åˆ¶è¯­å¥ä¸­ï¼Œæ¡ä»¶è¯­å¥æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œåœ¨ä½¿ç”¨Ansibleçš„è¿‡ç¨‹ä¸­ï¼Œæ¡ä»¶åˆ¤æ–­çš„ä½¿ç”¨é¢‘ç‡æå…¶é«˜ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<ul class="task-list-container">
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" id="task-item-9" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-9"> ä½¿ç”¨ä¸åŒçš„ç³»ç»Ÿçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åˆ¤æ–­ç³»ç»Ÿæ¥å¯¹è½¯ä»¶åŒ…è¿›è¡Œå®‰è£…ã€‚</label></p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" id="task-item-10" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-10"> åœ¨nfså’Œrsyncå®‰è£…è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯æœåŠ¡å™¨ä¸éœ€è¦æ¨é€é…ç½®æ–‡ä»¶ï¼Œä¹‹å‰æˆ‘ä»¬éƒ½æ˜¯å†™å¤šä¸ªplayï¼Œä¼šå½±å“æ•ˆç‡ã€‚</label></p>
</li>
<li class="task-list-item">
<p><input type="checkbox" class="task-list-item-checkbox" id="task-item-11" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-11"> åœ¨æºç å®‰è£…nginxçš„æ—¶å€™ï¼Œæ‰§è¡Œç¬¬äºŒéå°±æ— æ³•æ‰§è¡Œäº†ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œåˆ¤æ–­æ˜¯å¦å®‰è£…è¿‡ã€‚</label></p>
</li>
</ul>
<font color=red>playbookä¸­çš„æ¡ä»¶åˆ¤æ–­è¯­å¥ä½¿ç”¨`when`</font><div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token key atrule">tasks</span><span class="token punctuation">:</span>  <span class="token comment">#å®˜æ–¹æ¡ˆä¾‹</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"shut down Debian flavored systems"</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> /sbin/shutdown <span class="token punctuation">-</span>t now
    <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_facts<span class="token punctuation">[</span><span class="token string">'os_family'</span><span class="token punctuation">]</span> == "Debian"
    <span class="token comment"># note that all variables can be used directly in conditionals without double curly braces</span>

<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web_group
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install CentOS Httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
    <span class="token comment">#å®˜æ–¹</span>
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_facts<span class="token punctuation">[</span><span class="token string">'os_family'</span><span class="token punctuation">]</span> == "CentOS"
    <span class="token comment">#éå®˜æ–¹</span>
      <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_distribution == "CentOS"

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Ubuntu Httpd
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> apache2
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
        <span class="token key atrule">when</span><span class="token punctuation">:</span> ansible_facts<span class="token punctuation">[</span><span class="token string">'os_family'</span><span class="token punctuation">]</span> == "Ubuntu"
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿˜å¯ä»¥ä½¿ç”¨æ‹¬å·å¯¹æ¡ä»¶è¿›è¡Œåˆ†ç»„</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"shut down CentOS 6 and Debian 7 systems"</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> /sbin/shutdown <span class="token punctuation">-</span>t now
    <span class="token key atrule">when</span><span class="token punctuation">:</span> (ansible_facts<span class="token punctuation">[</span><span class="token string">'distribution'</span><span class="token punctuation">]</span> == "CentOS" and ansible_facts<span class="token punctuation">[</span><span class="token string">'distribution_major_version'</span><span class="token punctuation">]</span> == "6") or
          (ansible_facts<span class="token punctuation">[</span><span class="token string">'distribution'</span><span class="token punctuation">]</span> == "Debian" and ansible_facts<span class="token punctuation">[</span><span class="token string">'distribution_major_version'</span><span class="token punctuation">]</span> == "7")
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¹Ÿå¯ä»¥æŒ‡å®šå¤šæ¡ä»¶ä¸ºåˆ—è¡¨</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>tasks:
  - name: <span class="token string">"shut down CentOS 6 systems"</span>
    command: /sbin/shutdown <span class="token parameter variable">-t</span> now
    when:
      - ansible_facts<span class="token punctuation">[</span><span class="token string">'distribution'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"CentOS"</span>
      - ansible_facts<span class="token punctuation">[</span><span class="token string">'distribution_major_version'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"6"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¡ä»¶è¿ç®—</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>tasks:
  - shell: <span class="token builtin class-name">echo</span> <span class="token string">"only on Red Hat 6, derivatives, and later"</span>
    when: ansible_facts<span class="token punctuation">[</span><span class="token string">'os_family'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"RedHat"</span> and ansible_facts<span class="token punctuation">[</span><span class="token string">'distribution_major_version '</span><span class="token punctuation">]</span><span class="token operator">|</span>int <span class="token operator">>=</span> <span class="token number">6</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å®ä¾‹ï¼š</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim when.yml</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root   <span class="token comment">#ä»£è¡¨ç”¨rootç”¨æˆ·æ‰§è¡Œï¼Œé»˜è®¤æ˜¯rootï¼Œå¯ä»¥çœç•¥</span>
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> createfile
    <span class="token key atrule">copy</span><span class="token punctuation">:</span> content="test3" dest=/etc/ansible/yml/when.yml
    <span class="token key atrule">when</span><span class="token punctuation">:</span> a=='3'
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> createfile
    <span class="token key atrule">copy</span><span class="token punctuation">:</span> content="test4" dest=/etc/ansible/yml/when.yml
    <span class="token key atrule">when</span><span class="token punctuation">:</span> a=='4'
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>å¦‚æœa&quot;3&quot;ï¼Œå°±å°†â€œtest3â€ï¼Œå†™å…¥åˆ°webç»„ä¸‹è¢«ç®¡æ§æœºçš„/etc/ansible/yml/when.ymlä¸­ï¼Œ<br>
å¦‚æœa&quot;4&quot;ï¼Œå°±å°†â€œtest4â€ï¼Œå†™å…¥åˆ°webç»„ä¸‹è¢«ç®¡æ§æœºçš„/etc/ansible/yml/when.ymlä¸­ã€‚</p>
</blockquote>
<p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook  --syntax-check when.yml

<span class="token comment">#æ‰§è¡Œ</span>
ansible-playbook <span class="token parameter variable">-e</span> <span class="token string">'a="3"'</span> when.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-2-å¾ªç¯" tabindex="-1"><a class="header-anchor" href="#_2-2-å¾ªç¯" aria-hidden="true">#</a> 2.2 å¾ªç¯</h2>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-12" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-12"> 1ã€æ ‡å‡†å¾ªç¯ä½¿ç”¨åœºæ™¯ - æ‰¹é‡å®‰è£…è½¯ä»¶</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim with_items.yml</span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Installed packages
      <span class="token key atrule">yum</span><span class="token punctuation">:</span> 
       <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ item }}"</span>
       <span class="token key atrule">state</span><span class="token punctuation">:</span> present
      
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> wget
       <span class="token punctuation">-</span> tree
       <span class="token punctuation">-</span> lrzsz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook --syntax-check with_items.yml

<span class="token comment"># æ‰§è¡Œ</span>
ansible-playbook with_items.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://img-blog.csdnimg.cn/9ebc2064addb4037b5e5b84db33b5d30.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-13" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-13"> 2ã€æ ‡å‡†å¾ªç¯ä½¿ç”¨åœºæ™¯ - æ‰¹é‡åˆ›å»ºç”¨æˆ·</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim item2.yml</span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æ‰¹é‡åˆ›å»ºç”¨æˆ·
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> é…ç½®åˆ›å»ºç”¨æˆ·æ“ä½œ
      <span class="token key atrule">user</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ item }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present

      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cs1
        <span class="token punctuation">-</span> cs2
        <span class="token punctuation">-</span> cs3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook --syntax-check item2.yml

<span class="token comment"># æ‰§è¡Œ</span>
ansible-playbook item2.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token function">tail</span> <span class="token parameter variable">-3</span> /etc/passwd
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://img-blog.csdnimg.cn/bd06fcb21140445a8912e70c27d75d35.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-14" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-14"> 3ã€å¾ªç¯åµŒå¥—ä½¿ç”¨åœºæ™¯ - æ‰¹é‡åˆ›å»ºç”¨æˆ·å¹¶ç»™ç”¨æˆ·æ·»åŠ ç”¨æˆ·ç»„</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim item3.yml</span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æ‰¹é‡åˆ›å»ºç”¨æˆ·ååŠç”¨æˆ·ç»„
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> create group
      <span class="token key atrule">group</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> group1
      <span class="token punctuation">-</span> group2
      <span class="token punctuation">-</span> group3

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> create user
      <span class="token key atrule">user</span><span class="token punctuation">:</span> name=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.name <span class="token punctuation">}</span><span class="token punctuation">}</span> group=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.groups <span class="token punctuation">}</span><span class="token punctuation">}</span> state=present
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">'name'</span><span class="token punctuation">:</span> cs1<span class="token punctuation">,</span><span class="token key atrule">'groups'</span><span class="token punctuation">:</span> group1<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">'name'</span><span class="token punctuation">:</span> cs2<span class="token punctuation">,</span><span class="token key atrule">'groups'</span><span class="token punctuation">:</span> group2<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">'name'</span><span class="token punctuation">:</span> cs3<span class="token punctuation">,</span><span class="token key atrule">'groups'</span><span class="token punctuation">:</span> group3<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook --syntax-check item3.yml

<span class="token comment"># æ‰§è¡Œ</span>
ansible-playbook item3.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-15" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-15"> 4ã€å¾ªç¯åµŒå¥—ä½¿ç”¨åœºæ™¯ - æ‰¹é‡åˆ é™¤ç”¨æˆ·åŠç”¨æˆ·ç»„</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim item3_1.yml</span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æ‰¹é‡åˆ é™¤ç”¨æˆ·åŠç”¨æˆ·ç»„
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> drop user
      <span class="token key atrule">user</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ item.name }}"</span>
        <span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token string">"{{ item.group }}"</span>
        <span class="token key atrule">remove</span><span class="token punctuation">:</span> yes
        <span class="token key atrule">state</span><span class="token punctuation">:</span> absent
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">'name'</span><span class="token punctuation">:</span> cs1<span class="token punctuation">,</span><span class="token key atrule">'group'</span><span class="token punctuation">:</span> group1<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">'name'</span><span class="token punctuation">:</span> cs2<span class="token punctuation">,</span><span class="token key atrule">'group'</span><span class="token punctuation">:</span> group2<span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">'name'</span><span class="token punctuation">:</span> cs3<span class="token punctuation">,</span><span class="token key atrule">'group'</span><span class="token punctuation">:</span> group3<span class="token punctuation">}</span>

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> drop group
      <span class="token key atrule">group</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"{{ item }}"</span>
        <span class="token key atrule">state</span><span class="token punctuation">:</span> absent
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> group1
      <span class="token punctuation">-</span> group2
      <span class="token punctuation">-</span> group3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook --syntax-check item3_1.yml

<span class="token comment"># æ‰§è¡Œ</span>
ansible-playbook item3_1.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-16" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-16"> 5ã€æ ‡å‡†å¾ªç¯ä½¿ç”¨åœºæ™¯ - æ‰¹é‡æ‹·è´å¤šä¸ªæ–‡ä»¶</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim item4.yml</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æ‰¹é‡æ‹·è´æ–‡ä»¶
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> bulk copy
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/home/test/<span class="token punctuation">{</span><span class="token punctuation">{</span> item.src <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=/home/cs/<span class="token punctuation">{</span><span class="token punctuation">{</span> item.dest <span class="token punctuation">}</span><span class="token punctuation">}</span> mode=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.mode <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"a.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"a.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"0777"</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"tongji.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"tongji.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"0777"</span><span class="token punctuation">}</span>
        
<span class="token comment"># -------------------------------æ­¤ä¸ºåˆ†ç•Œçº¿ï¼Œä¸Šä¸‹äº’ä¸ç›¸å¹²---------------------------------    </span>
        
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> æ‰¹é‡æ‹·è´æ–‡ä»¶åˆ°ä¸åŒçš„è·¯å¾„
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> bulk copy
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/home/test/<span class="token punctuation">{</span><span class="token punctuation">{</span> item.src <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.dest <span class="token punctuation">}</span><span class="token punctuation">}</span> mode=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.mode <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"a.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/home/cs/a.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"0777"</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"tongji.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/home/cs1/tongji.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"0777"</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># è¯­æ³•æ ¡éªŒ</span>
ansible-playbook --syntax-check item4.yml

<span class="token comment"># æ‰§è¡Œ</span>
ansible-playbook item4.yml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-3-å¼‚å¸¸å¤„ç†" tabindex="-1"><a class="header-anchor" href="#_2-3-å¼‚å¸¸å¤„ç†" aria-hidden="true">#</a> 2.3 å¼‚å¸¸å¤„ç†</h2>
<p>é»˜è®¤Playbookä¼šæ£€æŸ¥å‘½ä»¤å’Œæ¨¡å—çš„è¿”å›çŠ¶æ€ï¼Œå¦‚é‡åˆ°é”™è¯¯å°±ä¸­æ–­playbookçš„æ‰§è¡Œ</p>
<p>åŠ å…¥å‚æ•°: <font color=red>ignore_errors: yes</font> 	# å¿½ç•¥é”™è¯¯</p>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># cat expect.yml </span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> å¿½ç•¥é”™è¯¯æ¼”ç¤º
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> all
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ä½¿ç”¨ä¸€ä¸ªæœªçŸ¥çš„å‘½ä»¤
      <span class="token key atrule">command</span><span class="token punctuation">:</span> a
      <span class="token key atrule">ignore_errors</span><span class="token punctuation">:</span> yes

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> åˆ›å»ºä¸€ä¸ªæ–‡ä»¶
      <span class="token key atrule">file</span><span class="token punctuation">:</span> path=/home/cs/yichang state=touch
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç è§£æï¼š</p>
<blockquote>
<p>å¦‚ä¸Šä»£ç ï¼Œæ‰§è¡Œåˆ°commandçš„aå‘½ä»¤æ—¶ï¼ŒæœåŠ¡å™¨æ—¶æ²¡æœ‰è¿™ä¸ªå‘½ä»¤çš„ï¼Œå°±ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™äº†ä¹‹åï¼Œä¸‹é¢çš„æœåŠ¡å°±ä¸ä¼šç»§ç»­æ‰§è¡Œäº†ï¼›</p>
</blockquote>
<blockquote>
<p>æˆ‘ä»¬ç°åœ¨æ·»åŠ äº†ä¸€ä¸ª<code v-pre>ignore_errors: yes</code>ï¼Œè¿™æ ·å°±å¯ä»¥è·³è¿‡è¿™ä¸ªæŠ¥é”™ï¼Œç»§ç»­æ‰§è¡Œä¸‹é¢çš„å†…å®¹ï¼›</p>
</blockquote>
<h2 id="_2-4-tags-æ ‡ç­¾" tabindex="-1"><a class="header-anchor" href="#_2-4-tags-æ ‡ç­¾" aria-hidden="true">#</a> 2.4 tags æ ‡ç­¾</h2>
<p>â€ƒâ€ƒé»˜è®¤æƒ…å†µä¸‹ï¼ŒAnsibleåœ¨æ‰§è¡Œä¸€ä¸ªplaybookæ—¶ï¼Œä¼šæ‰§è¡Œplaybookä¸­å®šä¹‰çš„æ‰€æœ‰ä»»åŠ¡ï¼›Ansible playbookä¸­çš„tagæ ‡ç­¾æ˜¯ä¸€ç§ç”¨äºé€‰æ‹©æ€§è¿è¡Œç‰¹å®šä»»åŠ¡æˆ–ä»»åŠ¡é›†çš„æœºåˆ¶ã€‚é€šè¿‡ä¸ºæ¯ä¸ªä»»åŠ¡æŒ‡å®šæ ‡ç­¾ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œplaybookæ—¶é€‰æ‹©åªè¿è¡Œå¸¦æœ‰ç‰¹å®šæ ‡ç­¾çš„ä»»åŠ¡ï¼Œè€Œä¸è¿è¡Œå…¶ä»–ä»»åŠ¡ã€‚è¿™å¯¹äºæ§åˆ¶å’Œç®¡ç†Ansible playbookçš„æ‰§è¡Œéå¸¸æœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“æ‚¨çš„playbookåŒ…å«è®¸å¤šä»»åŠ¡æ—¶ã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-17" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-17"> 1ã€æ‰“æ ‡ç­¾çš„æ–¹å¼</label></li>
</ul>
<p>å¯¹ä¸€ä¸ªå¯¹è±¡æ‰“ä¸€ä¸ªæ ‡ç­¾</p>
<p>å¯¹ä¸€ä¸ªå¯¹è±¡æ‰“å¤šä¸ªæ ‡ç­¾</p>
<p>å¯¹å¤šä¸ªå¯¹è±¡æ‰“ä¸€ä¸ªæ ‡ç­¾</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-18" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-18"> 2ã€æ ‡ç­¾ä½¿ç”¨ï¼Œé€šè¿‡tagså’Œä»»åŠ¡å¯¹è±¡è¿›è¡Œæ†ç»‘ï¼Œæ§åˆ¶éƒ¨åˆ†æˆ–è€…æŒ‡å®šçš„taskæ‰§è¡Œ</label></li>
</ul>
<p><code v-pre>-t</code>ï¼šæ‰§è¡ŒæŒ‡å®šçš„tagæ ‡ç­¾ä»»åŠ¡</p>
<p><code v-pre>--list-tags</code>ï¼šåˆ—å‡ºæ­¤ymlæ–‡ä»¶ä¸­çš„æ‰€æœ‰tagæ ‡ç­¾</p>
<p><code v-pre>--skip-tags</code>ï¼šæ‰§è¡Œ--skip-tagsä¹‹å¤–çš„æ ‡ç­¾ä»»åŠ¡</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-19" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-19"> 3ã€ä»¥ä¸‹æ˜¯tagæ ‡ç­¾çš„ä½œç”¨ï¼š</label></li>
</ul>
<ol>
<li>
<p>é€‰æ‹©æ€§è¿è¡Œä»»åŠ¡ï¼šå¯ä»¥ä½¿ç”¨<code v-pre>--tags</code>å‚æ•°åœ¨è¿è¡Œansible-playbookå‘½ä»¤æ—¶æŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾ï¼Œåªæœ‰å¸¦æœ‰æŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡ä¼šè¿è¡Œã€‚è¿™å¯¹äºåœ¨å¤§å‹playbookä¸­åªè¿è¡Œç‰¹å®šä»»åŠ¡éå¸¸æœ‰ç”¨ï¼Œè€Œä¸æ˜¯è¿è¡Œæ•´ä¸ªplaybookã€‚</p>
</li>
<li>
<p>æ’é™¤ä»»åŠ¡ï¼šæ‚¨å¯ä»¥ä½¿ç”¨<code v-pre>--skip-tags</code>å‚æ•°æ¥æ’é™¤å…·æœ‰ç‰¹å®šæ ‡ç­¾çš„ä»»åŠ¡ï¼Œä»è€Œè¿è¡Œé™¤å¸¦æœ‰æŒ‡å®šæ ‡ç­¾çš„ä»»åŠ¡ä¹‹å¤–çš„æ‰€æœ‰å…¶ä»–ä»»åŠ¡ã€‚è¿™å¯¹äºåœ¨å¤§å‹playbookä¸­æ’é™¤ä¸éœ€è¦è¿è¡Œçš„ä»»åŠ¡éå¸¸æœ‰ç”¨ã€‚</p>
</li>
<li>
<p>ç»„ç»‡ä»»åŠ¡ï¼šæ ‡ç­¾å¯ä»¥å¸®åŠ©æ‚¨ç»„ç»‡å’Œåˆ†ç±»ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸ºé…ç½®ä»»åŠ¡æ·»åŠ ä¸€ä¸ª<code v-pre>config</code>æ ‡ç­¾ï¼Œä¸ºå®‰è£…ä»»åŠ¡æ·»åŠ ä¸€ä¸ª<code v-pre>install</code>æ ‡ç­¾ï¼Œä»¥ä¾¿æ›´å®¹æ˜“äº†è§£æ¯ä¸ªä»»åŠ¡çš„ç”¨é€”ã€‚</p>
</li>
<li>
<p>æ–‡æ¡£å’Œæ³¨é‡Šï¼šæ ‡ç­¾è¿˜å¯ä»¥ä½œä¸ºä»»åŠ¡çš„æ–‡æ¡£å’Œæ³¨é‡Šã€‚æ‚¨å¯ä»¥å°†æ ‡ç­¾ç”¨ä½œæè¿°ä»»åŠ¡çš„æ–¹å¼ï¼Œä»¥ä¾¿å…¶ä»–äººæ›´å®¹æ˜“ç†è§£æ¯ä¸ªä»»åŠ¡çš„ç›®çš„ã€‚</p>
</li>
</ol>
<p>ä¸‹é¢æ˜¯ä¸€äº›ç¤ºä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨è¿è¡Œansible-playbookæ—¶ä½¿ç”¨æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p>ä»…è¿è¡Œå¸¦æœ‰<code v-pre>install</code>æ ‡ç­¾çš„ä»»åŠ¡ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>ansible-playbook your_playbook.yml <span class="token parameter variable">--tags</span> <span class="token function">install</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>æ’é™¤å¸¦æœ‰<code v-pre>test</code>æ ‡ç­¾çš„ä»»åŠ¡ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>ansible-playbook your_playbook.yml --skip-tags <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
<li>
<p>è¿è¡Œå¸¦æœ‰å¤šä¸ªæ ‡ç­¾çš„ä»»åŠ¡ï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>ansible-playbook your_playbook.yml <span class="token parameter variable">--tags</span> <span class="token string">"install,config"</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
</ul>
<ul>
<li>
<p>åˆ—å‡ºymlæ–‡ä»¶ä¸­æ‰€æœ‰çš„æ ‡ç­¾</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code>ansible-playbook your_playbook.yml --list-tags
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li>
</ul>
<p>æ ‡ç­¾åŠŸèƒ½æœ‰åŠ©äºå¢åŠ Ansible playbookçš„å¯ç»´æŠ¤æ€§ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ›´ç²¾ç»†åœ°æ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œã€‚</p>
<ul class="task-list-container">
<li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" id="task-item-20" checked="checked" disabled="disabled"><label class="task-list-item-label" for="task-item-20"> 4ã€ã€å®ä¾‹ã€‘éƒ¨ç½²apacheæœåŠ¡å¹¶å¯åŠ¨ï¼Œä¸­é—´å¯ä»¥è‡ªè¡Œè®¾ç½®tagsæ ‡ç­¾ã€‚</label></li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code><span class="token punctuation">[</span>root@localhost yml<span class="token punctuation">]</span><span class="token comment"># vim tags.yml</span>
<span class="token punctuation">---</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> éƒ¨ç½²apacheæœåŠ¡
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span> web
  <span class="token key atrule">remote_user</span><span class="token punctuation">:</span> root
  <span class="token key atrule">vars</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">http_port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

  <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Install Http Server
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> present
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> install_httpd
        <span class="token punctuation">-</span> httpd_server

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> configure httpd server
      <span class="token key atrule">copy</span><span class="token punctuation">:</span>
        <span class="token key atrule">src</span><span class="token punctuation">:</span> ./httpd.conf
        <span class="token key atrule">dest</span><span class="token punctuation">:</span> /etc/httpd/conf/httpd.conf
        <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token number">0777</span>
      <span class="token key atrule">notify</span><span class="token punctuation">:</span> Restart Httpd Server
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> config_httpd
        <span class="token punctuation">-</span> httpd_server

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> start httpd server
      <span class="token key atrule">service</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> started
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> yes
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> start_httpd
   
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> stop httpd server
      <span class="token key atrule">service</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> stopped
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> stop_httpd

    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> uninstall httpd server
      <span class="token key atrule">yum</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> absent
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> uninstall_httpd

  <span class="token key atrule">handlers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Restart Httpd Server
      <span class="token key atrule">systemd</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> httpd
        <span class="token key atrule">state</span><span class="token punctuation">:</span> restarted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿™æ˜¯ä¸€ä¸ªAnsible playbookçš„YAMLæ–‡ä»¶ï¼Œç”¨äºéƒ¨ç½²Apache HTTPæœåŠ¡å™¨ã€‚YAMLæ–‡ä»¶è§£æï¼š</p>
<ol>
<li><code v-pre>name: éƒ¨ç½²apacheæœåŠ¡</code>ï¼šè¿™æ˜¯æ•´ä¸ªAnsible playbookçš„åç§°æˆ–æè¿°ã€‚</li>
<li><code v-pre>hosts: web</code>ï¼šè¿™æŒ‡å®šäº†è¯¥playbookå°†åœ¨åä¸º<code v-pre>web</code>çš„ä¸»æœºç»„ä¸Šæ‰§è¡Œã€‚æ‚¨éœ€è¦åœ¨æ‚¨çš„Ansible inventoryæ–‡ä»¶ä¸­å®šä¹‰ä¸»æœºç»„<code v-pre>web</code>ï¼Œæˆ–è€…åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šä¸»æœºã€‚</li>
<li><code v-pre>remote_user: root</code>ï¼šæŒ‡å®šäº†è¿è¡Œä»»åŠ¡æ—¶ä½¿ç”¨rootç”¨æˆ·èº«ä»½æ‰§è¡Œã€‚</li>
<li><code v-pre>vars:</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå˜é‡éƒ¨åˆ†ï¼Œç”¨äºå®šä¹‰å˜é‡ã€‚åœ¨è¿™é‡Œï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code v-pre>http_port</code>çš„å˜é‡ï¼Œå…¶å€¼ä¸º8080ã€‚</li>
<li><code v-pre>tasks:</code>ï¼šè¿™æ˜¯å®é™…ä»»åŠ¡éƒ¨åˆ†ï¼Œå…¶ä¸­åŒ…å«ä¸€ç³»åˆ—ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªåç§°å’Œç›¸åº”çš„æ“ä½œã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªä»»åŠ¡çš„è§£é‡Šï¼š
<ul>
<li>ç¬¬ä¸€ä¸ªä»»åŠ¡ï¼š<code v-pre>Install Http Server</code>ï¼šè¿™ä¸ªä»»åŠ¡ä½¿ç”¨<code v-pre>yum</code>æ¨¡å—æ¥å®‰è£…<code v-pre>httpd</code>è½¯ä»¶åŒ…ï¼Œç¡®ä¿Apache HTTPæœåŠ¡å™¨å·²ç»å®‰è£…åœ¨ä¸»æœºä¸Šã€‚æ­¤ä»»åŠ¡æœ‰ä¸¤ä¸ªtagsï¼š<code v-pre>install_httpd</code>å’Œ<code v-pre>httpd_server</code>ï¼Œä»¥ä¾¿åç»­å¯ä»¥é€‰æ‹©æ€§åœ°è¿è¡Œè¿™äº›ä»»åŠ¡ã€‚</li>
<li>ç¬¬äºŒä¸ªä»»åŠ¡ï¼š<code v-pre>configure httpd server</code>ï¼šè¿™ä¸ªä»»åŠ¡ä½¿ç”¨<code v-pre>copy</code>æ¨¡å—å°†æœ¬åœ°æ–‡ä»¶<code v-pre>httpd.conf</code>å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœºçš„<code v-pre>/etc/httpd/conf/httpd.conf</code>ä½ç½®ï¼Œå¹¶ç»™ç›®æ ‡æ–‡ä»¶è®¾ç½®æ‰§è¡Œæƒé™ï¼Œä»è€Œé…ç½®Apache HTTPæœåŠ¡å™¨ã€‚æ­¤ä»»åŠ¡æœ‰ä¸¤ä¸ªtagsï¼š<code v-pre>config_httpd</code>å’Œ<code v-pre>httpd_server</code>ã€‚ï¼ˆä¸ºä»€ä¹ˆè¦å¤šä½™ç§»åŠ¨è¿™ä¸ªå‘¢ï¼Œå› ä¸ºè¿™ä¸ªé…ç½®é‡Œæˆ‘ä»¬è‡ªå·±å†™çš„ï¼ŒåŒæ—¶ä¹Ÿä¿®æ”¹äº†httpdçš„ç«¯å£ä¸ºï¼š8080ï¼‰ã€‚<code v-pre>notify: Restart Httpd Server</code>æ„å‘³ç€å½“è¯¥ä»»åŠ¡çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ˆé€šå¸¸æ˜¯æˆåŠŸå®Œæˆä»»åŠ¡ï¼‰ï¼Œå®ƒå°†è§¦å‘åä¸º &quot;Restart Httpd Server&quot; çš„å¤„ç†ç¨‹åº<code v-pre>handlers</code>ã€‚</li>
<li>ç¬¬ä¸‰ä¸ªä»»åŠ¡ï¼š<code v-pre>start httpd server</code>ï¼šè¿™ä¸ªä»»åŠ¡ä½¿ç”¨<code v-pre>service</code>æ¨¡å—æ¥å¯åŠ¨å¹¶å¯ç”¨Apache HTTPæœåŠ¡å™¨ã€‚æ­¤ä»»åŠ¡æœ‰ä¸€ä¸ªtagï¼š<code v-pre>start_httpd</code>ã€‚</li>
<li>ç¬¬å››ä¸ªä»»åŠ¡ï¼š<code v-pre>stop httpd server</code>ï¼šåœæ­¢HTTPæœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ <code v-pre>service</code> æ¨¡å—å°† <code v-pre>httpd</code> æœåŠ¡åœæ­¢ã€‚æ­¤ä»»åŠ¡æœ‰ä¸€ä¸ªæ ‡ç­¾ <code v-pre>stop_httpd</code>ã€‚</li>
<li>ç¬¬äº”ä¸ªä»»åŠ¡ï¼š<code v-pre>uninstall httpd server</code>ï¼šå¸è½½HTTPæœåŠ¡å™¨ã€‚å®ƒä½¿ç”¨ <code v-pre>yum</code> æ¨¡å—å¸è½½ <code v-pre>httpd</code> è½¯ä»¶åŒ…ã€‚æ­¤ä»»åŠ¡æœ‰ä¸€ä¸ªæ ‡ç­¾ <code v-pre>uninstall_httpd</code>ã€‚</li>
</ul>
</li>
<li><code v-pre>handlers:</code>ï¼šè¿™éƒ¨åˆ†å®šä¹‰äº†å¤„ç†ç¨‹åºï¼Œè¿™æ˜¯ä¸€äº›åœ¨ä»»åŠ¡ä¸­ä½¿ç”¨çš„å‘½ååŠ¨ä½œï¼Œé€šå¸¸ä¸é€šçŸ¥ä¸€èµ·ä½¿ç”¨ã€‚åœ¨è¿™é‡Œï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º<code v-pre>Restart Httpd Server</code>çš„å¤„ç†ç¨‹åºï¼Œå½“<code v-pre>copy</code>ä»»åŠ¡å®Œæˆåï¼Œå¯ä»¥é€šçŸ¥å®ƒã€‚æ­¤å¤„ç†ç¨‹åºä½¿ç”¨<code v-pre>systemd</code>æ¨¡å—æ¥é‡æ–°å¯åŠ¨<code v-pre>httpd</code>æœåŠ¡ã€‚</li>
</ol>
<p>è¿™ä¸ªPlaybookå…è®¸æ‚¨æ‰§è¡Œä¸Apache HTTPæœåŠ¡å™¨æœ‰å…³çš„å„ç§æ“ä½œï¼Œå¦‚å®‰è£…ã€é…ç½®ã€å¯åŠ¨ã€åœæ­¢å’Œå¸è½½ã€‚ä½¿ç”¨ä¸åŒçš„æ ‡ç­¾å¯ä»¥é€‰æ‹©æ€§åœ°è¿è¡Œç‰¹å®šä»»åŠ¡æˆ–ä»»åŠ¡ç»„ã€‚</p>
<hr>
<p>æ‰§è¡Œï¼š</p>
<div class="language-bash line-numbers-mode" data-ext="sh"><pre v-pre class="language-bash"><code><span class="token comment"># æŸ¥çœ‹æ­¤ymlæ–‡ä»¶ä¸­çš„æ‰€æœ‰tagsæ ‡ç­¾</span>
<span class="token punctuation">[</span>root@localhost http<span class="token punctuation">]</span><span class="token comment"># ansible-playbook tags.yml --list-tags</span>

playbook: tags.yml

  play <span class="token comment">#1 (web): éƒ¨ç½²apacheæœåŠ¡	TAGS: []</span>
      TASK TAGS: <span class="token punctuation">[</span>config_httpd, httpd_server, install_httpd, start_httpd, stop_httpd, uninstall_httpd<span class="token punctuation">]</span>


<span class="token comment"># æ‰§è¡Œ install_httpd,config_httpdï¼ˆå®‰è£…ã€ç§»åŠ¨é…ç½®æ–‡ä»¶ï¼‰æ ‡ç­¾ï¼›æ‰§è¡Œç§»åŠ¨é…ç½®æ–‡ä»¶ä¼šè§¦å‘å¤„ç†ç¨‹åºï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨å¯åŠ¨æœåŠ¡ï¼›</span>
<span class="token punctuation">[</span>root@localhost http<span class="token punctuation">]</span><span class="token comment"># ansible-playbook tags.yml -t install_httpd,config_httpd</span>



<span class="token comment"># æ‰§è¡Œ uninstall_httpdï¼ˆå¸è½½httpdæœåŠ¡ï¼‰ æ ‡ç­¾</span>
<span class="token punctuation">[</span>root@localhost http<span class="token punctuation">]</span><span class="token comment"># ansible-playbook tags.yml -t uninstall_httpd</span>


<span class="token comment"># æ‰§è¡Œ httpd_server æ ‡ç­¾</span>
<span class="token punctuation">[</span>root@localhost http<span class="token punctuation">]</span><span class="token comment"># ansible-playbook tags.yml -t httpd_server</span>
<span class="token comment"># httpd_serveræ ‡ç­¾åŒ…å«ï¼ˆInstall Http Serverã€configure httpd serverã€Restart Httpd Serverï¼‰</span>
<span class="token comment"># æ‰€ä»¥ä¼šç›´æ¥æ‰§è¡Œè¿™ä¸‰ä¸ªä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯å®‰è£…ã€ç§»åŠ¨é…ç½®æ–‡ä»¶(å› ä¸ºä½¿ç”¨ç§»åŠ¨æ–‡ä»¶è§¦å‘äº†å¤„ç†ç¨‹åºnotifyï¼Œæ‰€ä»¥å°±ä¼šæ‰§è¡ŒRestart Httpd Serveré‡å¯æœåŠ¡ï¼‰</span>
<span class="token comment"># æ€»ç»“å°±æ˜¯ï¼šæ‰§è¡Œhttpd_serveræ ‡ç­¾ï¼Œä¼šå®‰è£…æœåŠ¡å¹¶å¯åŠ¨æœåŠ¡ã€‚</span>


<span class="token comment"># è·³è¿‡ httpd_server,start_httpdï¼ˆå®‰è£…åŠ å¯åŠ¨ï¼Œå¯åŠ¨ï¼‰æ ‡ç­¾</span>
<span class="token punctuation">[</span>root@localhost http<span class="token punctuation">]</span><span class="token comment"># ansible-playbook tags.yml --skip-tags httpd_server,start_httpd</span>

<span class="token comment"># æ‰§è¡Œç»“æœä¸ºï¼Œå…³é—­httpdæœåŠ¡å¹¶å¸è½½httpdæœåŠ¡ï¼›å› ä¸ºå·²ç»è·³è¿‡ httpd_server ï¼Œæ‰€ä»¥ä¸ä¼šæ‰§è¡Œå®‰è£…å’Œå¯åŠ¨ï¼›</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://img-blog.csdnimg.cn/95046449a23d4d99b7936dca174c5b7c.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" tabindex="0" loading="lazy"><figcaption>åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°</figcaption></figure>
<h1 id="ä¸‰ã€playbook-ä¸­å¸¸ç”¨çš„æ¨¡å—ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#ä¸‰ã€playbook-ä¸­å¸¸ç”¨çš„æ¨¡å—ä½¿ç”¨" aria-hidden="true">#</a> ä¸‰ã€Playbook ä¸­å¸¸ç”¨çš„æ¨¡å—ä½¿ç”¨</h1>
<ul>
<li>æ‰¹é‡å¤‡ä»½æ–‡ä»¶</li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> backup file
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> mv <span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> item <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">-</span>$(date +"%Y<span class="token punctuation">-</span>%m<span class="token punctuation">-</span>%d")
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> /home/cs/a.sh
        <span class="token punctuation">-</span> /home/cs/b.sh
        <span class="token punctuation">-</span> /home/cs/c.sh
      <span class="token key atrule">ignore_errors</span><span class="token punctuation">:</span> yes
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> backup_file
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œç»“æœä¸ºï¼š/home/cs/a.sh-2023-10-31ã€/home/cs/b.sh-2023-10-31ã€/home/cs/c.sh-2023-10-31<br>
ignore_errors: yes ä¸ºï¼šæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´æŠ¥é”™ï¼Œè·³è¿‡æŠ¥é”™ç»§ç»­æ‰§è¡Œï¼Œä¸è¿‡æœ€åè¿˜æ˜¯è¦è¿”å›æ¥çœ‹ï¼Œéœ€è¦å•ç‹¬å¤åˆ¶ã€‚</p>
<ul>
<li>æ‰¹é‡å¤åˆ¶æ–‡ä»¶ï¼šä»æœ¬åœ°å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä¸åŒè·¯å¾„</li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy file
      <span class="token key atrule">copy</span><span class="token punctuation">:</span> src=/etc/ansible/yml/update/<span class="token punctuation">{</span><span class="token punctuation">{</span> item.src <span class="token punctuation">}</span><span class="token punctuation">}</span> dest=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.dest <span class="token punctuation">}</span><span class="token punctuation">}</span> mode=<span class="token punctuation">{</span><span class="token punctuation">{</span> item.mode <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"a.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/data/cs/a.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"0777"</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"b.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/data/abc/b.sh"</span><span class="token punctuation">,</span> <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"0777"</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"cs.jar"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/data/conf/cs.jar"</span><span class="token punctuation">,</span> <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"0644"</span><span class="token punctuation">}</span>
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> copy_file
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>æ‰¹é‡å¤åˆ¶æ–‡ä»¶ï¼šä»å…¶ä»–æœåŠ¡å™¨å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä¸åŒè·¯å¾„</li>
</ul>
<div class="language-yaml line-numbers-mode" data-ext="yml"><pre v-pre class="language-yaml"><code>    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> copy shell/file
      <span class="token key atrule">shell</span><span class="token punctuation">:</span> cp <span class="token punctuation">-</span>ar <span class="token punctuation">{</span><span class="token punctuation">{</span> item.src <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> item.dest <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token key atrule">with_items</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"/home/test/nginx/conf/nginx.conf"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/usr/local/cs/nginx/conf/nginx.conf"</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"/home/test/nginx/conf/cs.conf"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/usr/local/cs/nginx/conf/cs.conf"</span><span class="token punctuation">}</span>
        <span class="token punctuation">-</span> <span class="token punctuation">{</span><span class="token key atrule">src</span><span class="token punctuation">:</span> <span class="token string">"/home/test/nginx/src/nginx"</span><span class="token punctuation">,</span> <span class="token key atrule">dest</span><span class="token punctuation">:</span> <span class="token string">"/usr/local/cs/nginx/src/nginx"</span><span class="token punctuation">}</span>
	  <span class="token key atrule">ignore_errors</span><span class="token punctuation">:</span> yes
      <span class="token key atrule">tags</span><span class="token punctuation">:</span> fugai
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ignore_errors: yes ä¸ºï¼šæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´æŠ¥é”™ï¼Œè·³è¿‡æŠ¥é”™ç»§ç»­æ‰§è¡Œï¼Œä¸è¿‡æœ€åè¿˜æ˜¯è¦è¿”å›æ¥çœ‹ï¼Œéœ€è¦å•ç‹¬å¤åˆ¶ã€‚</p>
<h1 id="å››ã€ç›¸å…³æ–‡ç« " tabindex="-1"><a class="header-anchor" href="#å››ã€ç›¸å…³æ–‡ç« " aria-hidden="true">#</a> å››ã€ç›¸å…³æ–‡ç« </h1>
<table>
<thead>
<tr>
<th style="text-align:center">æ–‡ç« æ ‡é¢˜</th>
<th style="text-align:center">æ–‡ç« é“¾æ¥</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133769300" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆä¸€ï¼‰ç®€ä»‹åŠéƒ¨ç½²ã€æ¸…å•<ExternalLinkIcon/></a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133769300" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133769300<ExternalLinkIcon/></a></td>
</tr>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133772023" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆäºŒï¼‰ad-hoc æ¨¡å¼è¯¦è§£<ExternalLinkIcon/></a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133772023" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133772023<ExternalLinkIcon/></a></td>
</tr>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133899966" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆä¸‰ï¼‰Playbook æ¨¡å¼è¯¦è§£<ExternalLinkIcon/></a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133899966" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133899966<ExternalLinkIcon/></a></td>
</tr>
<tr>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133994509" target="_blank" rel="noopener noreferrer">Ansibleè‡ªåŠ¨åŒ–è¿ç»´ï¼ˆå››ï¼‰jinja2 æ¨¡æ¿ã€Rolesè§’è‰²è¯¦è§£<ExternalLinkIcon/></a></td>
<td style="text-align:center"><a href="https://liucy.blog.csdn.net/article/details/133994509" target="_blank" rel="noopener noreferrer">https://liucy.blog.csdn.net/article/details/133994509<ExternalLinkIcon/></a></td>
</tr>
</tbody>
</table>
</div></template>


