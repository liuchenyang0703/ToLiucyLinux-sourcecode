import{_ as d}from"./plugin-vue_export-helper-c27b6911.js";import{r,o,c,a as e,b as n,d as s,w as l,e as t}from"./app-6706a352.js";const u={},p=e("p",null,[n("ğŸ"),e("strong",null,"åšä¸»ç®€ä»‹")],-1),b={href:"https://blog.csdn.net/liu_chen_yang?type=blog",target:"_blank",rel:"noopener noreferrer"},m=e("br",null,null,-1),v={href:"https://bbs.huaweicloud.com/community/myblog",target:"_blank",rel:"noopener noreferrer"},k=e("br",null,null,-1),h={href:"https://developer.aliyun.com/my?spm=a2c6h.13148508.setting.3.21fc4f0eCmz1v3#/article?_k=zooqoz",target:"_blank",rel:"noopener noreferrer"},g=e("br",null,null,-1),f=e("strong",null,"äº¤æµç¤¾åŒºï¼š",-1),_={href:"https://bbs.csdn.net/forums/lcy",target:"_blank",rel:"noopener noreferrer"},y=e("h2",{id:"kubernetesç®€ä»‹",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#kubernetesç®€ä»‹","aria-hidden":"true"},"#"),n(" Kubernetesç®€ä»‹")],-1),x=e("blockquote",null,[e("p",null,"â€ƒâ€ƒKubernetes(ç®€ç§°:k8s) æ˜¯Googleåœ¨2014å¹´6æœˆå¼€æºçš„ä¸€ä¸ªå®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨Goè¯­è¨€å¼€å‘ï¼Œç”¨äºç®¡ç†äº‘å¹³å°ä¸­å¤šä¸ªä¸»æœºä¸Šçš„å®¹å™¨åŒ–çš„åº”ç”¨ï¼ŒKubernetesçš„ç›®æ ‡æ˜¯è®©éƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ç®€å•å¹¶ä¸”é«˜æ•ˆ,Kubernetesæä¾›äº†èµ„æºè°ƒåº¦ã€éƒ¨ç½²ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ‰©å®¹ç¼©å®¹ã€ç›‘æ§ï¼Œç»´æŠ¤ç­‰ä¸€æ•´å¥—åŠŸèƒ½ã€‚")],-1),P={href:"https://kubernetes.io",target:"_blank",rel:"noopener noreferrer"},C=t(`<h3 id="_1-kubernetesæ¶æ„" tabindex="-1"><a class="header-anchor" href="#_1-kubernetesæ¶æ„" aria-hidden="true">#</a> 1 kubernetesæ¶æ„</h3><blockquote><p>â€ƒâ€ƒKuberneteså…·æœ‰å»ä¸­å¿ƒåŒ–çš„æ¶æ„ï¼Œä¸ä¼šçº¿æ€§å¤„ç†ä»»åŠ¡ã€‚å®ƒåŸºäºå£°æ˜æ€§æ¨¡å‹è¿è¡Œå¹¶å®ç°&quot;æ‰€éœ€çŠ¶æ€&quot;çš„æ¦‚å¿µã€‚ä¸‹é¢è¿™äº›æ­¥éª¤è¯´æ˜äº†Kubernetesçš„åŸºæœ¬è¿‡ç¨‹:</p><ul><li>ç®¡ç†å‘˜åˆ›å»ºåº”ç”¨ç¨‹åºçš„æ‰€éœ€çŠ¶æ€å¹¶å°†å…¶æ”¾å…¥æ¸…å•æ–‡ä»¶manifest.ymlä¸­ã€‚</li><li>ä½¿ç”¨CLIæˆ–æä¾›çš„ç”¨æˆ·ç•Œé¢å°†æ¸…å•æ–‡ä»¶æä¾›ç»™Kubernetes API Serverã€‚ Kubernetesçš„é»˜è®¤å‘½ä»¤è¡Œå·¥å…·ç§°ä¸ºkubectlã€‚</li><li>Kuberneteså°†æ¸…å•æ–‡ä»¶ï¼ˆæè¿°äº†åº”ç”¨ç¨‹åºçš„æœŸæœ›çŠ¶æ€ï¼‰å­˜å‚¨åœ¨ç§°ä¸ºé”®å€¼å­˜å‚¨ï¼ˆetcdï¼‰çš„æ•°æ®åº“ä¸­ã€‚</li><li>Kuberneteséšååœ¨é›†ç¾¤å†…çš„æ‰€æœ‰ç›¸å…³åº”ç”¨ç¨‹åºä¸Šå®ç°æ‰€éœ€çš„çŠ¶æ€ã€‚</li><li>KubernetesæŒç»­ç›‘æ§é›†ç¾¤çš„å…ƒç´ ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€ä¸ä¼šä¸æ‰€éœ€çŠ¶æ€æœ‰æ‰€ä¸åŒã€‚</li></ul></blockquote><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420964.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_1-1masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_1-1masterèŠ‚ç‚¹" aria-hidden="true">#</a> 1.1masterèŠ‚ç‚¹</h4><blockquote><p>â€ƒâ€ƒk8sé›†ç¾¤çš„ç®¡ç†èŠ‚ç‚¹ï¼Œè´Ÿè´£ç®¡ç†é›†ç¾¤ï¼Œæä¾›é›†ç¾¤çš„èµ„æºæ•°æ®è®¿é—®å…¥å£ã€‚æ‹¥æœ‰Etcdå­˜å‚¨æœåŠ¡ï¼ˆå¯é€‰ï¼‰ï¼Œè¿è¡ŒApi Serverè¿›ç¨‹ï¼ŒController ManageræœåŠ¡è¿›ç¨‹åŠScheduleræœåŠ¡è¿›ç¨‹ï¼Œå…³è”å·¥ä½œèŠ‚ç‚¹Nodeã€‚</p><ul><li>API Server</li></ul><p>æä¾›äº†èµ„æºå¯¹è±¡çš„å”¯ä¸€æ“ä½œå…¥å£ï¼Œå…¶ä»–æ‰€æœ‰ç»„ä»¶éƒ½å¿…é¡»é€šè¿‡å®ƒæä¾›çš„APIæ¥æ“ä½œèµ„æºæ•°æ®ï¼Œåªæœ‰API Serverä¸å­˜å‚¨é€šä¿¡ï¼Œå…¶ä»–æ¨¡å—é€šè¿‡API Serverè®¿é—®é›†ç¾¤çŠ¶æ€ã€‚</p><ul><li>Scheduler</li></ul><p>æ–°å»ºç«‹çš„Podè¿›è¡ŒèŠ‚ç‚¹(node)é€‰æ‹©(å³åˆ†é…æœºå™¨)ï¼Œè´Ÿè´£é›†ç¾¤çš„èµ„æºè°ƒåº¦ã€‚ç»„ä»¶æŠ½ç¦»ï¼Œå¯ä»¥æ–¹ä¾¿æ›¿æ¢æˆå…¶ä»–è°ƒåº¦å™¨ã€‚</p><ul><li>Controller</li></ul><p>è´Ÿè´£æ‰§è¡Œå„ç§æ§åˆ¶å™¨ï¼Œç›®å‰å·²ç»æä¾›äº†å¾ˆå¤šæ§åˆ¶å™¨æ¥ä¿è¯Kubernetesçš„æ­£å¸¸è¿è¡Œã€‚</p><ul><li>Cluster state store</li></ul><p>Kubernetesé»˜è®¤ä½¿ç”¨etcdä½œä¸ºé›†ç¾¤æ•´ä½“å­˜å‚¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒçš„æŠ€æœ¯ã€‚etcdæ˜¯ä¸€ä¸ªç®€å•çš„ã€åˆ†å¸ƒå¼çš„ã€ä¸€è‡´çš„key-valueå­˜å‚¨ï¼Œä¸»è¦è¢«ç”¨æ¥å…±äº«é…ç½®å’ŒæœåŠ¡å‘ç°ã€‚etcdæä¾›äº†ä¸€ä¸ªCRUDæ“ä½œçš„REST APIï¼Œä»¥åŠæä¾›äº†ä½œä¸ºæ³¨å†Œçš„æ¥å£ï¼Œä»¥ç›‘æ§æŒ‡å®šçš„Nodeã€‚é›†ç¾¤çš„æ‰€æœ‰çŠ¶æ€éƒ½å­˜å‚¨åœ¨etcdå®ä¾‹ä¸­ï¼Œå¹¶å…·æœ‰ç›‘æ§çš„èƒ½åŠ›ï¼Œå› æ­¤å½“etcdä¸­çš„ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°±èƒ½å¤Ÿå¿«é€Ÿçš„é€šçŸ¥é›†ç¾¤ä¸­ç›¸å…³çš„ç»„ä»¶ã€‚</p></blockquote><table><thead><tr><th>æ§åˆ¶å™¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Replication Controller</td><td>ç®¡ç†ç»´æŠ¤Replication Controllerï¼Œå…³è”Replication Controllerå’ŒPodï¼Œä¿è¯Replication Controllerå®šä¹‰çš„å‰¯æœ¬æ•°</td></tr><tr><td>Node Controller</td><td>ç®¡ç†ç»´æŠ¤Nodeï¼Œå®šæœŸæ£€æŸ¥Nodeçš„å¥åº·çŠ¶æ€ï¼Œæ ‡è¯†å‡º(å¤±æ•ˆ|æœªå¤±æ•ˆ)çš„NodeèŠ‚ç‚¹ã€‚</td></tr><tr><td>Namespace Controller</td><td>ç®¡ç†ç»´æŠ¤Namespaceï¼Œå®šæœŸæ¸…ç†æ— æ•ˆçš„Namespaceï¼ŒåŒ…æ‹¬Namesapceä¸‹çš„APIå¯¹è±¡ï¼Œæ¯”å¦‚Podã€Serviceç­‰ã€‚</td></tr><tr><td>Service Controller</td><td>ç®¡ç†ç»´æŠ¤Serviceï¼Œæä¾›è´Ÿè½½ä»¥åŠæœåŠ¡ä»£ç†ã€‚</td></tr><tr><td>EndPoints Controller</td><td>ç®¡ç†ç»´æŠ¤Endpointsï¼Œå…³è”Serviceå’ŒPodï¼Œåˆ›å»ºEndpointsä¸ºServiceçš„åç«¯ï¼Œå½“Podå‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®æ—¶æ›´æ–°Endpointsã€‚</td></tr><tr><td>Service Account Controller</td><td>ç®¡ç†ç»´æŠ¤Service Accountï¼Œä¸ºæ¯ä¸ªNamespaceåˆ›å»ºé»˜è®¤çš„Service Accountï¼ŒåŒæ—¶ä¸ºService Accountåˆ›å»ºService Account Secretã€‚</td></tr><tr><td>Persistent Volume Controller</td><td>ç®¡ç†ç»´æŠ¤Persistent Volumeå’ŒPersistent Volume Claimï¼Œä¸ºæ–°çš„Persistent Volume Claimåˆ†é…Persistent Volumeè¿›è¡Œç»‘å®šï¼Œä¸ºé‡Šæ”¾çš„Persistent Volumeæ‰§è¡Œæ¸…ç†å›æ”¶ã€‚</td></tr><tr><td>DaemonSet Controller</td><td>ç®¡ç†ç»´æŠ¤Daemon Setï¼Œè´Ÿè´£åˆ›å»ºDaemon Podï¼Œä¿è¯æŒ‡å®šçš„Nodeä¸Šæ­£å¸¸çš„è¿è¡ŒDaemon Podã€‚</td></tr><tr><td>Deployment Controller</td><td>ç®¡ç†ç»´æŠ¤Deploymentï¼Œå…³è”Deploymentå’ŒReplication Controllerï¼Œä¿è¯è¿è¡ŒæŒ‡å®šæ•°é‡çš„Podã€‚å½“Deploymentæ›´æ–°æ—¶ï¼Œæ§åˆ¶å®ç°Replication Controllerå’ŒPodçš„æ›´æ–°ã€‚</td></tr><tr><td>Job Controller</td><td>ç®¡ç†ç»´æŠ¤Jobï¼Œä¸ºJodåˆ›å»ºä¸€æ¬¡æ€§ä»»åŠ¡Podï¼Œä¿è¯å®ŒæˆJobæŒ‡å®šå®Œæˆçš„ä»»åŠ¡æ•°ç›®</td></tr><tr><td>Pod Autoscaler Controller</td><td>å®ç°Podçš„è‡ªåŠ¨ä¼¸ç¼©ï¼Œå®šæ—¶è·å–ç›‘æ§æ•°æ®ï¼Œè¿›è¡Œç­–ç•¥åŒ¹é…ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶æ‰§è¡ŒPodçš„ä¼¸ç¼©åŠ¨ä½œã€‚</td></tr></tbody></table><h4 id="_1-2-nodeèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#_1-2-nodeèŠ‚ç‚¹" aria-hidden="true">#</a> 1.2 NodeèŠ‚ç‚¹</h4><blockquote><p>â€ƒâ€ƒNodeèŠ‚ç‚¹æ˜¯å·¥ä½œèŠ‚ç‚¹ç›‘å¬API Serverå‘é€è¿‡æ¥çš„æ–°çš„å·¥ä½œåˆ†é…ï¼›ä»–ä»¬ä¼šæ‰§è¡Œåˆ†é…ç»™ä»–ä»¬çš„å·¥ä½œï¼Œç„¶åå°†ç»“æœæŠ¥å‘Šç»™Kubernetesä¸»èŠ‚ç‚¹ã€‚</p><ul><li>Kubelet</li></ul><p>è´Ÿè´£ç®¡æ§å®¹å™¨ï¼ŒKubeletä¼šä»Kubernetes API Serveræ¥æ”¶Podçš„åˆ›å»ºè¯·æ±‚ï¼Œå¯åŠ¨å’Œåœæ­¢å®¹å™¨ï¼Œç›‘æ§å®¹å™¨è¿è¡ŒçŠ¶æ€å¹¶æ±‡æŠ¥ç»™Kubernetes API Serverã€‚</p><ul><li>Container Runtime</li></ul><p>æ¯ä¸€ä¸ªNodeéƒ½ä¼šè¿è¡Œä¸€ä¸ªContainer Runtimeï¼Œå…¶è´Ÿè´£ä¸‹è½½é•œåƒå’Œè¿è¡Œå®¹å™¨ã€‚Kubernetesæœ¬èº«å¹¶ä¸æä¾›å®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒï¼Œä½†æä¾›äº†æ¥å£ï¼Œå¯ä»¥æ’å…¥æ‰€é€‰æ‹©çš„å®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒã€‚kubeletä½¿ç”¨Unix socketä¹‹ä¸Šçš„gRPCæ¡†æ¶ä¸å®¹å™¨è¿è¡Œæ—¶è¿›è¡Œé€šä¿¡ï¼Œkubeletä½œä¸ºå®¢æˆ·ç«¯ï¼Œè€ŒCRI shimä½œä¸ºæœåŠ¡å™¨ã€‚</p><ul><li>kube proxy</li></ul><p>åŸºäºä¸€ç§å…¬å…±è®¿é—®ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼šè´Ÿè½½å‡è¡¡ï¼‰ï¼ŒæœåŠ¡æä¾›äº†ä¸€ç§è®¿é—®ä¸€ç¾¤podçš„é€”å¾„ã€‚æ­¤æ–¹å¼é€šè¿‡åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„IPæ¥å®ç°ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®æ­¤IPï¼Œå¹¶èƒ½å¤Ÿå°†æœåŠ¡é€æ˜çš„ä»£ç†è‡³Podã€‚æ¯ä¸€ä¸ªNodeéƒ½ä¼šè¿è¡Œä¸€ä¸ªkube-proxyï¼Œkube proxyé€šè¿‡iptablesè§„åˆ™å¼•å¯¼è®¿é—®è‡³æœåŠ¡IPï¼Œå¹¶å°†é‡å®šå‘è‡³æ­£ç¡®çš„åç«¯åº”ç”¨ï¼Œé€šè¿‡è¿™ç§æ–¹å¼kube-proxyæä¾›äº†ä¸€ä¸ªé«˜å¯ç”¨çš„è´Ÿè½½å‡è¡¡è§£å†³æ–¹æ¡ˆã€‚æœåŠ¡å‘ç°ä¸»è¦é€šè¿‡DNSå®ç°ã€‚<br> â€ƒâ€ƒåœ¨Kubernetesä¸­ï¼Œkube proxyè´Ÿè´£ä¸ºPodåˆ›å»ºä»£ç†æœåŠ¡ï¼›å¼•åˆ°è®¿é—®è‡³æœåŠ¡ï¼›å¹¶å®ç°æœåŠ¡åˆ°Podçš„è·¯ç”±å’Œè½¬å‘ï¼Œä»¥åŠé€šè¿‡åº”ç”¨çš„è´Ÿè½½å‡è¡¡ã€‚</p><ul><li>Pod</li></ul><p>è¿è¡ŒäºNodeèŠ‚ç‚¹ä¸Šï¼Œè‹¥å¹²ç›¸å…³å®¹å™¨çš„ç»„åˆã€‚Podå†…åŒ…å«çš„å®¹å™¨è¿è¡Œåœ¨åŒä¸€å®¿ä¸»æœºä¸Šï¼Œä½¿ç”¨ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´ã€IPåœ°å€,åŒä¸€ä¸ªPodä¸­ï¼Œç«¯å£ä¸èƒ½é‡å¤ï¼Œå¦åˆ™æŠ¥é”™ï¼Œèƒ½å¤Ÿé€šè¿‡localhostè¿›è¡Œé€šä¿¡ã€‚Podæ˜¯Kurbernetesè¿›è¡Œåˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†çš„æœ€å°å•ä½ï¼Œå®ƒæä¾›äº†æ¯”å®¹å™¨æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œä½¿å¾—éƒ¨ç½²å’Œç®¡ç†æ›´åŠ çµæ´»ã€‚ä¸€ä¸ªPodå¯ä»¥åŒ…å«ä¸€ä¸ªå®¹å™¨æˆ–è€…å¤šä¸ªç›¸å…³å®¹å™¨ã€‚<br> â€ƒâ€ƒPodå…¶å®æœ‰ä¸¤ç§ç±»å‹ï¼šæ™®é€šPodå’Œé™æ€Podï¼Œåè€…æ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒå¹¶ä¸å­˜åœ¨Kubernetesçš„etcdå­˜å‚¨ä¸­ï¼Œè€Œæ˜¯å­˜æ”¾åœ¨æŸä¸ªå…·ä½“çš„Nodeä¸Šçš„ä¸€ä¸ªå…·ä½“æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”åªåœ¨æ­¤Nodeä¸Šå¯åŠ¨ã€‚æ™®é€šPodä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¼šè¢«æ”¾å…¥etcdå­˜å‚¨ä¸­ï¼Œéšåä¼šè¢«Kubernetes Masterè°ƒåº¦åˆ°æ‘¸ä¸ªå…·ä½“çš„Nodeä¸Šè¿›è¡Œç»‘å®šï¼Œéšåè¯¥Podè¢«å¯¹åº”çš„Nodeä¸Šçš„kubeletè¿›ç¨‹å®ä¾‹åŒ–æˆä¸€ç»„ç›¸å…³çš„Dockerå®¹å™¨å¹¶å¯åŠ¨èµ·æ¥ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Podé‡Œçš„æŸä¸ªå®¹å™¨åœæ­¢æ—¶ï¼ŒKubernetesä¼šè‡ªåŠ¨æ£€æµ‹åˆ°è¿™ä¸ªé—®èµ·å¹¶ä¸”é‡å¯è¿™ä¸ªPodï¼ˆé‡å¯Podé‡Œçš„æ‰€æœ‰å®¹å™¨ï¼‰ï¼Œå¦‚æœPodæ‰€åœ¨çš„Nodeå®•æœºï¼Œåˆ™ä¼šå°†è¿™ä¸ªNodeä¸Šçš„æ‰€æœ‰Podé‡æ–°è°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šã€‚</p></blockquote><h4 id="_1-3-kubectl" tabindex="-1"><a class="header-anchor" href="#_1-3-kubectl" aria-hidden="true">#</a> 1.3 kubectl</h4><blockquote><p>â€ƒâ€ƒ é›†ç¾¤ç®¡ç†å‘½ä»¤è¡Œå·¥å…·é›†ï¼Œé€šè¿‡å®¢æˆ·ç«¯çš„kubectlå‘½ä»¤é›†æ“ä½œï¼ŒAPI Serverå“åº”å¯¹åº”çš„å‘½ä»¤ç»“æœï¼Œä»è€Œè¾¾åˆ°å¯¹kubernetesé›†ç¾¤çš„ç®¡ç†ã€‚</p></blockquote><h3 id="_2-kubeadm" tabindex="-1"><a class="header-anchor" href="#_2-kubeadm" aria-hidden="true">#</a> 2 kubeadm</h3><p>â€ƒâ€ƒKubeadmæ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒæä¾›äº†kubeadm initä»¥åŠkubeadm joinè¿™ä¸¤ä¸ªå‘½ä»¤ä½œä¸ºå¿«é€Ÿåˆ›å»ºkubernetes é›†ç¾¤çš„æœ€ä½³å®è·µã€‚</p><p>â€ƒâ€ƒkubeadmé€šè¿‡æ‰§è¡Œå¿…è¦çš„æ“ä½œæ¥å¯åŠ¨å’Œè¿è¡Œä¸€ä¸ªæœ€å°å¯ç”¨çš„é›†ç¾¤ã€‚kubeadmåªå…³å¿ƒå¯åŠ¨é›†ç¾¤ï¼Œè€Œä¸å…³å¿ƒå…¶ä»–å·¥ä½œï¼Œå¦‚éƒ¨ç½²å‰çš„èŠ‚ç‚¹å‡†å¤‡å·¥ä½œã€å®‰è£…å„ç§Kubernetes Dashboardã€ç›‘æ§è§£å†³æ–¹æ¡ˆä»¥åŠç‰¹å®šäº‘æä¾›å•†çš„æ’ä»¶ï¼Œè¿™äº›éƒ½ä¸å±äºkubeadmå…³æ³¨èŒƒå›´ã€‚</p><h4 id="_2-1-kubeadmåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#_2-1-kubeadmåŠŸèƒ½" aria-hidden="true">#</a> 2.1 kubeadmåŠŸèƒ½</h4><ul><li>kubeadm init å¯åŠ¨/åˆå§‹åŒ–ä¸€ä¸ª Kubernetes ä¸»èŠ‚ç‚¹ï¼›</li><li>kubeadm join å¯åŠ¨ä¸€ä¸ª Kubernetes å·¥ä½œèŠ‚ç‚¹å¹¶ä¸”å°†å…¶åŠ å…¥åˆ°é›†ç¾¤ï¼›</li><li>kubeadm upgrade æ›´æ–°ä¸€ä¸ª Kubernetes é›†ç¾¤åˆ°æ–°ç‰ˆæœ¬ï¼›</li><li>kubeadm config å¦‚æœä½¿ç”¨ v1.7.x æˆ–è€…æ›´ä½ç‰ˆæœ¬çš„ kubeadm åˆå§‹åŒ–é›†ç¾¤ï¼Œæ‚¨éœ€è¦å¯¹é›†ç¾¤åšä¸€äº›é…ç½®ä»¥ä¾¿ä½¿ç”¨ kubeadm upgrade å‘½ä»¤ï¼›</li><li>kubeadm token ç®¡ç† kubeadm join ä½¿ç”¨çš„ä»¤ç‰Œï¼›</li><li>kubeadm reset è¿˜åŸ kubeadm init æˆ–è€… kubeadm join å¯¹ä¸»æœºæ‰€åšçš„ä»»ä½•æ›´æ”¹ï¼›</li><li>kubeadm version æ‰“å° kubeadm ç‰ˆæœ¬ï¼›</li><li>kubeadm alpha é¢„è§ˆä¸€ç»„å¯ç”¨çš„æ–°åŠŸèƒ½ä»¥ä¾¿ä»ç¤¾åŒºæœé›†åé¦ˆã€‚</li></ul><h2 id="kubernetesé›†ç¾¤éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#kubernetesé›†ç¾¤éƒ¨ç½²" aria-hidden="true">#</a> Kubernetesé›†ç¾¤éƒ¨ç½²</h2><h2 id="å‡†å¤‡å·¥ä½œ-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦åšåŒæ ·çš„æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#å‡†å¤‡å·¥ä½œ-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦åšåŒæ ·çš„æ“ä½œ" aria-hidden="true">#</a> å‡†å¤‡å·¥ä½œï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦åšåŒæ ·çš„æ“ä½œï¼‰</h2><h3 id="æœåŠ¡å™¨é…ç½®" tabindex="-1"><a class="header-anchor" href="#æœåŠ¡å™¨é…ç½®" aria-hidden="true">#</a> æœåŠ¡å™¨é…ç½®</h3><table><thead><tr><th>é›†ç¾¤ï¼ˆä¸€ä¸»ä¸¤ä»ï¼‰</th><th>ipåœ°å€</th><th>ä¸»æœºå</th><th>é…ç½®</th></tr></thead><tbody><tr><td>ä¸»</td><td>172.16.11.221</td><td>k8s-master</td><td>2C/2G/50G</td></tr><tr><td>ä»</td><td>172.16.11.222</td><td>k8s-node1</td><td>2C/2G/50G</td></tr><tr><td>ä»</td><td>172.16.11.223</td><td>k8s-node2</td><td>2C/2G/50G</td></tr></tbody></table><h3 id="å…³é—­é˜²ç«å¢™" tabindex="-1"><a class="header-anchor" href="#å…³é—­é˜²ç«å¢™" aria-hidden="true">#</a> å…³é—­é˜²ç«å¢™</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl stop firewalld <span class="token operator">&amp;&amp;</span> systemctl disable firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœåœ¨çº¿ä¸ŠæœåŠ¡å™¨ä¹‹ç±»çš„ä¸èƒ½å…³é—­é˜²ç«å¢™ï¼Œé‚£å°±éœ€è¦å¼€å¯å‡ ä¸ªç«¯å£ï¼›ï¼ˆè¿™é‡Œè¯´çš„æ˜¯k8æ‰€ç”¨åˆ°çš„ç«¯å£ï¼‰</p><ul><li>masterèŠ‚ç‚¹:</li></ul><table><thead><tr><th>è§„åˆ™</th><th>ç«¯å£èŒƒå›´</th><th>ä½œç”¨</th><th>ä½¿ç”¨è€…</th></tr></thead><tbody><tr><td>TCP</td><td>6443*</td><td>Kubernetes API server</td><td>All</td></tr><tr><td>TCP</td><td>2379-2380</td><td>etcd server client API</td><td>kube-apiserver, etcd</td></tr><tr><td>TCP</td><td>10250</td><td>Kubelet API</td><td>Self, Control plane</td></tr><tr><td>TCP</td><td>10251</td><td>kube-scheduler</td><td>Self</td></tr><tr><td>TCP</td><td>10252</td><td>kube-controller-manager</td><td>Self</td></tr></tbody></table><ul><li>nodeèŠ‚ç‚¹ï¼š</li></ul><table><thead><tr><th>è§„åˆ™</th><th>ç«¯å£èŒƒå›´</th><th>ä½œç”¨</th><th>ä½¿ç”¨è€…</th></tr></thead><tbody><tr><td>TCP</td><td>10252</td><td>Kubelet API</td><td>Self, Control plane</td></tr><tr><td>TCP</td><td>30000-32767</td><td>NodePort Services**</td><td>All</td></tr></tbody></table><h3 id="å…³é—­selinux" tabindex="-1"><a class="header-anchor" href="#å…³é—­selinux" aria-hidden="true">#</a> å…³é—­selinux</h3><p>ä¸´æ—¶å…³é—­selinuxï¼ˆæ²™æ²³ï¼‰å¦‚éœ€æ°¸ä¹…å…³é—­selinuxéœ€è¦ä¿®æ”¹ä¸º<code>sed -i &#39;s/^SELINUX=enforcing$/SELINUX=disabled/&#39; /etc/selinux/config</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#ä¸´æ—¶å…³é—­selinux</span>
setenforce <span class="token number">0</span>

<span class="token comment">#æ°¸ä¹…å…³é—­selinux</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s/^SELINUX=enforcing$/SELINUX=permissive/&#39;</span> /etc/selinux/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å…³é—­äº¤æ¢åˆ†åŒº" tabindex="-1"><a class="header-anchor" href="#å…³é—­äº¤æ¢åˆ†åŒº" aria-hidden="true">#</a> å…³é—­äº¤æ¢åˆ†åŒº</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#ä¸´æ—¶å…³é—­æ‰€æœ‰çš„äº¤æ¢åˆ†åŒº</span>
swapoff <span class="token parameter variable">-a</span>

<span class="token comment">#æ°¸ä¹…å…³é—­æ‰€æœ‰çš„äº¤æ¢åˆ†åŒº</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/swap/s/^\\(.*\\)$/#\\1/g&#39;</span> /etc/fstab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä¿®æ”¹ä¸‰å°é›†ç¾¤çš„ä¸»æœºå-æ¯ä¸ªä¸»æœºé™ä¸€æ¡å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹ä¸‰å°é›†ç¾¤çš„ä¸»æœºå-æ¯ä¸ªä¸»æœºé™ä¸€æ¡å‘½ä»¤" aria-hidden="true">#</a> ä¿®æ”¹ä¸‰å°é›†ç¾¤çš„ä¸»æœºåï¼šï¼ˆæ¯ä¸ªä¸»æœºé™ä¸€æ¡å‘½ä»¤ï¼‰</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master1 ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname k8s-master</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname k8s-node1</span>
<span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname k8s-node2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ‰€æœ‰èŠ‚ç‚¹éƒ½æ·»åŠ é›†ç¾¤ipä¸ä¸»æœºååˆ°hostsä¸­" tabindex="-1"><a class="header-anchor" href="#æ‰€æœ‰èŠ‚ç‚¹éƒ½æ·»åŠ é›†ç¾¤ipä¸ä¸»æœºååˆ°hostsä¸­" aria-hidden="true">#</a> æ‰€æœ‰èŠ‚ç‚¹éƒ½æ·»åŠ é›†ç¾¤ipä¸ä¸»æœºååˆ°hostsä¸­ï¼š</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF 
172.16.11.221 k8s-master
172.16.11.222 k8s-node1
172.16.11.223 k8s-node2
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,35),S=t(`<h3 id="ä¸‰å°æœºå™¨è¿›è¡Œæ—¶é—´åŒæ­¥" tabindex="-1"><a class="header-anchor" href="#ä¸‰å°æœºå™¨è¿›è¡Œæ—¶é—´åŒæ­¥" aria-hidden="true">#</a> ä¸‰å°æœºå™¨è¿›è¡Œæ—¶é—´åŒæ­¥</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#å®‰è£åŒæ­¥æ—¶é—´å‘½ä»¤</span>
yum <span class="token function">install</span> ntpdate <span class="token parameter variable">-y</span>

<span class="token comment">#åŒæ­¥æ—¶é—´</span>
ntpdate cn.pool.ntp.org

<span class="token comment">#è®¾ç½®å®šæ—¶ä»»åŠ¡æ¯äº”åˆ†é’ŸåŒæ­¥ä¸€æ¬¡æ—¶é—´</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;*/5 * * * * root /usr/sbin/ntpdate cn.pool.ntp.org &amp;&gt;/dev/null&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/crontab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç‰¹æ®Šè¯´æ˜" tabindex="-1"><a class="header-anchor" href="#ç‰¹æ®Šè¯´æ˜" aria-hidden="true">#</a> ç‰¹æ®Šè¯´æ˜:</h3>`,3),q=t(`<h3 id="ä¸‰å°éƒ½å®‰è£…éœ€è¦çš„ä¸€äº›å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#ä¸‰å°éƒ½å®‰è£…éœ€è¦çš„ä¸€äº›å‘½ä»¤" aria-hidden="true">#</a> ä¸‰å°éƒ½å®‰è£…éœ€è¦çš„ä¸€äº›å‘½ä»¤ï¼š</h3><ul><li>æ·»åŠ centosæºå¹¶å°†ä¸‹è½½åœ°å€æ›´æ¢ä¸ºé˜¿é‡Œäº‘åœ°å€</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#æ·»åŠ centosæº</span>
<span class="token function">curl</span> <span class="token parameter variable">-o</span> /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo

<span class="token comment">#å°†ä¸‹è½½åœ°å€æ›´æ¢ä¸ºé˜¿é‡Œäº‘åœ°å€</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;/mirrors.cloud.aliyuncs.com/d&#39;</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;/mirrors.aliyuncs.com/d&#39;</span> /etc/yum.repos.d/CentOS-Base.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ·»åŠ epelæ‰©å±•æº</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">-o</span> /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>æ¸…é™¤ç¼“å­˜</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum clean all
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>é‡æ–°åŠ è½½æºç¼“å­˜</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum makecache
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>å‡çº§yumå¹¶å®‰è£…ä¸€äº›ä¼šç”¨åˆ°çš„å‘½ä»¤</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token parameter variable">-y</span> update <span class="token operator">&amp;&amp;</span> yum <span class="token parameter variable">-y</span> <span class="token function">install</span> lrzsz <span class="token function">wget</span> conntrack ipvsadm ipset jq psmisc sysstat <span class="token function">curl</span> iptables net-tools libseccomp gcc gcc-c++ yum-utils device-mapper-persistent-data lvm2 bash-completion
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å®‰è£…éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå°±ç­‰å¾…å®‰è£…å³å¯ï¼›</p><h2 id="éƒ¨ç½²-docker-æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-docker-æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦éƒ¨ç½²" aria-hidden="true">#</a> éƒ¨ç½² dockerï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦éƒ¨ç½²ï¼‰</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#å®‰è£…dockeræ‰€éœ€çš„ä¾èµ–åŒ…</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># yum install -y yum-utils device-mapper-persistent-data lvm2	</span>

<span class="token comment">#æ·»åŠ é˜¿é‡Œäº‘çš„dockeré•œåƒåœ°å€</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># sudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>
<span class="token operator">&amp;&amp;</span><span class="token comment">#æˆ–è€…ï¼ˆäºŒé€‰ä¸€å³å¯ï¼‰</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span>

<span class="token comment">#æ›´æ–°ç¼“å­˜ï¼Œåªå¤„ç†æ–°æ·»åŠ çš„yumæºç¼“å­˜</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># yum makecache fast</span>

<span class="token comment">#éƒ¨ç½²dockerï¼Œé»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># yum install -y docker-ce-20.10.14 docker-ce-cli-20.10.14 containerd.io</span>

<span class="token comment">#æŸ¥çœ‹å®‰è£…dockerç‰ˆæœ¬</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># docker --version(æˆ–è€…ä½¿ç”¨docker version)</span>
Docker version <span class="token number">20.10</span>.14, build a224086

<span class="token comment">#åŠ è½½dockeré…ç½®</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span>
<span class="token comment">#å¯åŠ¨dockeræœåŠ¡</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl start docker</span>
<span class="token comment">#è®¾ç½®dockeræœåŠ¡å¼€æœºè‡ªå¯</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable docker</span>

<span class="token comment">#æŸ¥çœ‹dockerå¯ä»¥å®‰è£…çš„ç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œyum -y install docker-ce-19.03.12.el7</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># yum list docker-ce --showduplicates | sort -r</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ç»™dockeræ·»åŠ é•œåƒåŠ é€Ÿå™¨åŠcgroupå¹¶é‡å¯dockeræœåŠ¡" tabindex="-1"><a class="header-anchor" href="#ç»™dockeræ·»åŠ é•œåƒåŠ é€Ÿå™¨åŠcgroupå¹¶é‡å¯dockeræœåŠ¡" aria-hidden="true">#</a> ç»™dockeræ·»åŠ é•œåƒåŠ é€Ÿå™¨åŠcgroupå¹¶é‡å¯dockeræœåŠ¡</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /etc/docker</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://mrlmpasq.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;exec-opts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;native.cgroupdriver=systemd&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF
<span class="token comment">#ç”±äºæ–°ç‰ˆkubeletå»ºè®®ä½¿ç”¨systemdï¼Œæ‰€ä»¥å¯ä»¥æŠŠdockerçš„CgroupDriveræ”¹æˆsystemd</span>

<span class="token comment">#é‡æ–°åŠ è½½dockeré…ç½®</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span>
<span class="token comment">#é‡æ–°å¯åŠ¨dockeræœåŠ¡</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dockeréƒ¨ç½²å®Œæˆ" tabindex="-1"><a class="header-anchor" href="#dockeréƒ¨ç½²å®Œæˆ" aria-hidden="true">#</a> dockeréƒ¨ç½²å®Œæˆ</h3><h2 id="éƒ¨ç½²-kubernetes-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦éƒ¨ç½²" tabindex="-1"><a class="header-anchor" href="#éƒ¨ç½²-kubernetes-æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦éƒ¨ç½²" aria-hidden="true">#</a> éƒ¨ç½² kubernetesï¼ˆæ‰€æœ‰èŠ‚ç‚¹éƒ½è¦éƒ¨ç½²ï¼‰</h2><h3 id="é…ç½®ç›¸å…³çš„å†…æ ¸å‚æ•°" tabindex="-1"><a class="header-anchor" href="#é…ç½®ç›¸å…³çš„å†…æ ¸å‚æ•°" aria-hidden="true">#</a> é…ç½®ç›¸å…³çš„å†…æ ¸å‚æ•°</h3><p>å°†æ¡¥æ¥çš„IPv4 æµé‡ä¼ é€’åˆ°iptables çš„é“¾</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf</span>
net.bridge.bridge-nf-call-ip6tables <span class="token operator">=</span> <span class="token number">1</span>
net.bridge.bridge-nf-call-iptables <span class="token operator">=</span> <span class="token number">1</span>
EOF

<span class="token comment">#è®©å…¶ç”Ÿæ•ˆ</span>
<span class="token function">sysctl</span> <span class="token parameter variable">--system</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ·»åŠ -k8s-yumæº" tabindex="-1"><a class="header-anchor" href="#æ·»åŠ -k8s-yumæº" aria-hidden="true">#</a> æ·»åŠ  k8s yumæº</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment"># cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF</span>
<span class="token punctuation">[</span>kubernetes<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>Kubernetes
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">repo_gpgcheck</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF

<span class="token comment">#é‡æ–°åŠ è½½ç¼“å­˜</span>
yum makecache fast
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å®‰è£…-kubeadm-kubelet-kubectl" tabindex="-1"><a class="header-anchor" href="#å®‰è£…-kubeadm-kubelet-kubectl" aria-hidden="true">#</a> å®‰è£… kubeadm kubelet kubectl</h3><blockquote><p>æ³¨ï¼šå®‰è£…è¿™å‡ ä¸ªç‰ˆæœ¬ä¸è¦ç”¨æœ€æ–°çš„ï¼Œå®¹æ˜“å‡ºé—®é¢˜</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> <span class="token parameter variable">-y</span> kubeadm-1.20.0-0 kubelet-1.20.0-0 kubectl-1.20.0-0

<span class="token comment">#æŸ¥çœ‹kubeadmç‰ˆæœ¬</span>
kubeadm version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¯åŠ¨kubeletå¹¶è®¾ç½®å¼€æœºè‡ªå¯</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> systemctl start kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="kuberneteså¼ºåŒ–tab-å®‰è£…ä¹‹åä¼štabå¯ä»¥è¡¥å…¨å‘½ä»¤åŠå‚æ•°" tabindex="-1"><a class="header-anchor" href="#kuberneteså¼ºåŒ–tab-å®‰è£…ä¹‹åä¼štabå¯ä»¥è¡¥å…¨å‘½ä»¤åŠå‚æ•°" aria-hidden="true">#</a> kuberneteså¼ºåŒ–tabï¼ˆå®‰è£…ä¹‹åä¼štabå¯ä»¥è¡¥å…¨å‘½ä»¤åŠå‚æ•°ï¼‰</h3><ul><li>é…ç½®ç¯å¢ƒ</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">echo</span> <span class="token string">&#39;source  &lt;(kubectl  completion  bash)&#39;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>1ã€é€€å‡ºè¿æ¥ï¼Œé‡æ–°è¿æ¥ï¼›<br> 2ã€æˆ–è€…<code>bash</code>æ›´æ–°ç¯å¢ƒå°±å¯ä»¥ä½¿ç”¨äº†ã€‚</p></blockquote><h3 id="æŸ¥çœ‹kubeadmä½¿ç”¨çš„é•œåƒ" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹kubeadmä½¿ç”¨çš„é•œåƒ" aria-hidden="true">#</a> æŸ¥çœ‹kubeadmä½¿ç”¨çš„é•œåƒ</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubeadm config images list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,34),K=e("br",null,null,-1),N=e("br",null,null,-1),I={href:"http://k8s.gcr.io/kube-apiserver:v1.20.15",target:"_blank",rel:"noopener noreferrer"},j=e("br",null,null,-1),E={href:"http://k8s.gcr.io/kube-controller-manager:v1.20.15",target:"_blank",rel:"noopener noreferrer"},A=e("br",null,null,-1),w={href:"http://k8s.gcr.io/kube-scheduler:v1.20.15",target:"_blank",rel:"noopener noreferrer"},z=e("br",null,null,-1),O={href:"http://k8s.gcr.io/kube-proxy:v1.20.15",target:"_blank",rel:"noopener noreferrer"},R=e("br",null,null,-1),D={href:"http://k8s.gcr.io/pause:3.2",target:"_blank",rel:"noopener noreferrer"},F=e("br",null,null,-1),T={href:"http://k8s.gcr.io/etcd:3.4.13-0",target:"_blank",rel:"noopener noreferrer"},V=e("br",null,null,-1),U={href:"http://k8s.gcr.io/coredns:1.7.0",target:"_blank",rel:"noopener noreferrer"},G=t(`<ul><li>è§£å†³å›½å¤–é•œåƒä¸èƒ½è®¿é—®çš„é—®é¢˜ï¼Œæ‰§è¡Œkubeadm.shè„šæœ¬ï¼Œç”¨äºæ‹‰å–é•œåƒ/æ‰“tag/åˆ é™¤åŸæœ‰é•œåƒï¼›</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> <span class="token parameter variable">-O</span> kubeadm.sh https://files.rundreams.net/sh/kubeadm.sh <span class="token operator">&amp;&amp;</span> <span class="token function">sh</span> kubeadm.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç­‰å¾…æ‹‰å–å®Œæˆã€‚</p>`,3),L={href:"https://download.csdn.net/download/liu_chen_yang/87587297",target:"_blank",rel:"noopener noreferrer"},$=e("br",null,null,-1),B=t(`<p>æ‹‰å–å®ŒæˆæŸ¥çœ‹é•œåƒï¼›</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> images
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420231.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#masterèŠ‚ç‚¹" aria-hidden="true">#</a> masterèŠ‚ç‚¹</h2><h3 id="åˆå§‹åŒ–masterèŠ‚ç‚¹" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–masterèŠ‚ç‚¹" aria-hidden="true">#</a> åˆå§‹åŒ–masterèŠ‚ç‚¹</h3><p>å¦‚æœæ‰§è¡Œkubeadm initåˆå§‹åŒ–k8sé›†ç¾¤å¤±è´¥äº†ï¼Œåœ¨ä¸‹ä¸€æ¬¡æ‰§è¡Œkubeadm initåˆå§‹åŒ–è¯­å¥ä¹‹å‰ï¼Œå¯ä»¥å…ˆæ‰§è¡Œ<code>kubeadm reset</code>å‘½ä»¤ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯é‡ç½®èŠ‚ç‚¹ï¼Œå¤§å®¶å¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤ç†è§£ä¸ºï¼šä¸Šä¸€æ¬¡kubeadm initåˆå§‹åŒ–é›†ç¾¤æ“ä½œå¤±è´¥äº†ï¼Œè¯¥å‘½ä»¤æ¸…ç†äº†ä¹‹å‰çš„å¤±è´¥ç¯å¢ƒã€‚</p><p>æ­¤å‘½ä»¤åªåœ¨masterèŠ‚ç‚¹æ‰§è¡Œï¼Œ<code>172.16.11.221</code>æ›¿æ¢ä¸ºè‡ªå·±çš„masterèŠ‚ç‚¹IPï¼Œ<code>172.17.10.1/18</code>æ›¿æ¢ä¸ºè‡ªå·±çš„podç½‘æ®µã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubeadm init --kubernetes-version<span class="token operator">=</span><span class="token number">1.20</span>.15 --apiserver-advertise-address<span class="token operator">=</span><span class="token number">172.16</span>.11.221 --pod-network-cidr<span class="token operator">=</span><span class="token number">172.17</span>.10.1/18
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆå§‹åŒ–æˆåŠŸå›¾ä¸ºä¸‹ï¼š</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420398.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><blockquote><p>å¦‚é‡åˆå§‹åŒ–æŠ¥é”™å¯æ ¹æ®<code>systemctl status kubelet</code> æˆ–è€… <code>journalctl -xeu kubelet</code> æŸ¥çœ‹æŠ¥é”™ä¿¡æ¯æ¥è§£ã€‚å†³</p></blockquote><ul><li>æ ¹æ®æˆåŠŸæç¤ºå…ˆæ‰§è¡Œä¸‹é¢å†…å®¹<br> è¿™äº›æ˜¯æˆåŠŸå›¾ä¸­æç¤ºçš„é‚£äº›ï¼Œè¦ç»™ä»–åˆ›å»ºä¸€ä¸‹</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
<span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

<span class="token comment">#æŸ¥çœ‹nodesèŠ‚ç‚¹</span>
kubectl get nodes

<span class="token comment">#è¿™ä¸ªæ—¶å€™masteræ˜¯å¤„äºNotReadyçŠ¶æ€çš„ã€‚</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nodeèŠ‚ç‚¹çš„åŠ å…¥" tabindex="-1"><a class="header-anchor" href="#nodeèŠ‚ç‚¹çš„åŠ å…¥" aria-hidden="true">#</a> nodeèŠ‚ç‚¹çš„åŠ å…¥</h3><ul><li>å®Œæˆä¹‹åå°†åˆšåˆšåˆå§‹åŒ–masterèŠ‚ç‚¹æˆåŠŸåçš„<code>kubeadm joinä¿¡æ¯</code>å¤åˆ¶åˆ°å…¶ä»–nodeèŠ‚ç‚¹è¿›è¡ŒåŠ å…¥ã€‚</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>node1ï¼š
	kubeadm <span class="token function">join</span> <span class="token number">172.16</span>.11.221:6443 <span class="token parameter variable">--token</span> ckgdsy.xa5x21lsjqak2zmr <span class="token punctuation">\\</span>
    --discovery-token-ca-cert-hash sha256:3bc8dd07b7e88a5f7b0efa81b4ae4918abb440f93f4940c72f9b4a842d6c872b 
node2ï¼š
	kubeadm <span class="token function">join</span> <span class="token number">172.16</span>.11.221:6443 <span class="token parameter variable">--token</span> ckgdsy.xa5x21lsjqak2zmr <span class="token punctuation">\\</span>
    --discovery-token-ca-cert-hash sha256:3bc8dd07b7e88a5f7b0efa81b4ae4918abb440f93f4940c72f9b4a842d6c872b 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420434.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>nodeèŠ‚ç‚¹æ˜¾ç¤ºè¿™æ ·å°±æ˜¯åŠ è½½æˆåŠŸï¼›</p><p>åŠ è½½æˆåŠŸä¹‹åè¿”å›masterèŠ‚ç‚¹æŸ¥çœ‹é›†ç¾¤</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420835.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ç°åœ¨çš„é›†ç¾¤çŠ¶æ€éƒ½æ˜¯<code>NotReady</code>è¡¨ç¤ºä¸å¯è¾¾ï¼›è¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®‰è£…ä¸€ä¸‹<code>ç½‘ç»œæ’ä»¶ï¼ˆcaclicoï¼‰</code></p><h3 id="ç»™masterèŠ‚ç‚¹å®‰è£…podç½‘ç»œæ’ä»¶-calico" tabindex="-1"><a class="header-anchor" href="#ç»™masterèŠ‚ç‚¹å®‰è£…podç½‘ç»œæ’ä»¶-calico" aria-hidden="true">#</a> ç»™masterèŠ‚ç‚¹å®‰è£…Podç½‘ç»œæ’ä»¶ï¼ˆcalicoï¼‰</h3>`,23),M={href:"https://kubernetes.io/docs/concepts/cluster-administration/addons/",target:"_blank",rel:"noopener noreferrer"},J=e("br",null,null,-1),X={href:"https://projectcalico.docs.tigera.io/archive/v3.20/getting-started/clis/calicoctl/install",target:"_blank",rel:"noopener noreferrer"},H=e("br",null,null,-1),Q={href:"https://docs.projectcalico.org/v3.9/getting-started/kubernetes/",target:"_blank",rel:"noopener noreferrer"},W=t(`<ul><li>åœ¨masterèŠ‚ç‚¹å®‰è£…calico</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> https://docs.projectcalico.org/v3.9/manifests/calico.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420304.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>ç¡®è®¤ä¸€ä¸‹calicoæ˜¯å¦å®‰è£…æˆåŠŸ</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl get pods --all-namespaces <span class="token parameter variable">-w</span>
kubectl get pods <span class="token parameter variable">-n</span> kube-system <span class="token parameter variable">-w</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æŸ¥çœ‹èŠ‚ç‚¹è¿æ¥çŠ¶æ€" tabindex="-1"><a class="header-anchor" href="#æŸ¥çœ‹èŠ‚ç‚¹è¿æ¥çŠ¶æ€" aria-hidden="true">#</a> æŸ¥çœ‹èŠ‚ç‚¹è¿æ¥çŠ¶æ€</h3><p>å®‰è£…å®Œæˆä¹‹åï¼Œå†æ¬¡è¿”å›masterèŠ‚ç‚¹æŸ¥çœ‹é›†ç¾¤ï¼Œåœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤çœ‹é›†ç¾¤æ˜¯å¦æˆåŠŸ</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl get nodes
<span class="token comment">#æˆ–è€…ä½¿ç”¨åŠ -o wideæŸ¥çœ‹è¯¦ç»†</span>
kubectl get nodes <span class="token parameter variable">-o</span> wide
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>STATUS çŠ¶æ€ä¸º<code>Ready</code>åˆ™è¿æ¥æˆåŠŸã€‚</p><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420932.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420435.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#æµ‹è¯•" aria-hidden="true">#</a> æµ‹è¯•</h2><ul><li>å†™ä¸€ä¸ªnginxçš„yamlæ–‡ä»¶</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> pod_nginx_rs.yaml <span class="token operator">&lt;&lt;</span><span class="token string">EOF
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
  labels:
    tier: frontend
spec:
  replicas: 3
  selector:
    matchLabels:
      tier: frontend
  template:
    metadata:
      name: nginx
      labels:
        tier: frontend
    spec:
      containers:
      - name: nginx
        image: nginx
        ports:
        - containerPort: 80
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>æ ¹æ®pod_nginx_rs.ymlæ–‡ä»¶åˆ›å»ºpod</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> pod_nginx_rs.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>æŸ¥çœ‹pod</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#æŸ¥çœ‹æ‰€æœ‰çš„pod</span>
kubectl get pods
<span class="token comment">#æŸ¥çœ‹æ‰€æœ‰çš„podè¯¦ç»†ä¿¡æ¯</span>
kubectl get pods <span class="token parameter variable">-o</span> wide
<span class="token comment">#æŸ¥çœ‹æ‰€æœ‰çš„podè¶…çº§è¯¦ç»†ä¿¡æ¯</span>
kubectl describe pod nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420100.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>é€šè¿‡rså°†podæ‰©å®¹ä¸º5ä¸ªnginxæœåŠ¡</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#å°†nginxæœåŠ¡ç”±3ä¸ªæ‰©å®¹ä¸º5ä¸ª</span>
kubectl scale rs nginx <span class="token parameter variable">--replicas</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment">#æŸ¥çœ‹æ‰€æœ‰çš„pod</span>
kubectl get pods <span class="token parameter variable">-o</span> wide
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å…‰æœ‰ReplicaSetæ˜¯ä¸è¡Œçš„ï¼ŒReplicaSetä¸ä¼šæä¾›æœåŠ¡çš„ï¼Œéœ€è¦ä¸€ä¸ªServiceã€‚å°†å®ƒåº”ç”¨åˆ°é›†ç¾¤é‡Œé¢å»ã€‚</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> pod_nginx_rs_svc.yaml <span class="token operator">&lt;&lt;</span><span class="token string">EOF
apiVersion: v1
kind: Service              # ç±»å‹æ˜¯service
metadata:                  
  name: nginx              # è¿™ä¸ªserviceçš„å…¨å±€å”¯ä¸€åç§°
spec:
  type: NodePort
  ports:
    - port: 80             # serviceæä¾›æœåŠ¡çš„ç«¯å£å·
      nodePort: 30000      # æƒ³è¦å¯¹å¤–çš„ç«¯å£
  selector:
    tier: frontend         # æŠŠæ‹¥æœ‰{tier:labels}æˆ–è€…{app:labels}è¿™ä¸ªæ ‡ç­¾çš„podåº”ç”¨åˆ°è¿™ä¸ªæœåŠ¡é‡Œé¢
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœä¸åŠ <code>nodePort</code>ä¹Ÿå°±æ˜¯ä¸æŒ‡å®šnodeportï¼Œé»˜è®¤ä¼šéšæœºè¾“å‡ºç«¯å£ï¼Œå¯ä»¥é€šè¿‡<code>kubectl get svc</code>æŸ¥çœ‹ï¼›</p><p>å¦‚æœéœ€è¦ä¿®æ”¹ç«¯å£èŒƒå›´ï¼Œå¦‚æœæ˜¯æŒ‰ç…§æˆ‘çš„æ–¹å¼éƒ¨ç½²çš„ï¼Œå¯åœ¨ï¼š<code>vim /etc/kubernetes/manifests/kube-apiserver.yaml</code> çš„ç¬¬17è¡Œè¿›è¡Œä¿®æ”¹ï¼Œé»˜è®¤èŒƒå›´æ˜¯30000-32767ã€‚</p><ul><li>æ ¹æ® pod_nginx_rs_svc.yml æ–‡ä»¶åˆ›å»ºservicesï¼Œéœ€å¯¹å¤–è®¿é—®</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl apply <span class="token parameter variable">-f</span> pod_nginx_rs_svc.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>æŸ¥çœ‹services</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl get svc
kubectl get services
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420085.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><blockquote><p>kubectl get svc ä¸­çš„ type ã€‚</p><ul><li>Cluster IP ä¸ºæœåŠ¡å™¨å†…éƒ¨ä½¿ç”¨</li><li>Node Port ä¸ºæœåŠ¡å™¨å†…éƒ¨å¤–éƒ¨éƒ½å¯ä»¥ä½¿ç”¨ï¼Œå¯ä»¥æŒ‡å®šç«¯å£ä¹Ÿå¯ä»¥éšæœºç«¯å£ã€‚</li></ul></blockquote><ul><li>å¯åŠ¨servicesä¹‹åï¼ŒæŸ¥çœ‹ç«¯å£</li></ul><figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161420877.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>`,33),Y=t(`<figure><img src="https://lcy-blog.oss-cn-beijing.aliyuncs.com/blog/202412161419732.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><ul><li>åˆ é™¤serviecså’Œpod</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#åˆ é™¤serviecs</span>
kubectl delete <span class="token parameter variable">-f</span> pod_nginx_rs_svc.yaml

<span class="token comment">#åˆ é™¤pod</span>
kubectl delete <span class="token parameter variable">-f</span> pod_nginx_rs.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å®Œç»“â­•" tabindex="-1"><a class="header-anchor" href="#å®Œç»“â­•" aria-hidden="true">#</a> å®Œç»“â­•</h2>`,4),Z={href:"https://blog.csdn.net/u010800804/article/details/124524688?app_version=5.15.0&csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22124524688%22,%22source%22:%22liu_chen_yang%22%7D&utm_source=app",target:"_blank",rel:"noopener noreferrer"},ee=e("br",null,null,-1),ne=e("br",null,null,-1);function se(ae,te){const a=r("ExternalLinkIcon"),i=r("font");return o(),c("div",null,[e("blockquote",null,[p,e("p",null,[n("â€ƒâ€ƒğŸ…"),e("a",b,[n("äº‘è®¡ç®—é¢†åŸŸä¼˜è´¨åˆ›ä½œè€…"),s(a)]),m,n(" â€ƒâ€ƒğŸ…"),e("a",v,[n("åä¸ºäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»"),s(a)]),k,n(" â€ƒâ€ƒğŸ…"),e("a",h,[n("é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºä¸“å®¶åšä¸»"),s(a)]),g,n(" ğŸ’Š"),f,e("a",_,[n("è¿ç»´äº¤æµç¤¾åŒº"),s(a)]),n(" æ¬¢è¿å¤§å®¶çš„åŠ å…¥ï¼")])]),y,x,e("p",null,[n("å®˜ç½‘åœ°å€: "),e("a",P,[n("https://kubernetes.io"),s(a)])]),C,s(i,{color:"red"},{default:l(()=>[n("æ³¨æ„ï¼šipä¸€å®šè¦æ”¹æˆè‡ªå·±çš„ipï¼Œä¸è¦ç›´æ¥å¤åˆ¶ç²˜è´´")]),_:1}),S,e("blockquote",null,[e("p",null,[n("å¦‚æœæ˜¯å…‹éš†è™šæ‹Ÿæœºå»ºè®®æ‰§è¡Œ"),s(i,{color:"red"},{default:l(()=>[n("rm -rf /etc/udev/*")]),_:1}),n(" ä¿è¯ç½‘å¡UUIDä¸åŒ")])]),q,e("blockquote",null,[e("p",null,[n("å¯ä»¥å‘ç°è¿™é‡Œéƒ½æ˜¯å›½å¤–çš„é•œåƒ"),K,N,e("a",I,[n("k8s.gcr.io/kube-apiserver:v1.20.15"),s(a)]),j,e("a",E,[n("k8s.gcr.io/kube-controller-manager:v1.20.15"),s(a)]),A,e("a",w,[n("k8s.gcr.io/kube-scheduler:v1.20.15"),s(a)]),z,e("a",O,[n("k8s.gcr.io/kube-proxy:v1.20.15"),s(a)]),R,e("a",D,[n("k8s.gcr.io/pause:3.2"),s(a)]),F,e("a",T,[n("k8s.gcr.io/etcd:3.4.13-0"),s(a)]),V,e("a",U,[n("k8s.gcr.io/coredns:1.7.0"),s(a)])])]),G,e("blockquote",null,[e("p",null,[n("å¦‚æœæ„Ÿè§‰æ‹‰å–æ¯”è¾ƒè´¹åŠ²ï¼Œå¯ä»¥ä¸‹è½½kubeadmæ‰€éœ€çš„é•œåƒå’Œè„šæœ¬ï¼š"),e("a",L,[n("kubeadmæ‰€éœ€é•œåƒåŒ…åŠè„šæœ¬v1.20.15ç‰ˆæœ¬"),$,s(a)])])]),B,e("blockquote",null,[e("p",null,[n("é€‰æ‹©ç½‘ç»œæ’ä»¶ï¼š"),e("a",M,[n("https://kubernetes.io/docs/concepts/cluster-administration/addons/"),s(a)]),J,n(" å¿«é€Ÿå¼€å§‹é…ç½®ï¼š"),e("a",X,[n("https://projectcalico.docs.tigera.io/archive/v3.20/getting-started/clis/calicoctl/install"),s(a)]),H,n(" calicoç½‘ç»œæ’ä»¶ï¼š"),e("a",Q,[n("https://docs.projectcalico.org/v3.9/getting-started/kubernetes/"),s(a)])])]),W,e("p",null,[n("ç«¯å£ä¸º30000ï¼Œé¡µé¢è®¿é—®ï¼Œ"),s(i,{color:"red"},{default:l(()=>[n("èŠ‚ç‚¹çš„ip+30000;")]),_:1})]),e("blockquote",null,[s(i,{color:"red"},{default:l(()=>[n("èŠ‚ç‚¹çš„ipå¯ä»¥ä¸ºä¸»èŠ‚ç‚¹çš„ipï¼Œä¹Ÿå¯ä»¥ä¸ºä»èŠ‚ç‚¹çš„ipã€‚")]),_:1})]),Y,e("p",null,[n("å†…å®¹ä¸»è¦å‚è€ƒä¸ï¼š"),e("a",Z,[n("ã€äº‘åŸç”Ÿ-K8sã€‘kubeadmæ­å»ºk8sé›†ç¾¤ã€ä¸æˆåŠŸæ‰‹æŠŠæ‰‹æ•™å­¦ã€‘"),ee,s(a)]),ne,n(" æ„Ÿè°¢å¤§å®¶çš„è§‚çœ‹ï¼ï¼ï¼")])])}const re=d(u,[["render",se],["__file","ã€äº‘åŸç”Ÿ-K8s-1ã€‘kubeadmæ­å»ºk8sé›†ç¾¤(ä¸€ä¸»ä¸¤ä»)å®Œæ•´æ•™ç¨‹åŠkubernetesç®€ä»‹.html.vue"]]);export{re as default};
